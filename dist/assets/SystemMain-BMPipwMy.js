import{e as L,E as j}from"./elementPlus-DvW_yQnS.js";import{u as H,_ as N}from"./index-C76T_Z_L.js";import{x as U,r as x,j as A,G as u,H as e,P as n,ag as o,A as m,L as S,M as v,u as O,az as D,z as s,c as P,y as M,O as C,a6 as E,K as z,aE as q}from"./vendor-COQJj1AX.js";import"./supabase-ndUUYBZa.js";const F={class:"toolbar",style:{display:"flex","justify-content":"end","align-items":"center"}},G={style:{display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","margin-right":"5px"}},J=U({__name:"Header",setup(R){const w=D(),g=H(),l=x(g.user);console.log(l.value,"user"),x(""),A(()=>{l.value=g.getUser()});const r=()=>{g.logout(),w.push("/login")};return(k,c)=>{const i=o("el-col"),b=o("el-avatar"),$=o("el-icon"),a=o("el-link"),_=o("el-dropdown-item"),d=o("el-dropdown-menu"),p=o("el-dropdown"),h=o("el-row"),y=o("el-header");return s(),u(y,{style:{"font-size":"16px"}},{default:e(()=>[n(h,{justify:"space-between",gutter:16,style:{height:"100%","align-items":"center"}},{default:e(()=>[n(i,{span:3},{default:e(()=>c[0]||(c[0]=[m("h1",{style:{"font-size":"40px","font-weight":"700"}},"IWISH",-1)])),_:1}),n(i,{span:4},{default:e(()=>{var t,f;return[m("div",F,[n(b,{style:{"margin-right":"10px","min-width":"40px","font-size":"20px","font-weight":"700","align-items":"center","line-height":"40px","justify-content":"center",background:"#2f87ff"},src:(t=l.value)==null?void 0:t.avatar_url},{default:e(()=>{var B,I,V;return[S(v(((V=(I=(B=l.value)==null?void 0:B.full_name)==null?void 0:I.charAt(0))==null?void 0:V.toUpperCase())||"U"),1)]}),_:1},8,["src"]),m("span",G,v((f=l.value)==null?void 0:f.full_name),1),n(p,null,{dropdown:e(()=>[n(d,null,{default:e(()=>[n(_,null,{default:e(()=>[n(a,{href:"/system/personal-data"},{default:e(()=>c[1]||(c[1]=[S(" 个人中心")])),_:1})]),_:1}),n(_,{onClick:r},{default:e(()=>c[2]||(c[2]=[S("退出登录")])),_:1})]),_:1})]),default:e(()=>[n($,{style:{"margin-right":"10px","margin-top":"1px","font-size":"18px",color:"#fff"}},{default:e(()=>[n(O(L))]),_:1})]),_:1})])]}),_:1})]),_:1})]),_:1})}}}),K=N(J,[["__scopeId","data-v-8f6d8bf3"]]),T=U({__name:"Aside",setup(R){D();const w=x(""),g=x([]),l=x(!1),r=H(),k=P(()=>r.getMenus);A(async()=>{l.value=!0,await r.fetchMenus(),l.value=!1,console.log(k.value,"aside menus")});const c=a=>{w.value=a,a==="/system/demand"&&b()};function i(a){const _=typeof a=="string"?a:JSON.stringify(a);return btoa(unescape(encodeURIComponent(_))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const b=()=>{var a,_,d,p,h,y;try{const t={id:((a=r.user)==null?void 0:a.user_id)||"",email:((_=r.user)==null?void 0:_.email)||"",name:((d=r.user)==null?void 0:d.full_name)||((h=(p=r.user)==null?void 0:p.email)==null?void 0:h.split("@")[0])||"用户",role:$((y=r.user)==null?void 0:y.role_id)},f=i(t);window.open(`https://iwishneed.netlify.app/auth/bridge?external_user=${f}`,"_blank")}catch(t){console.error("处理demand跳转失败:",t),j.error("跳转失败，请稍后重试")}},$=a=>{if(!a)return"submitter";switch(a){case 0:case 1:return"admin";case 2:case 3:return"manager";case 4:case 5:return"developer";default:return"submitter"}};return(a,_)=>{const d=o("el-icon"),p=o("el-menu-item"),h=o("el-sub-menu"),y=o("el-menu");return s(),u(y,{class:"el-menu-vertical-demo","active-text-color":"#fff","background-color":"#05479a","text-color":"#fff",style:{position:"fixed","z-index":"999",height:"calc(100vh - 84px)",left:"0",width:"240px"},router:!0,"unique-opened":!0,"default-active":w.value,"default-openeds":g.value,onSelect:c,loading:l.value},{default:e(()=>[(s(!0),M(C,null,E(k.value,t=>(s(),M(C,{key:t.id},[t.children&&t.children.length>0?(s(),u(h,{key:0,index:`/system${t.path}`},{title:e(()=>[n(d,null,{default:e(()=>[(s(),u(z(t.icon)))]),_:2},1024),m("span",null,v(t.name),1)]),default:e(()=>[(s(!0),M(C,null,E(t.children,f=>(s(),u(p,{key:f.id,index:`/system${f.path}`},{default:e(()=>[S(v(f.name),1)]),_:2},1032,["index"]))),128))]),_:2},1032,["index"])):t.path==="/demand"?(s(),u(p,{key:1,onClick:b},{default:e(()=>[n(d,null,{default:e(()=>[(s(),u(z(t.icon)))]),_:2},1024),m("span",null,v(t.name),1)]),_:2},1024)):(s(),u(p,{key:2,index:`/system${t.path}`},{default:e(()=>[n(d,null,{default:e(()=>[(s(),u(z(t.icon)))]),_:2},1024),m("span",null,v(t.name),1)]),_:2},1032,["index"]))],64))),128))]),_:1},8,["default-active","default-openeds","loading"])}}}),W={class:"common-layout"},Q={class:"page-container"},X={class:"loading-container"},Y=U({__name:"SystemMain",setup(R){return x([]),(w,g)=>{const l=o("el-aside"),r=o("RouterView"),k=o("el-skeleton"),c=o("el-main"),i=o("el-container");return s(),M("div",W,[n(i,{direction:"vertical",style:{height:"100vh"}},{default:e(()=>[n(K),n(i,{style:{"margin-top":"84px"}},{default:e(()=>[n(l,{width:"240px"},{default:e(()=>[n(T)]),_:1}),n(i,null,{default:e(()=>[n(c,null,{default:e(()=>[m("div",Q,[(s(),u(q,null,{default:e(()=>[n(r)]),fallback:e(()=>[m("div",X,[n(k,{rows:3,animated:""})])]),_:1}))])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),oe=N(Y,[["__scopeId","data-v-f490535e"]]);export{oe as default};
