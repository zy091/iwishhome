import{E as m,s as J,c as P}from"./elementPlus-Dv7g5dxn.js";import{B as Q,b as X,_ as Y}from"./index-_R_LCzP9.js";import{g as K,d as O,u as W,c as Z}from"./role-DAJw-upX.js";import{x as ee,r as p,X as te,c as le,j as ae,y as oe,P as t,A as _,H as a,ag as s,u as ne,L as i,I as re,aq as se,G as S,M as D,J as ie,z as v}from"./vendor-COQJj1AX.js";import"./supabase-Bqqw4QDB.js";const de={class:"layout"},ue={class:"role-content"},pe={class:"card-header"},ce={class:"header-actions"},me={style:{"font-size":"14px",color:"#909399"}},_e={class:"dialog-footer"},fe=ee({__name:"RoleSetting",setup(ge){const B=[{name:"角色管理",path:"/system/role-setting"}],h=p(!1),g=p([]),b=p(""),f=p(!1),y=p(""),C=p(null),r=te({page:1,pageSize:10,total:0}),n=p({role_id:"",name:"",mark:[],description:""}),$={role_id:[{required:!0,message:"请输入角色ID",trigger:"blur"}],name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],description:[{required:!0,message:"请输入描述",trigger:"blur"}]},V=p([]),N=le(()=>{const l=(r.page-1)*r.pageSize,e=l+r.pageSize;return g.value.slice(l,e)}),w=async()=>{h.value=!0;try{const l=await K();V.value=l.data,g.value=l.data,r.total=l.data.length}catch(l){console.error("获取角色列表失败:",l),m.error("获取角色列表失败")}finally{h.value=!1}},U=l=>{r.page=l.page,r.pageSize=l.pageSize,w()},I=()=>{if(r.page=1,!b.value){g.value=V.value,r.total=V.value.length;return}g.value=V.value.filter(l=>l.name.includes(b.value)),r.total=g.value.length},L=()=>{y.value="添加角色",n.value={role_id:"",name:"",mark:[],description:""},f.value=!0},M=l=>{y.value="编辑角色",n.value={...l},f.value=!0},E=async l=>{if(Number(l.role_id)===0){m.warning("系统内置角色不允许删除！");return}try{await P.confirm("确定要删除该角色吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O(Number(l.role_id)),m.success("删除成功"),w()}catch(e){e!=="cancel"&&(console.error("删除角色失败:",e),m.error("删除失败"))}},q=async()=>{C.value&&await C.value.validate(async l=>{if(l)try{n.value.id?(await W(Number(n.value.role_id),n.value),m.success("更新成功")):(await Z(n.value),m.success("创建成功")),f.value=!1,w()}catch(e){console.error(n.value.role_id?"更新失败:":"创建失败:",e),m.error(n.value.role_id?"更新失败":"创建失败")}})};function R(l){if(!l)return"-";const e=new Date(l),c=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),z=String(e.getDate()).padStart(2,"0"),k=String(e.getHours()).padStart(2,"0"),u=String(e.getMinutes()).padStart(2,"0");return`${c}-${d}-${z} ${k}:${u}`}return ae(async()=>{await w()}),(l,e)=>{const c=s("el-input"),d=s("el-button"),z=s("el-space"),k=s("el-card"),u=s("el-table-column"),F=s("el-button-group"),T=s("el-table"),x=s("el-form-item"),A=s("el-form"),H=s("el-dialog"),j=se("loading");return v(),oe("div",de,[t(Q,{breadbcrum:B}),e[14]||(e[14]=_("div",{class:"layout-title"},[_("h1",{class:"title"},"角色管理")],-1)),t(k,{shadow:"always",style:{"margin-bottom":"20px"}},{default:a(()=>[t(z,{wrap:"",alignment:"start",size:30},{default:a(()=>[t(c,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),style:{width:"240px"},placeholder:"请输入角色名称","suffix-icon":ne(J),size:"large",clearable:""},null,8,["modelValue","suffix-icon"]),t(d,{type:"primary",size:"large",onClick:I},{default:a(()=>e[7]||(e[7]=[i("搜索")])),_:1}),t(d,{type:"success",size:"large",onClick:L},{default:a(()=>e[8]||(e[8]=[i("添加角色")])),_:1})]),_:1})]),_:1}),_("div",ue,[t(k,{style:{"min-height":"400px"}},{header:a(()=>[_("div",pe,[e[9]||(e[9]=i(" 角色列表 ")),_("div",ce,[_("div",me,"共计"+D(r.total)+"条数据",1)])])]),default:a(()=>[re((v(),S(T,{data:N.value,"row-key":"role_id"},{default:a(()=>[t(u,{prop:"role_id",label:"ID",width:"80"}),t(u,{prop:"name",label:"角色名称",width:"180"}),t(u,{prop:"description",label:"描述"}),t(u,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:o})=>[i(D(R(o.created_at)),1)]),_:1}),t(u,{prop:"updated_at",label:"更新时间",width:"180"},{default:a(({row:o})=>[i(D(R(o.updated_at)),1)]),_:1}),t(u,{label:"操作",width:"200"},{default:a(({row:o})=>[t(F,null,{default:a(()=>[t(d,{type:"primary",onClick:G=>M(o)},{default:a(()=>e[10]||(e[10]=[i(" 编辑 ")])),_:2},1032,["onClick"]),Number(o.role_id)!==0?(v(),S(d,{key:0,type:"danger",onClick:G=>E(o)},{default:a(()=>e[11]||(e[11]=[i(" 删除 ")])),_:2},1032,["onClick"])):ie("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[j,h.value]])]),_:1}),t(X,{pagination:r,"onUpdate:pagination":U},null,8,["pagination"]),t(H,{title:y.value,modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=o=>f.value=o),width:"500px"},{footer:a(()=>[_("span",_e,[t(d,{onClick:e[5]||(e[5]=o=>f.value=!1)},{default:a(()=>e[12]||(e[12]=[i("取消")])),_:1}),t(d,{type:"primary",onClick:q},{default:a(()=>e[13]||(e[13]=[i("确定")])),_:1})])]),default:a(()=>[t(A,{model:n.value,rules:$,ref_key:"roleFormRef",ref:C,"label-width":"100px"},{default:a(()=>[y.value==="编辑角色"?(v(),S(x,{key:0,label:"角色ID",prop:"role_id"},{default:a(()=>[t(c,{modelValue:n.value.role_id,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.role_id=o),disabled:""},null,8,["modelValue"])]),_:1})):(v(),S(x,{key:1,label:"角色ID",prop:"role_id"},{default:a(()=>[t(c,{modelValue:n.value.role_id,"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.role_id=o)},null,8,["modelValue"])]),_:1})),t(x,{label:"角色名称",prop:"name"},{default:a(()=>[t(c,{modelValue:n.value.name,"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.name=o)},null,8,["modelValue"])]),_:1}),t(x,{label:"描述",prop:"description"},{default:a(()=>[t(c,{modelValue:n.value.description,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.description=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])])}}}),ke=Y(fe,[["__scopeId","data-v-6abd80c9"]]);export{ke as default};
