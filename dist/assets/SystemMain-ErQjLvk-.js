import{e as q,f as N,h as G,E as K}from"./elementPlus-Be5V1zcU.js";import{u as E,b as T,s as W}from"./index-bysYXhlE.js";import{x as H,r as k,j,c as J,az as O,G as _,H as n,P as e,ag as o,A as i,L as R,M as $,u as m,J as Q,aA as P,z as s,y as M,O as A,a6 as F,K as B,aF as X}from"./vendor-CcmhhHhJ.js";import"./supabase-fOlwtt9p.js";const Y={class:"toolbar",style:{display:"flex","justify-content":"end","align-items":"center"}},Z={style:{display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","margin-right":"5px"}},ee=H({__name:"Header",setup(L){const z=P(),c=E(),p=k(c.user);console.log(p.value,"user");const b=O();k(""),j(()=>{p.value=c.getUser()});const x=()=>{c.logout(),z.push("/login")},d=J(()=>b.path.includes("/training-")||b.path.includes("/training-home"));return(S,f)=>{const C=o("el-col"),U=o("el-avatar"),I=o("el-icon"),D=o("el-link"),a=o("el-dropdown-item"),t=o("el-dropdown-menu"),g=o("el-dropdown"),r=o("el-row"),u=o("el-header");return s(),_(u,{style:{"font-size":"16px"}},{default:n(()=>[e(r,{justify:"space-between",gutter:16,style:{height:"100%","align-items":"center"}},{default:n(()=>[e(C,{span:3},{default:n(()=>f[0]||(f[0]=[i("h1",{style:{"font-size":"40px","font-weight":"700"}},"IWISH",-1)])),_:1}),e(C,{span:4},{default:n(()=>{var h,v;return[i("div",Y,[e(U,{style:{"margin-right":"10px","min-width":"40px","font-size":"20px","font-weight":"700","align-items":"center","line-height":"40px","justify-content":"center",background:"#2f87ff"},src:(h=p.value)==null?void 0:h.avatar_url},{default:n(()=>{var w,y,l;return[R($(((l=(y=(w=p.value)==null?void 0:w.full_name)==null?void 0:y.charAt(0))==null?void 0:l.toUpperCase())||"U"),1)]}),_:1},8,["src"]),i("span",Z,$((v=p.value)==null?void 0:v.full_name),1),e(g,null,{dropdown:n(()=>[e(t,null,{default:n(()=>[d.value?Q("",!0):(s(),_(a,{key:0},{default:n(()=>[e(D,{href:"/system/personal-data"},{default:n(()=>f[1]||(f[1]=[R(" 个人中心")])),_:1})]),_:1})),e(a,{onClick:x},{default:n(()=>f[2]||(f[2]=[R("退出登录")])),_:1})]),_:1})]),default:n(()=>[e(I,{style:{"margin-right":"10px","margin-top":"1px","font-size":"18px",color:"#fff"}},{default:n(()=>[e(m(q))]),_:1})]),_:1})])]}),_:1})]),_:1})]),_:1})}}}),ne=T(ee,[["__scopeId","data-v-9f2c58f7"]]),te=H({__name:"Aside",setup(L){const z=P(),c=O();console.log(z,"==========",c.name);const p=k(""),b=k([]),x=k(!1),d=E(),S=J(()=>d.getMenus),f=a=>{p.value=a,a==="/system/demand"&&I()},C=k("");j(async()=>{x.value=!0,await d.fetchMenus();const{data:{session:a}}=await W.auth.getSession();C.value=(a==null?void 0:a.access_token)||"",x.value=!1});function U(a){const t=typeof a=="string"?a:JSON.stringify(a);return btoa(unescape(encodeURIComponent(t))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const I=()=>{var a,t,g,r,u,h,v,w;try{const y={id:((a=d.user)==null?void 0:a.user_id)||"",email:((t=d.user)==null?void 0:t.email)||"",name:((g=d.user)==null?void 0:g.full_name)||((u=(r=d.user)==null?void 0:r.email)==null?void 0:u.split("@")[0])||"用户",role:D((h=d.user)==null?void 0:h.role_id),rolename:(w=(v=d.user)==null?void 0:v.role)==null?void 0:w.name,origin:window.location.origin,exp:Math.floor(Date.now()/1e3)+900},l=U(y);window.open(`https://iwishneed.netlify.app/auth/bridge#external_user=${l}&main_access_token=${C.value}`,"_blank")}catch(y){console.error("处理demand跳转失败:",y),K.error("跳转失败，请稍后重试")}},D=a=>{if(!a)return"submitter";switch(a){case 0:case 1:return"admin";case 2:case 3:return"manager";case 4:case 5:return"developer";default:return"submitter"}};return(a,t)=>{const g=o("ArrowLeft"),r=o("el-icon"),u=o("el-menu-item"),h=o("InfoFilled"),v=o("DataAnalysis"),w=o("el-sub-menu"),y=o("el-menu");return s(),_(y,{class:"el-menu-vertical-demo","active-text-color":"#fff","background-color":"#05479a","text-color":"#fff",style:{position:"fixed","z-index":"999",height:"calc(100vh - 84px)",left:"0",width:"240px","overflow-y":"auto","overflow-x":"hidden"},router:!0,"unique-opened":!0,"default-active":p.value,"default-openeds":b.value,onSelect:f,loading:x.value},{default:n(()=>[m(c).name==="letter-to-employee"||m(c).name==="company-introduction"||m(c).name==="apply-for-registration"?(s(),M(A,{key:0},[e(u,{index:"/training-home"},{default:n(()=>[e(r,null,{default:n(()=>[e(g)]),_:1}),t[0]||(t[0]=i("span",null,"返回",-1))]),_:1}),e(u,{index:"/system/training-letter"},{default:n(()=>[e(r,null,{default:n(()=>[e(m(N))]),_:1}),t[1]||(t[1]=i("span",null,"致员工的一封信",-1))]),_:1}),e(u,{index:"/system/training-company"},{default:n(()=>[e(r,null,{default:n(()=>[e(m(G))]),_:1}),t[2]||(t[2]=i("span",null,"了解艾维",-1))]),_:1}),e(u,{index:"/system/training-apply"},{default:n(()=>[e(r,null,{default:n(()=>[e(h)]),_:1}),t[3]||(t[3]=i("span",null,"申请注册",-1))]),_:1})],64)):m(c).name==="digital-marketing"||m(c).name==="website-layout"?(s(),M(A,{key:1},[e(u,{index:"/training-home"},{default:n(()=>[e(r,null,{default:n(()=>[e(g)]),_:1}),t[4]||(t[4]=i("span",null,"返回",-1))]),_:1}),e(u,{index:"/system/training-marketing"},{default:n(()=>[e(r,null,{default:n(()=>[e(m(N))]),_:1}),t[5]||(t[5]=i("span",null,"了解数字营销与品牌独立站",-1))]),_:1}),e(u,{index:"/system/training-website"},{default:n(()=>[e(r,null,{default:n(()=>[e(v)]),_:1}),t[6]||(t[6]=i("span",null,"独立站的布局及优化诊断",-1))]),_:1})],64)):(s(!0),M(A,{key:2},F(S.value,l=>(s(),M(A,{key:l.id},[l.children&&l.children.length>0?(s(),_(w,{key:0,index:`/system${l.path}`},{title:n(()=>[e(r,null,{default:n(()=>[(s(),_(B(l.icon)))]),_:2},1024),i("span",null,$(l.name),1)]),default:n(()=>[(s(!0),M(A,null,F(l.children,V=>(s(),_(u,{key:V.id,index:`/system${V.path}`},{default:n(()=>[R($(V.name),1)]),_:2},1032,["index"]))),128))]),_:2},1032,["index"])):l.path==="/demand"?(s(),_(u,{key:1,onClick:I},{default:n(()=>[e(r,null,{default:n(()=>[(s(),_(B(l.icon)))]),_:2},1024),i("span",null,$(l.name),1)]),_:2},1024)):(s(),_(u,{key:2,index:`/system${l.path}`},{default:n(()=>[e(r,null,{default:n(()=>[(s(),_(B(l.icon)))]),_:2},1024),i("span",null,$(l.name),1)]),_:2},1032,["index"]))],64))),128))]),_:1},8,["default-active","default-openeds","loading"])}}}),oe={class:"common-layout"},ae={class:"page-container"},le={class:"loading-container"},se=H({__name:"SystemMain",setup(L){return k([]),(z,c)=>{const p=o("el-aside"),b=o("RouterView"),x=o("el-skeleton"),d=o("el-main"),S=o("el-container");return s(),M("div",oe,[e(S,{direction:"vertical",style:{height:"100vh"}},{default:n(()=>[e(ne),e(S,{style:{"margin-top":"84px"}},{default:n(()=>[e(p,{width:"240px"},{default:n(()=>[e(te)]),_:1}),e(S,null,{default:n(()=>[e(d,null,{default:n(()=>[i("div",ae,[(s(),_(X,null,{default:n(()=>[e(b)]),fallback:n(()=>[i("div",le,[e(x,{rows:3,animated:""})])]),_:1}))])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),ce=T(se,[["__scopeId","data-v-f490535e"]]);export{ce as default};
