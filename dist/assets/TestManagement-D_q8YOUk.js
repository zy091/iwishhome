import{E as v,s as qe,c as le}from"./elementPlus-Be5V1zcU.js";import{B as ke,e as xe,s as x,b as he}from"./index-Dg6Dv2jL.js";import{x as Ce,X as L,r as p,j as ze,y as S,P as o,A as n,H as a,ag as u,u as Te,O,a6 as A,L as r,I as De,G as oe,J as Ue,aq as Se,M as i,z as w}from"./vendor-CcmhhHhJ.js";import"./supabase-fOlwtt9p.js";const $e={class:"layout"},Be={class:"card-header"},Fe={class:"header-actions"},Me={style:{"font-size":"14px",color:"#909399"}},Ne={class:"tooltip-content"},Ee={class:"text-truncate"},Ie={class:"test-details"},Le={class:"detail-row"},Oe={class:"detail-row"},Ae={class:"detail-row"},Ge={class:"detail-row"},Pe={class:"detail-row"},Re=Ce({__name:"TestManagement",setup(je){const ae=L([{name:"数据管理",path:"/system/data-management"},{name:"测试管理",path:"/system/test-management"}]),h=p(!1),$=p([]),C=p(""),z=p(""),T=p(""),_=p([]),y=p(!1),D=p(!1),U=p(!1),m=p(null),B=p(null),s=L({id:null,title:"",type:"select",platform:"",question_count:0,score_weight:100}),G=[{label:"选择题测试",value:"select"},{label:"案例分析",value:"case"},{label:"综合测试",value:"comprehensive"}],F=[{value:"google",label:"Google"},{value:"facebook",label:"Facebook"},{value:"microsoft",label:"Microsoft"},{value:"meta",label:"Meta"},{value:"other",label:"Other"}],f=L({page:1,pageSize:10,total:0}),ne={title:[{required:!0,message:"请输入测试标题",trigger:"blur"}],type:[{required:!0,message:"请选择测试类型",trigger:"change"}],platform:[{required:!0,message:"请选择平台",trigger:"change"}],question_count:[{required:!0,message:"请输入题目数量",trigger:"blur"}],score_weight:[{required:!0,message:"请输入分数权重",trigger:"blur"}]},P=l=>{const e=G.find(d=>d.value===l);return e?e.label:l},R=l=>{switch(l){case"select":return"primary";case"case":return"warning";case"comprehensive":return"danger";default:return"info"}},j=l=>{const e=F.find(d=>d.value===l);return e?e.label:l},M=l=>l?new Date(l).toLocaleString("zh-CN"):"-",se=l=>{f.page=l.page,f.pageSize=l.pageSize,b()},re=l=>{_.value=l},b=async()=>{h.value=!0;try{let l=x.from("tests").select("*",{count:"exact"});C.value&&(l=l.ilike("title",`%${C.value}%`)),z.value&&(l=l.eq("type",z.value)),T.value&&(l=l.eq("platform",T.value));const{data:e,error:d,count:V}=await l.order("created_at",{ascending:!1}).range((f.page-1)*f.pageSize,f.page*f.pageSize-1);if(d)throw d;$.value=e||[],f.total=V||0}catch(l){v.error("搜索测试失败"),console.error(l)}finally{h.value=!1}},ue=()=>{U.value=!1,H(),y.value=!0},ie=l=>{U.value=!0,H(),s.id=l.id,s.title=l.title,s.type=l.type,s.platform=l.platform,s.question_count=l.question_count||0,s.score_weight=l.score_weight||100,y.value=!0},de=l=>{m.value=l,D.value=!0},H=()=>{s.id=null,s.title="",s.type="select",s.platform="",s.question_count=0,s.score_weight=100},pe=async()=>{if(B.value)try{await B.value.validate();const l={title:s.title,type:s.type,platform:s.platform,question_count:s.question_count,score_weight:s.score_weight,updated_at:new Date().toISOString()};if(U.value&&s.id){const{error:e}=await x.from("tests").update(l).eq("id",s.id);if(e)throw e;v.success("测试更新成功")}else{const{error:e}=await x.from("tests").insert(l);if(e)throw e;v.success("测试添加成功")}y.value=!1,b()}catch(l){l!=="cancel"&&(console.error("保存测试失败:",l),v.error("保存失败，请检查表单"))}},me=async l=>{try{await le.confirm(`确定要删除测试"${l.title}"吗？此操作不可恢复。`,"警告",{type:"warning"});const{error:e}=await x.from("tests").delete().eq("id",l.id);if(e)throw e;v.success("删除成功"),b()}catch(e){e!=="cancel"&&(console.error("删除测试失败:",e),v.error("删除失败"))}},fe=async()=>{if(_.value.length!==0)try{await le.confirm(`确定要删除选中的 ${_.value.length} 个测试吗？此操作不可恢复。`,"警告",{type:"warning"});const l=_.value.map(d=>d.id),{error:e}=await x.from("tests").delete().in("id",l);if(e)throw e;v.success(`成功删除 ${_.value.length} 个测试`),_.value=[],b()}catch(l){l!=="cancel"&&(console.error("批量删除测试失败:",l),v.error("批量删除失败"))}};return ze(()=>{b()}),(l,e)=>{const d=u("el-input"),V=u("el-option"),N=u("el-select"),c=u("el-button"),ce=u("el-space"),J=u("el-card"),g=u("el-table-column"),ge=u("el-tooltip"),E=u("el-tag"),ve=u("el-button-group"),_e=u("el-table"),ye=u("el-empty"),q=u("el-form-item"),I=u("el-radio"),be=u("el-radio-group"),Q=u("el-input-number"),we=u("el-form"),X=u("el-dialog"),Ve=Se("loading");return w(),S("div",$e,[o(ke,{breadcrumb:ae},null,8,["breadcrumb"]),e[38]||(e[38]=n("div",{class:"layout-title"},[n("h1",{class:"title"},"测试管理")],-1)),o(J,{shadow:"always",style:{"margin-bottom":"20px"}},{default:a(()=>[o(ce,{wrap:"",alignment:"start",size:30},{default:a(()=>[o(d,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t),style:{width:"240px"},placeholder:"请输入测试标题","suffix-icon":Te(qe),size:"large",clearable:""},null,8,["modelValue","suffix-icon"]),o(N,{modelValue:z.value,"onUpdate:modelValue":e[1]||(e[1]=t=>z.value=t),placeholder:"测试类型",clearable:"",style:{width:"180px"},size:"large"},{default:a(()=>[(w(),S(O,null,A(G,t=>o(V,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),o(N,{modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=t=>T.value=t),placeholder:"平台",clearable:"",style:{width:"180px"},size:"large"},{default:a(()=>[(w(),S(O,null,A(F,t=>o(V,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),o(c,{type:"primary",size:"large",onClick:b},{default:a(()=>e[12]||(e[12]=[r("搜索")])),_:1}),o(c,{type:"primary",size:"large",onClick:ue},{default:a(()=>e[13]||(e[13]=[r("添加测试")])),_:1})]),_:1})]),_:1}),o(J,{style:{"min-height":"400px"}},{header:a(()=>[n("div",Be,[e[15]||(e[15]=n("span",null,"测试列表",-1)),n("div",Fe,[o(c,{type:"danger",disabled:!_.value.length,onClick:fe},{default:a(()=>e[14]||(e[14]=[r(" 批量删除 ")])),_:1},8,["disabled"]),n("div",Me,"共计 "+i(f.total)+" 条数据",1)])])]),default:a(()=>[De((w(),oe(_e,{data:$.value,onSelectionChange:re},{default:a(()=>[o(g,{type:"selection",width:"55"}),o(g,{prop:"title",label:"测试标题","min-width":"200"},{default:a(({row:t})=>[o(ge,{placement:"top","show-after":500,"max-width":300},{content:a(()=>[n("div",Ne,i(t.title),1)]),default:a(()=>[n("div",Ee,i(t.title),1)]),_:2},1024)]),_:1}),o(g,{prop:"type",label:"测试类型",width:"120"},{default:a(({row:t})=>[o(E,{type:R(t.type),size:"large"},{default:a(()=>[r(i(P(t.type)),1)]),_:2},1032,["type"])]),_:1}),o(g,{prop:"platform",label:"平台",width:"120"},{default:a(({row:t})=>[r(i(j(t.platform)),1)]),_:1}),o(g,{prop:"question_count",label:"题目数量",width:"100",align:"center"},{default:a(({row:t})=>[o(E,{type:"info",size:"small"},{default:a(()=>[r(i(t.question_count||0),1)]),_:2},1024)]),_:1}),o(g,{prop:"score_weight",label:"分数权重",width:"100",align:"center"},{default:a(({row:t})=>[r(i(t.score_weight||100),1)]),_:1}),o(g,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:t})=>[r(i(M(t.created_at)),1)]),_:1}),o(g,{label:"操作",width:"220",fixed:"right"},{default:a(({row:t})=>[o(ve,null,{default:a(()=>[o(c,{type:"primary",onClick:k=>de(t)},{default:a(()=>e[16]||(e[16]=[r("查看")])),_:2},1032,["onClick"]),o(c,{type:"success",onClick:k=>ie(t)},{default:a(()=>e[17]||(e[17]=[r("编辑")])),_:2},1032,["onClick"]),o(c,{type:"danger",onClick:k=>me(t)},{default:a(()=>e[18]||(e[18]=[r("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ve,h.value]]),!h.value&&$.value.length===0?(w(),oe(ye,{key:0,description:"暂无测试"})):Ue("",!0)]),_:1}),o(xe,{pagination:f,"onUpdate:pagination":se},null,8,["pagination"]),o(X,{title:U.value?"编辑测试":"添加测试",modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=t=>y.value=t),width:"50%"},{footer:a(()=>[o(c,{onClick:e[8]||(e[8]=t=>y.value=!1)},{default:a(()=>e[22]||(e[22]=[r("取消")])),_:1}),o(c,{type:"primary",onClick:pe},{default:a(()=>e[23]||(e[23]=[r("确定")])),_:1})]),default:a(()=>[o(we,{model:s,rules:ne,ref_key:"testFormRef",ref:B,"label-width":"100px"},{default:a(()=>[o(q,{label:"测试标题",prop:"title"},{default:a(()=>[o(d,{modelValue:s.title,"onUpdate:modelValue":e[3]||(e[3]=t=>s.title=t),placeholder:"请输入测试标题"},null,8,["modelValue"])]),_:1}),o(q,{label:"测试类型",prop:"type"},{default:a(()=>[o(be,{modelValue:s.type,"onUpdate:modelValue":e[4]||(e[4]=t=>s.type=t)},{default:a(()=>[o(I,{label:"select"},{default:a(()=>e[19]||(e[19]=[r("选择题测试")])),_:1}),o(I,{label:"case"},{default:a(()=>e[20]||(e[20]=[r("案例分析")])),_:1}),o(I,{label:"comprehensive"},{default:a(()=>e[21]||(e[21]=[r("综合测试")])),_:1})]),_:1},8,["modelValue"])]),_:1}),o(q,{label:"平台",prop:"platform"},{default:a(()=>[o(N,{modelValue:s.platform,"onUpdate:modelValue":e[5]||(e[5]=t=>s.platform=t),placeholder:"请选择平台",style:{width:"100%"}},{default:a(()=>[(w(),S(O,null,A(F,t=>o(V,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),o(q,{label:"题目数量",prop:"question_count"},{default:a(()=>[o(Q,{modelValue:s.question_count,"onUpdate:modelValue":e[6]||(e[6]=t=>s.question_count=t),min:0,max:100,placeholder:"题目数量"},null,8,["modelValue"])]),_:1}),o(q,{label:"分数权重",prop:"score_weight"},{default:a(()=>[o(Q,{modelValue:s.score_weight,"onUpdate:modelValue":e[7]||(e[7]=t=>s.score_weight=t),min:1,max:1e3,placeholder:"分数权重"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),o(X,{title:"测试详情",modelValue:D.value,"onUpdate:modelValue":e[11]||(e[11]=t=>D.value=t),width:"50%"},{footer:a(()=>[o(c,{onClick:e[10]||(e[10]=t=>D.value=!1)},{default:a(()=>e[37]||(e[37]=[r("关闭")])),_:1})]),default:a(()=>{var t,k,K,W,Y,Z,ee;return[n("div",Ie,[n("div",Le,[n("p",null,[e[24]||(e[24]=n("strong",null,"测试标题:",-1)),e[25]||(e[25]=r()),n("span",null,i((t=m.value)==null?void 0:t.title),1)])]),n("div",Oe,[e[26]||(e[26]=n("p",null,[n("strong",null,"测试类型:")],-1)),o(E,{type:R((k=m.value)==null?void 0:k.type),size:"large"},{default:a(()=>{var te;return[r(i(P((te=m.value)==null?void 0:te.type)),1)]}),_:1},8,["type"])]),n("div",Ae,[n("p",null,[e[27]||(e[27]=n("strong",null,"平台:",-1)),e[28]||(e[28]=r()),n("span",null,i(j((K=m.value)==null?void 0:K.platform)),1)]),n("p",null,[e[29]||(e[29]=n("strong",null,"题目数量:",-1)),e[30]||(e[30]=r()),n("span",null,i(((W=m.value)==null?void 0:W.question_count)||0),1)])]),n("div",Ge,[n("p",null,[e[31]||(e[31]=n("strong",null,"分数权重:",-1)),e[32]||(e[32]=r()),n("span",null,i(((Y=m.value)==null?void 0:Y.score_weight)||100),1)])]),n("div",Pe,[n("p",null,[e[33]||(e[33]=n("strong",null,"创建时间:",-1)),e[34]||(e[34]=r()),n("span",null,i(M((Z=m.value)==null?void 0:Z.created_at)),1)]),n("p",null,[e[35]||(e[35]=n("strong",null,"更新时间:",-1)),e[36]||(e[36]=r()),n("span",null,i(M((ee=m.value)==null?void 0:ee.updated_at)),1)])])])]}),_:1},8,["modelValue"])])}}}),Ke=he(Re,[["__scopeId","data-v-7bc2b58d"]]);export{Ke as default};
