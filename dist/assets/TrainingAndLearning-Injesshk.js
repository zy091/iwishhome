import{x as ie,r as c,az as re,w as O,c as J,X as Q,j as ce,y as p,P as l,A as o,M as u,I as ue,H as n,ag as d,aq as de,G as V,J as L,O as pe,a6 as me,L as m,aA as _e,z as i}from"./vendor-CcmhhHhJ.js";import{B as ge,e as ve,b as fe}from"./index-bysYXhlE.js";import{t as ye,P as he}from"./PersonalTestHistory--USJvsRR.js";import{t as be}from"./testResultService-Dem0d1Ia.js";import{E as B,c as we}from"./elementPlus-Be5V1zcU.js";import"./supabase-fOlwtt9p.js";const ke={class:"training"},Te={class:"training-title"},xe={class:"title"},Ce={class:"training-content"},Ve={class:"test-list-container"},Be={class:"test-list"},ze={key:1,class:"test-grid"},qe={class:"test-card-content"},Re={class:"test-type-tag flex"},Se={class:"test-title"},$e={class:"test-info"},Ie={class:"info-item"},Le={class:"info-item"},Ne={class:"info-item"},Ae={class:"test-status"},De={key:0,class:"status-tag"},Ee={class:"score-text"},Ue={key:1,class:"status-tag"},Me={key:2,class:"status-tag"},Ge={class:"test-actions"},Pe={key:2,class:"pagination"},Fe=ie({__name:"TrainingAndLearning",setup(He){const f=re(),N=_e(),y=c(f.query.platform||"google"),X=c(f.query.chapter||"base");O(()=>f.query.platform,e=>{y.value=e||"google"},{immediate:!0}),O(()=>f.query.chapter,e=>{X.value=e||"base"},{immediate:!0});const z=J(()=>{switch(y.value){case"google":return"Google";case"facebook":return"FaceBook";default:return"Google"}}),K=Q([{name:`${z.value}培训过程考核`,path:`/system/optimize?platform=${y.value}`},{name:`${z.value}考试内容`,path:"/system/training/study-materials"}]),h=c(!0),q=c([]),A=c({}),b=c(""),w=c(""),R=c(!1),_=Q({page:1,pageSize:10,total:0}),W=e=>{_.page=e.page,_.pageSize=e.pageSize,S()},D=c([]),Y=async()=>{try{const{data:e}=await be.getUserTestResults({page:1,pageSize:100}),t={};e.forEach(s=>{s.test_id&&(!t[s.test_id]||new Date(s.submitted_at)>new Date(t[s.test_id].submitted_at))&&(t[s.test_id]=s)}),D.value=e,A.value=t}catch(e){console.error("加载测试结果失败:",e),B.error("加载测试结果失败，请稍后重试")}};ce(async()=>{await Promise.all([S(),Y()])});const S=async()=>{h.value=!0;try{const{data:e,total:t}=await ye.getTests({platform:y.value});_.total=t;let s=[...e];b.value&&(s=s.filter(r=>r.title.toLowerCase().includes(b.value.toLowerCase()))),w.value&&(s=s.filter(r=>r.type===w.value)),q.value=s,_.total=s.length}catch(e){console.error("加载测验失败:",e),B.error("加载测验失败，请稍后重试")}finally{h.value=!1}},$=()=>{_.page=1,S()},g=J(()=>e=>A.value[e]),Z=e=>{var r;if(e.type==="case"&&x(e.id)>=3){B.warning("您已达到最大尝试次数(3次)，不能再次作答");return}const t=e.type;let s="";switch(t){case"case":s="case-study";break;case"select":s="multiple-choice";break;case"comprehensive":s="comprehensive-test";break;default:s="multiple-choice"}((r=g.value(e.id))==null?void 0:r.completion_status)==="completed"?we.confirm("您已完成此测验，确定要重新开始吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{N.push({name:s,query:{testId:e.id,testName:T(e.platform||"")+"-"+e.title,platform:e.platform,score_weight:e.score_weight,type:e.type}})}).catch(()=>{B.info("已取消重新开始")}):N.push({name:s,query:{testId:e.id,testName:T(e.platform||"")+"-"+e.title,platform:e.platform,score_weight:e.score_weight,type:e.type}})},k=c(null),ee=e=>{k.value=e,R.value=!0},T=e=>{switch(e){case"select":return"选择题";case"case":return"案例分析";case"comprehensive":return"综合测验";case"google":return"Google";case"facebook":return"FaceBook";case"base":return"基础";case"middle":return"中级";case"advanced":return"高级";default:return"未知类型"}},E=e=>{switch(e){case"select":return"primary";case"case":return"success";case"comprehensive":return"warning";case"google":return"danger";case"facebook":return"primary";case"base":return"primary";case"middle":return"success";case"advanced":return"warning";default:return"info"}},x=e=>{let t=0;return Object.values(D.value).forEach(s=>{s.test_id===e&&t++}),t},te=(e,t)=>{if(x((t==null?void 0:t.id)||"")>=3)return"尝试次数已用完";switch(e){case"completed":return"重新测试";case"in_progress":return"继续测试";default:return"开始测试"}},ae=e=>e?e.is_graded?e.type==="case"&&e.grade_level?`评级: ${e.grade_level}`:`${e.score}分`:"待批改":"0分";return(e,t)=>{var G;const s=d("el-input"),r=d("el-option"),U=d("el-select"),I=d("el-button"),se=d("el-space"),M=d("el-card"),oe=d("el-empty"),v=d("el-tag"),le=d("el-dialog"),ne=de("loading");return i(),p("div",ke,[l(ge,{breadbcrum:K},null,8,["breadbcrum"]),o("div",Te,[o("h1",xe,u(z.value)+"考试内容",1)]),o("div",Ce,[o("div",Ve,[l(M,{class:"testing-search",style:{"margin-bottom":"20px"}},{default:n(()=>[l(se,{alignment:"start",size:30},{default:n(()=>[l(s,{size:"large",style:{width:"240px"},modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=a=>b.value=a),placeholder:"搜索测验名称",class:"search-input",clearable:"",onInput:$},null,8,["modelValue"]),l(U,{size:"large",style:{width:"240px"},modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=a=>w.value=a),placeholder:"测验类型",onChange:$,class:"filter-select"},{default:n(()=>[l(r,{label:"全部类型",value:""}),l(r,{label:"选择题",value:"select"}),l(r,{label:"案例分析",value:"case"}),l(r,{label:"综合测验",value:"comprehensive"})]),_:1},8,["modelValue"]),l(I,{type:"primary",size:"large",onClick:$},{default:n(()=>t[3]||(t[3]=[m("搜索")])),_:1})]),_:1})]),_:1}),ue((i(),p("div",Be,[q.value.length===0&&!h.value?(i(),V(oe,{key:0,description:"暂无测验内容"})):(i(),p("div",ze,[(i(!0),p(pe,null,me(q.value,a=>(i(),V(M,{key:a.id,class:"test-card",shadow:"hover"},{default:n(()=>{var P,F,H,j;return[o("div",qe,[o("div",Re,[l(v,{type:E(a.type)},{default:n(()=>[m(u(T(a.type)),1)]),_:2},1032,["type"]),l(v,{type:E(a.platform||"")},{default:n(()=>[m(u(T(a.platform||"")),1)]),_:2},1032,["type"])]),o("h3",Se,u(a.title),1),o("div",$e,[o("div",Ie,[t[4]||(t[4]=o("i",{class:"el-icon-question"},null,-1)),o("span",null,u(a.question_count||0)+"道题目",1)]),o("div",Le,[t[5]||(t[5]=o("i",{class:"el-icon-medal"},null,-1)),o("span",null,u(a.score_weight||100)+"分值",1)]),o("div",Ne,[t[6]||(t[6]=o("i",{class:"el-icon-refresh"},null,-1)),o("span",null,"尝试次数: "+u(x(a.id))+"/3",1)])]),o("div",Ae,[((P=g.value(a.id))==null?void 0:P.completion_status)==="completed"?(i(),p("div",De,[l(v,{type:"success"},{default:n(()=>t[7]||(t[7]=[m("已完成")])),_:1}),o("span",Ee,"最新分数: "+u(ae(g.value(a.id))),1)])):((F=g.value(a.id))==null?void 0:F.completion_status)==="in_progress"?(i(),p("div",Ue,[l(v,{type:"warning"},{default:n(()=>t[8]||(t[8]=[m("进行中")])),_:1})])):(i(),p("div",Me,[l(v,{type:"info"},{default:n(()=>t[9]||(t[9]=[m("未开始")])),_:1})]))]),o("div",Ge,[l(I,{type:"primary",disabled:((H=g.value(a.id))==null?void 0:H.completion_status)==="in_progress"||x(a.id)>=3,onClick:C=>Z(a)},{default:n(()=>{var C;return[m(u(te((C=g.value(a.id))==null?void 0:C.completion_status,a)),1)]}),_:2},1032,["disabled","onClick"]),((j=g.value(a.id))==null?void 0:j.completion_status)==="completed"?(i(),V(I,{key:0,type:"info",plain:"",onClick:C=>ee(a)},{default:n(()=>t[10]||(t[10]=[m(" 查看历史 ")])),_:2},1032,["onClick"])):L("",!0)])])]}),_:2},1024))),128))])),_.total>0?(i(),p("div",Pe,[l(ve,{pagination:_,onUpdate:W},null,8,["pagination"])])):L("",!0)])),[[ne,h.value]]),l(le,{modelValue:R.value,"onUpdate:modelValue":t[2]||(t[2]=a=>R.value=a),title:((G=k.value)==null?void 0:G.title)+" - 测试历史记录",width:"800px"},{default:n(()=>[k.value?(i(),V(he,{key:0,testId:k.value.id},null,8,["testId"])):L("",!0)]),_:1},8,["modelValue","title"])])])])}}}),We=fe(Fe,[["__scopeId","data-v-5618f1cc"]]);export{We as default};
