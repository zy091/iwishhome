import{a as M}from"./assignmentService-BTStiM5U.js";import{d as Y,u as Z,r as v,H as ee,J as te,o as se,l as p,a as l,w as s,b as i,P as le,M as h,y as ne,O as oe,c as q,e as a,t as r,f as _,q as A,F as ae,m as ie,A as re,g as w,j as d,_ as ue}from"./index-BmUZ9zWv.js";const de={class:"personal-assignment-list"},_e={class:"card-header"},ce={class:"tooltip-content"},pe={class:"text-truncate"},me={class:"tooltip-content"},fe={class:"content-preview"},ve={key:0,class:"assignment-detail"},ge={class:"assignment-meta"},ye={class:"assignment-content"},he={key:0,class:"assignment-replies"},we={class:"reply-header"},be={class:"reply-author"},xe={key:0,class:"reply-role"},ke={class:"reply-form"},Ce=Y({__name:"PersonalAssignmentList",setup(Ve){const u=Z(),x=v(!1),k=v([]),C=v(!1),o=v(null),m=v(""),E=ee();v(E.query.platform||"google");const f=te({page:1,pageSize:10,total:0}),V=n=>n?new Date(n).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",b=async()=>{x.value=!0;try{const{data:n,total:t}=await M.getPersonalAssignments(f.page,f.pageSize,{status:""});k.value=n,f.total=t}catch(n){console.error("获取作业列表失败:",n),h.error("获取作业列表失败")}finally{x.value=!1}},F=n=>{o.value=n,C.value=!0,m.value=""},I=async()=>{var n;if(o.value){if(!m.value.trim()){h.warning("回复内容不能为空");return}try{if(!((n=u.user)!=null&&n.user_id)||!o.value.id){h.error("用户信息或作业ID缺失");return}const t=await M.addReply({assignment_id:o.value.id,user_id:u.user.user_id,content:m.value,full_name:u.user.full_name||""});o.value.replies||(o.value.replies=[]),o.value.replies.push(t),h.success("提交回复成功"),m.value="",b()}catch(t){console.error("提交回复失败:",t),h.error("提交回复失败")}}},$=()=>{b()},j=n=>{f.page=n.page,f.pageSize=n.pageSize,b()},z=n=>{if(!n.replies||n.replies.length===0)return{type:"warning",text:"待完成"};const t=n.replies.some(c=>{var g;return c.user_id===((g=u.user)==null?void 0:g.user_id)});return n.replies.some(c=>c.user_id!==n.assigned_to),t?{type:"success",text:"已完成"}:{type:"warning",text:"待完成"}};return se(()=>{b()}),(n,t)=>{const c=i("el-button"),g=i("el-tooltip"),y=i("el-table-column"),H=i("el-tag"),J=i("el-button-group"),O=i("el-table"),T=i("el-empty"),G=i("el-card"),S=i("el-divider"),K=i("el-input"),D=i("el-form-item"),Q=i("el-form"),W=i("el-dialog"),X=oe("loading");return d(),p("div",de,[l(G,{class:"box-card",shadow:"always",style:{"margin-top":"30px","min-height":"400px"}},{header:s(()=>[a("div",_e,[t[3]||(t[3]=a("span",null,"我的作业列表",-1)),l(c,{type:"primary",onClick:$},{default:s(()=>t[2]||(t[2]=[_("刷新")])),_:1})])]),default:s(()=>[ne((d(),p("div",null,[k.value.length>0?(d(),q(O,{key:0,data:k.value,style:{width:"100%"}},{default:s(()=>[l(y,{prop:"title",label:"标题","min-width":"180"},{default:s(e=>[l(g,{placement:"top","show-after":500,"max-width":300},{content:s(()=>[a("div",ce,r(e.row.title),1)]),default:s(()=>[a("div",pe,r(e.row.title),1)]),_:2},1024)]),_:1}),l(y,{label:"内容","min-width":"250"},{default:s(e=>[l(g,{placement:"top","show-after":500},{content:s(()=>[a("div",me,r(e.row.content),1)]),default:s(()=>[a("div",fe,r(e.row.content),1)]),_:2},1024)]),_:1}),l(y,{prop:"created_at",label:"创建时间",width:"180"},{default:s(e=>[_(r(V(e.row.created_at)),1)]),_:1}),l(y,{label:"状态",width:"100"},{default:s(e=>[l(H,{type:z(e.row).type},{default:s(()=>[_(r(z(e.row).text),1)]),_:2},1032,["type"])]),_:1}),l(y,{label:"操作",width:"200"},{default:s(e=>[l(J,null,{default:s(()=>[l(c,{type:"primary",onClick:U=>F(e.row)},{default:s(()=>t[4]||(t[4]=[_("查看")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])):(d(),q(T,{key:1,description:"暂无分配给您的作业"}))])),[[X,x.value]])]),_:1}),l(le,{pagination:f,"onUpdate:pagination":j},null,8,["pagination"]),l(W,{modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=e=>C.value=e),title:"作业详情",width:"600px"},{default:s(()=>[o.value?(d(),p("div",ve,[a("h3",null,r(o.value.title),1),a("div",ge,[a("p",null,"创建时间: "+r(V(o.value.created_at)),1)]),a("div",ye,[l(S,{"content-position":"left"},{default:s(()=>t[5]||(t[5]=[_("作业内容")])),_:1}),a("p",null,r(o.value.content),1)]),o.value.replies&&o.value.replies.length>0?(d(),p("div",he,[l(S,{"content-position":"left"},{default:s(()=>t[6]||(t[6]=[_("回复记录")])),_:1}),(d(!0),p(ae,null,ie(o.value.replies,(e,U)=>{var L,N,B,P,R;return d(),p("div",{key:U,class:re(["reply-item",{"my-reply":e.user_id===((L=w(u).user)==null?void 0:L.user_id),"admin-reply":e.user_id!==o.value.assigned_to&&e.user_id!==((N=w(u).user)==null?void 0:N.user_id),"other-reply":e.user_id!==((B=w(u).user)==null?void 0:B.user_id)&&e.user_id===o.value.assigned_to}])},[a("div",we,[a("span",be,r(e.user_id===((P=w(u).user)==null?void 0:P.user_id)?"我":e.full_name||"未知用户"),1),e.user_id!==o.value.assigned_to&&e.user_id!==((R=w(u).user)==null?void 0:R.user_id)?(d(),p("span",xe,"管理员")):A("",!0)]),a("p",null,r(e.content),1),a("small",null,r(V(e.created_at)),1)],2)}),128))])):A("",!0),a("div",ke,[l(S,{"content-position":"left"},{default:s(()=>t[7]||(t[7]=[_("提交回复")])),_:1}),l(Q,null,{default:s(()=>[l(D,null,{default:s(()=>[l(K,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=e=>m.value=e),type:"textarea",rows:4,placeholder:"请输入您的回复内容"},null,8,["modelValue"])]),_:1}),l(D,null,{default:s(()=>[l(c,{type:"primary",onClick:I},{default:s(()=>t[8]||(t[8]=[_("提交回复")])),_:1})]),_:1})]),_:1})])])):A("",!0)]),_:1},8,["modelValue"])])}}}),ze=ue(Ce,[["__scopeId","data-v-2d0a278c"]]);export{ze as default};
