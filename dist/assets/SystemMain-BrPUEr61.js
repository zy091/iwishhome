import{H}from"./Header-DJuuJCOm.js";import{x as L,r as k,c as V,ax as z,j as O,G as c,H as n,y as f,u as _,O as v,P as e,ag as i,A as u,a6 as F,L as P,M,K as C,ay as T,z as l,aF as q}from"./vendor-kUynFKsh.js";import{u as G,s as J,b as K}from"./index-BID3odBW.js";import{e as I,f as Q,E as W}from"./elementPlus-BSeP1oVM.js";import"./supabase-CBzAt1Op.js";const X=L({__name:"Aside",setup(N){T();const m=z(),S=k(""),R=k([]),y=k(!1),d=G(),$=V(()=>d.getMenus);V(()=>m.path);const g=a=>{S.value=a,a==="/system/demand"&&B()},D=k("");O(async()=>{y.value=!0,d.fetchMenus();const{data:{session:a}}=await J.auth.getSession();D.value=(a==null?void 0:a.access_token)||"",y.value=!1});function U(a){const t=typeof a=="string"?a:JSON.stringify(a);return btoa(unescape(encodeURIComponent(t))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const B=()=>{var a,t,p,s,r,h,w,b;try{const x={id:((a=d.user)==null?void 0:a.user_id)||"",email:((t=d.user)==null?void 0:t.email)||"",name:((p=d.user)==null?void 0:p.full_name)||((r=(s=d.user)==null?void 0:s.email)==null?void 0:r.split("@")[0])||"用户",role:E((h=d.user)==null?void 0:h.role_id),rolename:(b=(w=d.user)==null?void 0:w.role)==null?void 0:b.name,origin:window.location.origin,exp:Math.floor(Date.now()/1e3)+900},o=U(x);window.open(`https://iwishneed.netlify.app/auth/bridge#external_user=${o}&main_access_token=${D.value}`,"_blank")}catch(x){console.error("处理demand跳转失败:",x),W.error("跳转失败，请稍后重试")}},E=a=>{if(!a)return"submitter";switch(a){case 0:case 1:return"admin";case 2:case 3:return"manager";case 4:case 5:return"developer";default:return"submitter"}};return(a,t)=>{const p=i("ArrowLeft"),s=i("el-icon"),r=i("el-menu-item"),h=i("InfoFilled"),w=i("DataAnalysis"),b=i("el-sub-menu"),x=i("el-menu");return l(),c(x,{class:"el-menu-vertical-demo","active-text-color":"#fff","background-color":"#05479a","text-color":"#fff",style:{position:"fixed","z-index":"999",height:"calc(100vh - 84px)",left:"0",width:"240px","overflow-y":"auto","overflow-x":"hidden"},router:!0,"unique-opened":!0,"default-active":S.value,"default-openeds":R.value,onSelect:g,loading:y.value},{default:n(()=>[_(m).name==="letter-to-employee"||_(m).name==="company-introduction"||_(m).name==="apply-for-registration"?(l(),f(v,{key:0},[e(r,{index:"/training-home"},{default:n(()=>[e(s,null,{default:n(()=>[e(p)]),_:1}),t[0]||(t[0]=u("span",null,"返回",-1))]),_:1}),e(r,{index:"/system/training-letter"},{default:n(()=>[e(s,null,{default:n(()=>[e(_(I))]),_:1}),t[1]||(t[1]=u("span",null,"致员工的一封信",-1))]),_:1}),e(r,{index:"/system/training-company"},{default:n(()=>[e(s,null,{default:n(()=>[e(_(Q))]),_:1}),t[2]||(t[2]=u("span",null,"了解艾维",-1))]),_:1}),e(r,{index:"/system/training-apply"},{default:n(()=>[e(s,null,{default:n(()=>[e(h)]),_:1}),t[3]||(t[3]=u("span",null,"申请注册",-1))]),_:1})],64)):_(m).name==="digital-marketing"||_(m).name==="website-layout"?(l(),f(v,{key:1},[e(r,{index:"/training-home"},{default:n(()=>[e(s,null,{default:n(()=>[e(p)]),_:1}),t[4]||(t[4]=u("span",null,"返回",-1))]),_:1}),e(r,{index:"/system/training-marketing"},{default:n(()=>[e(s,null,{default:n(()=>[e(_(I))]),_:1}),t[5]||(t[5]=u("span",null,"了解数字营销与品牌独立站",-1))]),_:1}),e(r,{index:"/system/training-website"},{default:n(()=>[e(s,null,{default:n(()=>[e(w)]),_:1}),t[6]||(t[6]=u("span",null,"独立站的布局及优化诊断",-1))]),_:1})],64)):(l(!0),f(v,{key:2},F($.value,o=>(l(),f(v,{key:o.id},[o.children&&o.children.length>0?(l(),c(b,{key:0,index:`/system${o.path}`},{title:n(()=>[e(s,null,{default:n(()=>[(l(),c(C(o.icon)))]),_:2},1024),u("span",null,M(o.name),1)]),default:n(()=>[(l(!0),f(v,null,F(o.children,A=>(l(),c(r,{key:A.id,index:`/system${A.path}`},{default:n(()=>[P(M(A.name),1)]),_:2},1032,["index"]))),128))]),_:2},1032,["index"])):o.path==="/demand"?(l(),c(r,{key:1,onClick:B},{default:n(()=>[e(s,null,{default:n(()=>[(l(),c(C(o.icon)))]),_:2},1024),u("span",null,M(o.name),1)]),_:2},1024)):(l(),c(r,{key:2,index:`/system${o.path}`},{default:n(()=>[e(s,null,{default:n(()=>[(l(),c(C(o.icon)))]),_:2},1024),u("span",null,M(o.name),1)]),_:2},1032,["index"]))],64))),128))]),_:1},8,["default-active","default-openeds","loading"])}}}),Y={class:"common-layout"},Z={class:"page-container"},j={class:"loading-container"},ee=L({__name:"SystemMain",setup(N){return k([]),(m,S)=>{const R=i("el-aside"),y=i("RouterView"),d=i("el-skeleton"),$=i("el-main"),g=i("el-container");return l(),f("div",Y,[e(g,{direction:"vertical",style:{height:"100vh"}},{default:n(()=>[e(H),e(g,{style:{"margin-top":"84px"}},{default:n(()=>[e(R,{width:"240px"},{default:n(()=>[e(X)]),_:1}),e(g,null,{default:n(()=>[e($,null,{default:n(()=>[u("div",Z,[(l(),c(q,null,{default:n(()=>[e(y)]),fallback:n(()=>[u("div",j,[e(d,{rows:3,animated:""})])]),_:1}))])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),se=K(ee,[["__scopeId","data-v-f490535e"]]);export{se as default};
