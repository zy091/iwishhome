import{_ as Bl,a as Il,b as Vl,c as Ql,d as Pl,e as Dl,f as Ul,g as Jl,h as Fl,i as $l,j as Yl,k as ql,l as Tl}from"./zip-KiBfUjci.js";import{x as el,c as ae,r as m,X as be,w as Ve,y as D,P as t,ag as A,H as o,G as Y,J as G,O as _e,a6 as ye,A as v,M as I,L as b,z as y,j as zl,W as Sl,u as he,I as Re,aq as Ll,a4 as Gl}from"./vendor-COQJj1AX.js";import{E as C,s as Ze,n as jl,o as Nl,c as Ie}from"./elementPlus-DvW_yQnS.js";import{s as d,_ as ll,B as Kl,b as Hl}from"./index-DLjhCPYT.js";import{J as Ol}from"./index-D0MNZufu.js";import"./supabase-ndUUYBZa.js";const Wl={class:"upload"},Xl={key:0},Rl=el({__name:"UploadMaterials",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(Qe,{emit:we}){const se=Qe,te=ae({get:()=>se.visible,set:k=>ie("update:visible",k)}),ie=we,ue=m([{value:"image",label:"图片"},{value:"video",label:"视频"},{value:"ppt",label:"PPT"},{value:"pdf",label:"PDF"},{value:"link",label:"链接"},{value:"txt",label:"文本"},{value:"word",label:"Word"},{value:"excel",label:"Excel"},{value:"zip",label:"压缩包"}]),J=m([{value:"google",label:"Google"},{value:"facebook",label:"Facebook"},{value:"microsoft",label:"Microsoft"},{value:"meta",label:"Meta"},{value:"other",label:"Other"}]),B=m([]),de=async()=>{try{const{data:k,error:c}=await d.from("ad_platforms").select("*");if(c)throw c;B.value=await Promise.all(k.map(async _=>{const{data:h,error:p}=await d.from("ad_categories").select("*").eq("platform_id",_.id);if(p)throw p;const s=await Promise.all(h.map(async U=>{const{data:T,error:w}=await d.from("ad_subcategories").select("*").eq("category_id",U.id);if(w)throw w;const z=await Promise.all(T.map(async q=>{const{data:S,error:L}=await d.from("ad_topics").select("*").eq("subcategory_id",q.id);if(L)throw L;return{...q,children:S}}));return{...U,children:z}}));return{id:_.id,name:_.name,children:s}}))}catch(k){C.error("加载文件夹结构失败："+k.message)}finally{}},f=be({title:"",type:"",platform:"",chapter:"",folderPath:[],linkUrl:""});Ve(()=>f.platform,k=>{de()});const oe=()=>{f.title="",f.type="",f.platform="",f.chapter="",f.folderPath=[],f.linkUrl="",H.value=[],j.value=null},H=m([]),j=m(null),R=m(!1),ve=k=>{const c=["image/png","image/jpeg","image/webp","video/mp4","application/pdf","application/vnd.ms-powerpoint","text/plain","text/csv","text/html","text/xml","application/json","application/xml","application/octet-stream","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],_=k.raw&&c.includes(k.raw.type),h=k.raw&&k.raw.size/1024/1024<100;if(!_)return C.error("文件类型不支持！"),!1;if(!h)return C.error("文件大小超过 10MB 限制！"),!1;j.value=k.raw,console.log(j.value)},ce=async()=>{var k;if(f.type==="link"&&!f.linkUrl){C.warning("请输入链接地址");return}if(f.type!=="link"&&!j.value){C.warning("请选择文件");return}R.value=!0;try{await V(f.type==="link"?null:j.value,{title:f.title,platform:f.platform,type:f.type},f.type==="link"?f.title:((k=j.value)==null?void 0:k.name)||"")&&(C.success("上传成功！"),oe())}catch(c){C.error(`上传失败: ${c.message}`)}finally{R.value=!1}},V=async(k,c,_)=>{try{let h="";if(c.type==="link")h=f.linkUrl;else{if(!k)throw new Error("未选择文件");const w=k.name.split(".").pop(),z=`${Date.now()}-${Math.random().toString(36).slice(2)}.${w}`,{data:q,error:S}=await d.storage.from("materials").upload(`documents/${z}`,k);if(S)throw S;const{data:L}=d.storage.from("materials").getPublicUrl(q.path);h=L.publicUrl}const p=["platform_id","category_id","subcategory_id","topic_id"],{data:s,error:U}=await d.from("study_materials").insert({...c,[p[f.folderPath.length-1]]:f.folderPath[f.folderPath.length-1]}).select("id").single();if(U)throw U;const{error:T}=await d.from("material_contents").insert({material_id:s.id,title:c.title,content:h,content_type:c.type});if(T)throw T;return console.log("文件上传并关联成功！"),h}catch(h){return console.error("操作失败:",h.message),null}};return(k,c)=>{const _=A("el-input"),h=A("el-form-item"),p=A("el-option"),s=A("el-select"),U=A("el-empty"),T=A("el-cascader"),w=A("upload-filled"),z=A("el-icon"),q=A("el-upload"),S=A("el-button"),L=A("el-form"),re=A("el-dialog");return y(),D("div",Wl,[t(re,{onClose:c[5]||(c[5]=M=>ie("update:visible",!1)),modelValue:te.value,"onUpdate:modelValue":c[6]||(c[6]=M=>te.value=M),title:"资料上传",width:"50%"},{default:o(()=>[t(L,{model:f,"label-width":"auto",style:{"max-width":"600px",margin:"50px 30px"}},{default:o(()=>[t(h,{label:"文件标题"},{default:o(()=>[t(_,{size:"large",modelValue:f.title,"onUpdate:modelValue":c[0]||(c[0]=M=>f.title=M),placeholder:"输入文件标题"},null,8,["modelValue"])]),_:1}),t(h,{label:"文件类型"},{default:o(()=>[t(s,{size:"large",modelValue:f.type,"onUpdate:modelValue":c[1]||(c[1]=M=>f.type=M),placeholder:"选择文件类型"},{default:o(()=>[(y(!0),D(_e,null,ye(ue.value,(M,N)=>(y(),Y(p,{label:M.label,value:M.value,key:N},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"文件所属平台"},{default:o(()=>[t(s,{size:"large",modelValue:f.platform,"onUpdate:modelValue":c[2]||(c[2]=M=>f.platform=M),placeholder:"选择平台"},{default:o(()=>[(y(!0),D(_e,null,ye(J.value,(M,N)=>(y(),Y(p,{label:M.label,value:M.value,key:N},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"选择文件夹"},{default:o(()=>[t(T,{size:"large",modelValue:f.folderPath,"onUpdate:modelValue":c[3]||(c[3]=M=>f.folderPath=M),options:B.value,props:{checkStrictly:!0,emitPath:!0,value:"id",label:"name",children:"children"},clearable:"",placeholder:"请选择资料存放位置",style:{width:"100%"}},{default:o(({node:M,data:N})=>[v("span",null,I(N.name),1),M.isLeaf?G("",!0):(y(),D("span",Xl," ("+I(N.children.length)+") ",1))]),empty:o(()=>[t(U,{description:"暂无数据，先选择平台"})]),_:1},8,["modelValue","options"])]),_:1}),f.type==="link"?(y(),Y(h,{key:0,label:"链接地址"},{default:o(()=>[t(_,{size:"large",modelValue:f.linkUrl,"onUpdate:modelValue":c[4]||(c[4]=M=>f.linkUrl=M),placeholder:"请输入链接地址"},null,8,["modelValue"])]),_:1})):G("",!0),f.type!=="link"?(y(),Y(h,{key:1,label:"文件上传"},{default:o(()=>[t(q,{class:"upload-box","auto-upload":!1,"on-change":ve,"file-list":H.value,limit:1,drag:"",action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15",multiple:""},{tip:o(()=>c[7]||(c[7]=[v("div",{class:"el-upload__tip"},"支持所有文本型、图片、视频等文件，且不超过 100MB",-1)])),default:o(()=>[t(z,{class:"el-icon--upload"},{default:o(()=>[t(w)]),_:1}),c[8]||(c[8]=v("div",{class:"el-upload__text"},[b(" 拖拽文件或"),v("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})):G("",!0),t(h,null,{default:o(()=>[t(S,{type:"primary",loading:R.value,onClick:ce},{default:o(()=>c[9]||(c[9]=[b("开始上传")])),_:1},8,["loading"]),t(S,{onClick:oe},{default:o(()=>c[10]||(c[10]=[b("清空内容")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Zl=ll(Rl,[["__scopeId","data-v-a6ece109"]]),ea={class:"layout"},la={class:"materials-content"},aa={class:"card-header"},ta={class:"header-actions"},oa={style:{"font-size":"14px",color:"#909399"}},ra={class:"dialog-content"},na={class:"material-details"},sa={class:"material-header"},ia={class:"material-title"},ua={class:"material-actions"},da={class:"material-preview"},ca=["src"],fa=["src"],pa=["src"],va=["src"],ma={key:4,class:"link-preview"},ga={key:5,class:"video-preview"},_a=["src"],ya={key:6,class:"text-preview"},Aa=["innerHTML"],ha={key:7,class:"material-download"},ba={class:"fullscreen-preview"},wa=["src"],Ca=["src"],ka=["src"],xa={key:0},Ea=el({__name:"AdminMaterialAndFolders",setup(Qe){const we=be([{name:"数据管理",path:"/system/data-management"},{name:"学习资料管理",path:"/system/admin-material"}]),se=m("materials"),te=m(!1),ie=m([]),ue=m(!1),J=m(null),B=m(""),de=m(""),f=m(""),oe=m(""),H=m([]),j=m(!1),R=m(!1),ve=m(!1),ce=m(""),V=m(!1),k=m(""),c=m(""),_=m(null),h=m(null),p=m(null),s=m([]),U=m([]),T=m(!1),w=m(null),z=m([]),q=m(new Map),S=m(new Map),L=m(new Map),re=m(new Map),M=ae(()=>{var e;return((e=J.value)==null?void 0:e.type)==="image"}),N=ae(()=>{var e;return((e=J.value)==null?void 0:e.type)==="pdf"}),Ce=ae(()=>{var e;return((e=J.value)==null?void 0:e.type)==="word"}),Pe=ae(()=>{var e;return((e=J.value)==null?void 0:e.type)==="link"}),De=ae(()=>{var e;return((e=J.value)==null?void 0:e.type)==="video"}),Ue=ae(()=>{var e;return((e=J.value)==null?void 0:e.type)==="txt"}),me=ae(()=>{var e;return((e=J.value)==null?void 0:e.type)==="excel"}),al=()=>M.value?"预览图片":N.value?"预览PDF":Ce.value?"预览Word":me.value?"预览Excel":Pe.value?"打开链接":De.value?"预览视频":Ue.value?"预览文本":"查看文件",Q=be({name:"",platform:"",folderPath:[]}),Je=[{value:"image",label:"图片"},{value:"video",label:"视频"},{value:"ppt",label:"PPT"},{value:"pdf",label:"PDF"},{value:"link",label:"链接"},{value:"txt",label:"文本"},{value:"word",label:"Word"},{value:"excel",label:"Excel"},{value:"zip",label:"压缩包"}],Fe=[{value:"google",label:"Google"},{value:"facebook",label:"Facebook"},{value:"microsoft",label:"Microsoft"},{value:"meta",label:"Meta"},{value:"other",label:"Other"}],W=be({page:1,pageSize:10,total:0}),$e=m(null);let F=null;const tl=()=>{j.value=!0},ol=e=>{j.value=e,e||fe()},rl=e=>{W.page=e.page,W.pageSize=e.pageSize,fe()},fe=async()=>{te.value=!0;try{let e=d.from("study_materials").select(`
                *,
                platform_info:ad_platforms(name),
                category_info:ad_categories(name),
                subcategory_info:ad_subcategories(name),
                topic_info:ad_topics(name)
            `,{count:"exact"});de.value&&(e=e.ilike("title",`%${de.value}%`)),f.value&&(e=e.eq("type",f.value)),oe.value&&(e=e.eq("platform",oe.value));const{data:l,error:a,count:n}=await e.order("created_at",{ascending:!1}).range((W.page-1)*W.pageSize,W.page*W.pageSize-1);if(a)throw a;ie.value=l,W.total=n||0}catch(e){C.error("搜索学习资料失败"),console.error(e)}finally{te.value=!1}},Ye=async e=>{J.value=e,ue.value=!0,F&&(F.destruct(),F=null),e.type!=="link"&&e.type!=="video"&&e.type!=="pdf"&&$e.value&&(F=Ol.make($e.value,{height:500,readonly:!0,toolbar:!1,statusbar:!1,language:"zh_cn",uploader:{insertImageAsBase64URI:!0}}),F.value='<div style="text-align: center; padding: 50px;">文件加载中，请稍候...</div>');try{const{data:l,error:a}=await d.from("material_contents").select("*").eq("material_id",e.id).single();if(a)throw a;if(console.log("Material content data:",l),e.type==="link"||e.type==="video"||e.type==="pdf"||e.type==="ppt"||e.type==="word"||e.type==="excel")B.value=l.content;else{const n=l.content;console.log("Attempting to fetch file from path:",n);const u=l.content.split("/materials/").pop();try{if(e.type==="txt"){const{data:i,error:g}=await d.storage.from("materials").download(u);if(g)throw g;const P=await i.text();B.value=P,F&&(F.value=B.value)}else if(e.type==="image"){const{data:{publicUrl:i}}=await d.storage.from("materials").getPublicUrl(u);B.value=i,F&&(F.value=`<img src="${i}" alt="${e.title}" style="max-width: 100%;">`)}else{const{data:{publicUrl:i}}=await d.storage.from("materials").getPublicUrl(u);B.value=i,F&&(F.value=`
                            <div style="text-align: center; padding: 20px;">
                                <p>此文件类型不支持直接预览</p>
                                <a href="${i}" target="_blank" class="el-button el-button--primary">
                                    下载文件
                                </a>
                            </div>
                        `)}}catch(i){throw console.error("Storage error:",i),C.error(`无法获取文件: ${i.message}`),i;F&&(F.value=`
                        <div style="color: red; text-align: center; padding: 20px;">
                            <p>文件加载失败: ${i.message||"未知错误"}</p>
                        </div>
                    `)}}}catch(l){console.error("获取资料内容失败:",l),B.value="",C.error("获取文件内容失败"),F&&(F.value=`
                <div style="color: red; text-align: center; padding: 20px;">
                    <p>无法获取文件信息</p>
                </div>
            `)}},nl=()=>{B.value&&((Ce.value||me.value)&&(ce.value=`https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(B.value)}`),R.value=!0)},qe=()=>{ve.value=!0},sl=()=>{B.value&&window.open(B.value,"_blank")},il=()=>{B.value&&window.open(B.value,"_blank")},Te=async e=>{try{await Ie.confirm(`确定要删除资料 "${e.title}" 吗？此操作不可恢复。`,"警告",{type:"warning"});const{error:l}=await d.from("material_contents").delete().eq("material_id",e.id);if(l)throw l;const{error:a}=await d.from("study_materials").delete().eq("id",e.id);if(a)throw a;C.success("删除成功"),fe()}catch(l){l!=="cancel"&&(console.error("删除资料失败:",l),C.error("删除失败"))}},ul=async()=>{if(H.value.length!==0)try{await Ie.confirm(`确定要删除选中的 ${H.value.length} 个资料吗？此操作不可恢复。`,"警告",{type:"warning"});const e=H.value.map(n=>n.id),{error:l}=await d.from("material_contents").delete().in("material_id",e);if(l)throw l;const{error:a}=await d.from("study_materials").delete().in("id",e);if(a)throw a;C.success(`成功删除 ${H.value.length} 个资料`),H.value=[],fe()}catch(e){e!=="cancel"&&(console.error("批量删除资料失败:",e),C.error("批量删除失败"))}},dl=e=>{H.value=e},cl=()=>new URL("data:image/png;base64,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",import.meta.url).href,ke=e=>new URL(Object.assign({"/src/assets/icons/excel.png":Tl,"/src/assets/icons/file.png":ql,"/src/assets/icons/image.png":Yl,"/src/assets/icons/link.png":$l,"/src/assets/icons/music.png":Fl,"/src/assets/icons/pdf.png":Jl,"/src/assets/icons/ppt.png":Ul,"/src/assets/icons/reading.png":Dl,"/src/assets/icons/select.png":Pl,"/src/assets/icons/txt.png":Ql,"/src/assets/icons/video.png":Vl,"/src/assets/icons/word.png":Il,"/src/assets/icons/zip.png":Bl})[`/src/assets/icons/${e||"file"}.png`],import.meta.url).href,fl=e=>e?new Date(e).toLocaleString():"",xe=async()=>{V.value=!0;try{s.value=[],p.value=null,_.value=null,h.value=null;const e="root",l=q.value.get(e);if(l){U.value=l;return}const{data:a,error:n}=await d.from("ad_platforms").select("*").order("name");if(n)throw n;const u=a.map(i=>({...i,is_folder:!0}));U.value=u,q.value.set(e,u)}catch(e){console.error("加载平台列表失败:",e),C.error("加载平台列表失败")}finally{V.value=!1}},pl=async()=>{V.value=!0;try{if(s.value=[],p.value=null,k.value){const{data:e,error:l}=await d.from("ad_platforms").select("*").eq("platform",k.value).single();if(l)throw l;_.value=e.id,h.value=e.name}else _.value=null,h.value=null;await X()}catch(e){C.error("加载文件夹结构失败"),console.error(e)}finally{V.value=!1}},X=async()=>{V.value=!0;try{let e,l;const n=_.value?s.value.length===1?`platform_${_.value}`:s.value.length===2?`category_${p.value}`:s.value.length===3?`subcategory_${p.value}`:`topic_${p.value}`:"root",u=q.value.get(n),i=S.value.get(n);if(!_.value){if(u){U.value=u,V.value=!1;return}const{data:O,error:ee}=await d.from("ad_platforms").select("*").order("name");if(ee)throw ee;const ne=O.map(x=>({...x,is_folder:!0}));U.value=ne,q.value.set(n,ne),V.value=!1;return}if(u&&i){U.value=[...u,...i],V.value=!1;return}s.value.length===1?(e=d.from("ad_categories").select("*").eq("platform_id",_.value).order("sort_order, name"),l=d.from("study_materials").select("*").eq("platform_id",_.value).is("category_id",null).order("title")):s.value.length===2?(e=d.from("ad_subcategories").select("*").eq("category_id",p.value).order("sort_order, name"),l=d.from("study_materials").select("*").eq("category_id",p.value).is("subcategory_id",null).order("title")):s.value.length===3?(e=d.from("ad_topics").select("*").eq("subcategory_id",p.value).order("sort_order, name"),l=d.from("study_materials").select("*").eq("subcategory_id",p.value).is("topic_id",null).order("title")):(e=null,l=d.from("study_materials").select("*").eq("topic_id",p.value).order("title"));const[g,P]=await Promise.all([e||Promise.resolve({data:[],error:null}),l]);if(g!=null&&g.error)throw g.error;if(P.error)throw P.error;const E=((g==null?void 0:g.data)||[]).map(O=>({...O,is_folder:!0})),K=(P.data||[]).map(O=>({...O,is_folder:!1}));q.value.set(n,E),S.value.set(n,K),U.value=[...E,...K]}catch(e){console.error("加载失败:",e),C.error("加载失败")}finally{V.value=!1}},ze=async e=>{var l;if(e.is_folder){if(c.value.trim()&&e.folder_level){if(c.value="",s.value=[],e.folder_level==="platform")_.value=e.id,h.value=e.name,s.value.push(e),p.value=e.id;else if(e.folder_level==="category"){if(e.platform_id)try{const{data:a,error:n}=await d.from("ad_platforms").select("*").eq("id",e.platform_id).single();if(n)throw n;_.value=a.id,h.value=a.name,s.value.push(a),s.value.push(e),p.value=e.id}catch(a){console.error("获取平台信息失败:",a),_.value=null,h.value=null}}else if(e.folder_level==="subcategory"){if(e.category_id)try{const{data:a,error:n}=await d.from("ad_categories").select("*, platform:ad_platforms(*)").eq("id",e.category_id).single();if(n)throw n;a.platform&&(_.value=a.platform.id,h.value=a.platform.name,s.value.push(a.platform)),s.value.push(a),s.value.push(e),p.value=e.id}catch(a){console.error("获取分类信息失败:",a),_.value=null,h.value=null}}else if(e.folder_level==="topic"&&e.subcategory_id)try{const{data:a,error:n}=await d.from("ad_subcategories").select("*, category:ad_categories(*, platform:ad_platforms(*))").eq("id",e.subcategory_id).single();if(n)throw n;(l=a.category)!=null&&l.platform&&(_.value=a.category.platform.id,h.value=a.category.platform.name,s.value.push(a.category.platform)),a.category&&s.value.push(a.category),s.value.push(a),s.value.push(e),p.value=e.id}catch(a){console.error("获取子分类信息失败:",a),_.value=null,h.value=null}await X();return}s.value.length===0?(_.value=e.id,h.value=e.name,s.value.push(e),p.value=e.id):(s.value.length===1||s.value.length,s.value.push(e),p.value=e.id),await X()}else e.type&&Ye(e)},vl=async()=>{s.value.length>0&&(s.value.pop(),s.value.length===0?(p.value=null,_.value=null,h.value=null):p.value=s.value[s.value.length-1].id,await X())},ml=async()=>{s.value=[],p.value=null,_.value=null,h.value=null,await X()},gl=async e=>{const l=s.value.findIndex(a=>a.id===e.id);l>=0&&(s.value=s.value.slice(0,l+1),p.value=e.id,await X())},_l=async e=>{try{if(!await yl(e)){C.warning(`无法删除，${e.is_folder?"文件夹可能包含子项":"无权删除此文件"}`);return}if(await Ie.confirm(`确定要删除${e.is_folder?"文件夹":"文件"} "${e.is_folder?e.name:e.title}" 吗？此操作不可恢复。`,"警告",{type:"warning"}),e.is_folder){V.value=!0;let a="",n="id",u=e.id;console.log("准备删除文件夹:",e);try{if(e.folder_level==="platform"||s.value.length===0&&!e.folder_level)a="ad_categories",n="id",console.log("删除类型: 分类, ID:",u);else if(e.folder_level==="category"||s.value.length===1&&!e.folder_level)a="ad_subcategories",n="id",console.log("删除类型: 子分类, ID:",u);else if(e.folder_level==="subcategory"||s.value.length===2&&!e.folder_level)a="ad_topics",n="id",console.log("删除类型: 主题, ID:",u);else throw new Error("未知的文件夹类型");console.log(`开始删除 ${a} 表中 ${n}=${u} 的记录`);const{data:i,error:g}=await d.from(a).select("id").eq(n,u).limit(1);if(g)throw console.error("检查记录是否存在失败:",g),g;if(!i||i.length===0){console.warn("要删除的记录不存在"),C.warning("要删除的记录不存在"),V.value=!1;return}const{error:P}=await d.from(a).delete().eq(n,u);if(P)throw console.error(`删除 ${a} 失败:`,P),P;const{data:E,error:K}=await d.from(a).select("id").eq(n,u).limit(1);if(K&&console.warn("验证删除结果时出错:",K),E&&E.length>0){console.error("删除操作执行了但记录仍然存在"),C.error("删除未成功，请刷新页面后重试"),V.value=!1;return}Z(),await X(),C.success("删除成功")}catch(i){console.error("删除过程中出错:",i),C.error(`删除失败: ${i.message||"未知错误"}`)}finally{V.value=!1}}else await Te(e),je()}catch(l){l!=="cancel"&&(console.error("删除操作失败:",l),C.error("删除失败，请检查是否有关联的资料"))}},yl=async e=>{if(!e.is_folder)return!0;const l=`delete_${e.id}`;if(L.value.has(l))return L.value.get(l);try{let a=!1;if(console.log("检查文件夹是否可删除:",e.id,e.name,"当前路径层级:",s.value.length),e.folder_level==="platform"||s.value.length===0&&!e.folder_level){const{count:n,error:u}=await d.from("ad_categories").select("*",{count:"exact"}).eq("platform_id",e.id);if(u)throw u;console.log("平台下分类数量:",n);const{count:i,error:g}=await d.from("study_materials").select("*",{count:"exact"}).eq("platform_id",e.id).is("category_id",null);if(g)throw g;console.log("平台直接关联的资料数量:",i),a=n===0&&i===0}else if(e.folder_level==="category"||s.value.length===1&&!e.folder_level){const{count:n,error:u}=await d.from("ad_subcategories").select("*",{count:"exact"}).eq("category_id",e.id);if(u)throw u;console.log("分类下子分类数量:",n);const{count:i,error:g}=await d.from("study_materials").select("*",{count:"exact"}).eq("category_id",e.id).is("subcategory_id",null);if(g)throw g;console.log("分类下直接关联的资料数量:",i),a=n===0&&i===0}else if(e.folder_level==="subcategory"||s.value.length===2&&!e.folder_level){const{count:n,error:u}=await d.from("ad_topics").select("*",{count:"exact"}).eq("subcategory_id",e.id);if(u)throw u;console.log("子分类下主题数量:",n);const{count:i,error:g}=await d.from("study_materials").select("*",{count:"exact"}).eq("subcategory_id",e.id).is("topic_id",null);if(g)throw g;console.log("子分类下直接关联的资料数量:",i),a=n===0&&i===0}else if(e.folder_level==="topic"||s.value.length===3&&!e.folder_level){const{count:n,error:u}=await d.from("study_materials").select("*",{count:"exact"}).eq("topic_id",e.id);if(u)throw u;console.log("主题下资料数量:",n),a=n===0}return console.log("文件夹是否可删除结果:",a),L.value.set(l,a),a}catch(a){return console.error("检查删除权限失败:",a),!1}},Se=(e=null)=>{var l;w.value=e,Q.name="",Q.platform=k.value,Q.folderPath=[],console.log("showCreateFolderDialog 参数:",e?"有folder":"无folder"),console.log("parentFolder.value:",w.value),e?(console.log("在特定文件夹下创建子文件夹:",e),z.value=[],e.folder_level==="platform"||!e.folder_level&&s.value.length===0?Q.folderPath=[e.id]:e.folder_level==="category"||!e.folder_level&&s.value.length===1?Q.folderPath=[e.id]:(e.folder_level==="subcategory"||!e.folder_level&&s.value.length===2)&&(Q.folderPath=[(l=s.value[1])==null?void 0:l.id,e.id])):(console.log("从顶部按钮创建，加载文件夹路径选择器"),bl()),setTimeout(()=>{T.value=!0},100)},Al=async()=>{if(!Q.name){C.warning("请输入文件夹名称");return}if(!w.value&&Q.folderPath.length===0){C.warning("请选择文件夹位置");return}V.value=!0;try{let e,l=Q.folderPath;if(w.value){if(console.log("使用预设路径创建文件夹:",l),w.value.folder_level==="platform"||!w.value.folder_level&&s.value.length===0){const{data:a,error:n}=await d.from("ad_categories").insert({name:Q.name,platform_id:w.value.id,sort_order:0}).select();if(n)throw n;e=a,Z(`platform_${w.value.id}`)}else if(w.value.folder_level==="category"||!w.value.folder_level&&s.value.length===1){const{data:a,error:n}=await d.from("ad_subcategories").insert({name:Q.name,category_id:w.value.id,sort_order:0}).select();if(n)throw n;e=a,Z(`category_${w.value.id}`)}else if(w.value.folder_level==="subcategory"||!w.value.folder_level&&s.value.length===2){const{data:a,error:n}=await d.from("ad_topics").insert({name:Q.name,subcategory_id:w.value.id,sort_order:0}).select();if(n)throw n;e=a,Z(`subcategory_${w.value.id}`)}}else if(l.length===1){const a=l[0],{data:n,error:u}=await d.from("ad_categories").insert({name:Q.name,platform_id:a,sort_order:0}).select();if(u)throw u;e=n,Z(`platform_${a}`)}else if(l.length===2){const a=l[0],{data:n,error:u}=await d.from("ad_subcategories").insert({name:Q.name,category_id:a,sort_order:0}).select();if(u)throw u;e=n,Z(`category_${a}`)}else if(l.length===3){const a=l[1],{data:n,error:u}=await d.from("ad_topics").insert({name:Q.name,subcategory_id:a,sort_order:0}).select();if(u)throw u;e=n,Z(`subcategory_${a}`)}else throw new Error("无法在当前层级创建文件夹");C.success("创建成功"),T.value=!1,je()}catch(e){console.error("创建文件夹失败:",e),C.error(`创建失败: ${e.message||"文件夹最多只能有3级"}`)}finally{V.value=!1}},Le=e=>{const l=Je.find(a=>a.value===e);return(l==null?void 0:l.label)||e},Ge=e=>{const l=Fe.find(a=>a.value===e);return(l==null?void 0:l.label)||e},Ee=e=>{var a,n,u,i;if(!e)return"";const l=[];return(a=e.platform_info)!=null&&a.name&&l.push(e.platform_info.name),(n=e.category_info)!=null&&n.name&&l.push(e.category_info.name),(u=e.subcategory_info)!=null&&u.name&&l.push(e.subcategory_info.name),(i=e.topic_info)!=null&&i.name&&l.push(e.topic_info.name),l.join(" > ")||"根目录"},hl=e=>{const l=Ee(e);return l.length>30?l.substring(0,27)+"...":l},bl=async()=>{const e=k.value?`folder_options_${k.value}_${_.value||""}_${p.value||""}`:"folder_options_all";if(re.value.has(e)){z.value=re.value.get(e)||[];return}try{const{data:l,error:a}=await d.from("ad_platforms").select("*").order("name");if(a)throw a;const n=l.map(u=>({id:u.id,name:u.name,children:[]}));if(z.value=n,k.value&&_.value)try{const{data:u}=await d.from("ad_categories").select("*").eq("platform_id",_.value).order("name"),i=n.findIndex(g=>g.id===_.value);if(i>=0&&u&&(n[i].children=u.map(g=>({id:g.id,name:g.name,children:[]})),s.value.length===1&&p.value)){const{data:g}=await d.from("ad_subcategories").select("*").eq("category_id",p.value).order("name"),P=n[i].children.findIndex(E=>E.id===p.value);P>=0&&g&&(n[i].children[P].children=g.map(E=>({id:E.id,name:E.name,children:[]})))}}catch(u){console.error("获取分类失败:",u)}re.value.set(e,n),z.value=n}catch(l){console.error("加载文件夹选项失败:",l),C.error("加载文件夹结构失败"),z.value=[]}},Z=e=>{e?(q.value.delete(e),S.value.delete(e),L.value.clear(),re.value.clear()):(q.value.clear(),S.value.clear(),L.value.clear(),re.value.clear())},je=()=>{Z(_.value?s.value.length===1?`platform_${_.value}`:s.value.length===2?`category_${p.value}`:s.value.length===3?`subcategory_${p.value}`:`topic_${p.value}`:"root"),X()},Ne=async()=>{if(!c.value.trim()){s.value.length===0&&xe();return}V.value=!0;try{const e=[],{data:l,error:a}=await d.from("ad_platforms").select("*").ilike("name",`%${c.value}%`).order("name");if(a)throw a;const n=l.map(x=>({...x,is_folder:!0,folder_level:"platform"}));e.push(...n);const{data:u,error:i}=await d.from("ad_categories").select("*, platform:ad_platforms(name)").ilike("name",`%${c.value}%`).order("name");if(i)throw i;const g=u.map(x=>({...x,is_folder:!0,folder_level:"category",path_info:x.platform?`${x.platform.name} > ${x.name}`:x.name}));e.push(...g);const{data:P,error:E}=await d.from("ad_subcategories").select("*, category:ad_categories(name, platform:ad_platforms(name))").ilike("name",`%${c.value}%`).order("name");if(E)throw E;const K=P.map(x=>{var le;return{...x,is_folder:!0,folder_level:"subcategory",path_info:x.category?`${((le=x.category.platform)==null?void 0:le.name)||""} > ${x.category.name} > ${x.name}`:x.name}});e.push(...K);const{data:O,error:ee}=await d.from("ad_topics").select("*, subcategory:ad_subcategories(name, category:ad_categories(name, platform:ad_platforms(name)))").ilike("name",`%${c.value}%`).order("name");if(ee)throw ee;const ne=O.map(x=>{var le,ge,pe;return{...x,is_folder:!0,folder_level:"topic",path_info:x.subcategory?`${((ge=(le=x.subcategory.category)==null?void 0:le.platform)==null?void 0:ge.name)||""} > ${((pe=x.subcategory.category)==null?void 0:pe.name)||""} > ${x.subcategory.name} > ${x.name}`:x.name}});e.push(...ne),U.value=e}catch(e){console.error("搜索文件夹失败:",e),C.error("搜索文件夹失败")}finally{V.value=!1}};zl(()=>{fe(),se.value==="folders"&&xe()});const Ke=m(!1);Ve(se,e=>{e==="folders"&&!Ke.value&&U.value.length===0&&(xe(),Ke.value=!0)});let Me=null;return Ve(k,(e,l)=>{Me&&clearTimeout(Me),e!==l&&(Me=setTimeout(()=>{e?pl():(_.value=null,h.value=null,s.value=[],p.value=null,X())},300))}),Sl(()=>{F&&F.destruct()}),(e,l)=>{const a=A("el-input"),n=A("el-option"),u=A("el-select"),i=A("el-button"),g=A("el-space"),P=A("el-card"),E=A("el-table-column"),K=A("el-image"),O=A("el-tooltip"),ee=A("el-button-group"),ne=A("el-table"),x=A("el-empty"),le=A("el-tab-pane"),ge=A("el-icon"),pe=A("el-text"),wl=A("el-breadcrumb-item"),Cl=A("el-breadcrumb"),kl=A("el-tabs"),Ae=A("el-dialog"),Be=A("el-form-item"),xl=A("el-cascader"),El=A("el-tag"),Ml=A("el-form"),He=Ll("loading");return y(),D("div",ea,[t(Kl,{breadbcrum:we},null,8,["breadbcrum"]),l[44]||(l[44]=v("div",{class:"layout-title"},[v("h1",{class:"title"},"学习资料管理")],-1)),t(kl,{modelValue:se.value,"onUpdate:modelValue":l[6]||(l[6]=r=>se.value=r),class:"tabs-container"},{default:o(()=>[t(le,{label:"资料管理",name:"materials"},{default:o(()=>[t(P,{shadow:"always",style:{"margin-bottom":"20px"}},{default:o(()=>[t(g,{wrap:"",alignment:"start",size:30},{default:o(()=>[t(a,{modelValue:de.value,"onUpdate:modelValue":l[0]||(l[0]=r=>de.value=r),style:{width:"240px"},placeholder:"请输入资料标题","suffix-icon":he(Ze),size:"large",clearable:""},null,8,["modelValue","suffix-icon"]),t(u,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=r=>f.value=r),placeholder:"文件类型",clearable:"",style:{width:"180px"},size:"large"},{default:o(()=>[(y(),D(_e,null,ye(Je,r=>t(n,{key:r.value,label:r.label,value:r.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),t(u,{modelValue:oe.value,"onUpdate:modelValue":l[2]||(l[2]=r=>oe.value=r),placeholder:"平台",clearable:"",style:{width:"180px"},size:"large"},{default:o(()=>[(y(),D(_e,null,ye(Fe,r=>t(n,{key:r.value,label:r.label,value:r.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),t(i,{type:"primary",size:"large",onClick:fe},{default:o(()=>l[17]||(l[17]=[b("搜索")])),_:1}),t(i,{type:"primary",size:"large",onClick:tl},{default:o(()=>l[18]||(l[18]=[b("资料上传")])),_:1})]),_:1})]),_:1}),v("div",la,[t(P,{style:{"min-height":"400px"}},{header:o(()=>[v("div",aa,[l[20]||(l[20]=b(" 学习资料列表 ")),v("div",ta,[t(i,{type:"danger",disabled:!H.value.length,onClick:ul},{default:o(()=>l[19]||(l[19]=[b(" 批量删除 ")])),_:1},8,["disabled"]),v("div",oa,"共计 "+I(W.total)+" 条数据",1)])])]),default:o(()=>[Re((y(),Y(ne,{data:ie.value,onSelectionChange:dl},{default:o(()=>[t(E,{type:"selection",width:"55"}),t(E,{label:"类型",width:"80"},{default:o(({row:r})=>[t(K,{style:{width:"30px",height:"30px"},src:ke(r.type),fit:"contain"},null,8,["src"])]),_:1}),t(E,{prop:"title",label:"标题"}),t(E,{prop:"platform",label:"平台"},{default:o(({row:r})=>[b(I(Ge(r.platform)),1)]),_:1}),t(E,{label:"所在位置"},{default:o(({row:r})=>[t(O,{effect:"dark",content:Ee(r),placement:"top"},{default:o(()=>[v("span",null,I(hl(r)),1)]),_:2},1032,["content"])]),_:1}),t(E,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:r})=>[b(I(new Date(r.created_at).toLocaleString()),1)]),_:1}),t(E,{label:"操作",width:"180",fixed:"right"},{default:o(({row:r})=>[t(ee,null,{default:o(()=>[t(i,{type:"primary",onClick:$=>Ye(r)},{default:o(()=>l[21]||(l[21]=[b("查看")])),_:2},1032,["onClick"]),t(i,{type:"danger",onClick:$=>Te(r)},{default:o(()=>l[22]||(l[22]=[b("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[He,te.value]]),!te.value&&ie.value.length===0?(y(),Y(x,{key:0,description:"暂无学习资料"})):G("",!0)]),_:1}),t(Hl,{pagination:W,"onUpdate:pagination":rl},null,8,["pagination"])])]),_:1}),t(le,{label:"文件夹管理",name:"folders"},{default:o(()=>[t(P,{style:{"margin-bottom":"20px"}},{default:o(()=>[t(g,{alignment:"start",size:30},{default:o(()=>[t(a,{modelValue:c.value,"onUpdate:modelValue":l[3]||(l[3]=r=>c.value=r),placeholder:"搜索文件夹名称",clearable:"",style:{width:"240px"},size:"large",onKeyup:Gl(Ne,["enter"]),"suffix-icon":he(Ze)},null,8,["modelValue","suffix-icon"]),t(i,{type:"primary",size:"large",onClick:Ne},{default:o(()=>l[23]||(l[23]=[b("搜索")])),_:1}),t(i,{type:"primary",size:"large",onClick:Se},{default:o(()=>l[24]||(l[24]=[b("新建文件夹")])),_:1})]),_:1})]),_:1}),t(P,{class:"folder-breadcrumb",style:{"margin-bottom":"20px"}},{default:o(()=>[t(pe,{onClick:l[4]||(l[4]=r=>vl()),style:{cursor:"pointer","margin-right":"10px"}},{default:o(()=>[t(ge,{size:16,color:"#000"},{default:o(()=>[t(he(jl))]),_:1})]),_:1}),t(pe,{onClick:l[5]||(l[5]=r=>ml()),style:{cursor:"pointer","margin-right":"10px"}},{default:o(()=>[t(ge,{size:16,color:"#000"},{default:o(()=>[t(he(Nl))]),_:1})]),_:1}),t(Cl,{separator:"/"},{default:o(()=>[(y(!0),D(_e,null,ye(s.value,r=>(y(),Y(wl,{key:r.id,onClick:$=>gl(r)},{default:o(()=>[b(I(r.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),Re((y(),Y(P,{style:{"min-height":"400px"}},{header:o(()=>l[25]||(l[25]=[v("div",{class:"card-header"}," 文件夹列表 ",-1)])),default:o(()=>[t(ne,{data:U.value,style:{width:"100%"}},{default:o(()=>[t(E,{label:"",width:"60"},{default:o(({row:r})=>[t(K,{style:{width:"24px",height:"24px"},src:r.is_folder?cl():ke(r.type),fit:"contain"},null,8,["src"])]),_:1}),t(E,{prop:"name",label:"名称"},{default:o(({row:r})=>[t(pe,{class:"folder-title",onClick:$=>ze(r)},{default:o(()=>[b(I(r.is_folder?r.name:r.title),1)]),_:2},1032,["onClick"])]),_:1}),c.value.trim()?(y(),Y(E,{key:0,prop:"path_info",label:"路径"},{default:o(({row:r})=>[r.path_info?(y(),Y(O,{key:0,effect:"dark",content:r.path_info||"",placement:"top"},{default:o(()=>{var $;return[v("span",null,I((($=r.path_info)==null?void 0:$.length)>30?r.path_info.substring(0,27)+"...":r.path_info),1)]}),_:2},1032,["content"])):G("",!0)]),_:1})):G("",!0),t(E,{prop:"type",label:"类型"},{default:o(({row:r})=>[b(I(r.is_folder?"文件夹":Le(r.type)),1)]),_:1}),t(E,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:r})=>[b(I(fl(r.created_at)),1)]),_:1}),t(E,{label:"操作",width:"300"},{default:o(({row:r})=>[t(ee,null,{default:o(()=>[t(i,{type:"primary",onClick:$=>ze(r)},{default:o(()=>[b(I(r.is_folder?"打开":"查看"),1)]),_:2},1032,["onClick"]),t(i,{type:"danger",onClick:$=>_l(r),disabled:(r.is_folder,!1)},{default:o(()=>l[26]||(l[26]=[b(" 删除 ")])),_:2},1032,["onClick","disabled"]),r.is_folder?(y(),Y(i,{key:0,type:"success",onClick:$=>Se(r)},{default:o(()=>l[27]||(l[27]=[b(" 新建 ")])),_:2},1032,["onClick"])):G("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"]),!V.value&&U.value.length===0?(y(),Y(x,{key:0,description:"暂无数据"})):G("",!0)]),_:1})),[[He,V.value]])]),_:1})]),_:1},8,["modelValue"]),t(Ae,{title:"资料详情",modelValue:ue.value,"onUpdate:modelValue":l[8]||(l[8]=r=>ue.value=r),width:"50%"},{footer:o(()=>[t(i,{onClick:l[7]||(l[7]=r=>ue.value=!1)},{default:o(()=>l[36]||(l[36]=[b("关闭")])),_:1})]),default:o(()=>{var r,$,Oe,We,Xe;return[v("div",ra,[v("div",na,[v("div",sa,[t(K,{style:{width:"40px",height:"40px"},src:ke((r=J.value)==null?void 0:r.type),fit:"contain"},null,8,["src"]),v("h2",ia,I((($=J.value)==null?void 0:$.title)||"无标题"),1)]),v("p",null,[l[28]||(l[28]=v("strong",null,"类型:",-1)),l[29]||(l[29]=b()),v("span",null,I(Le((Oe=J.value)==null?void 0:Oe.type)),1)]),v("p",null,[l[30]||(l[30]=v("strong",null,"平台:",-1)),l[31]||(l[31]=b()),v("span",null,I(Ge((We=J.value)==null?void 0:We.platform)),1)]),v("p",null,[l[32]||(l[32]=v("strong",null,"位置:",-1)),l[33]||(l[33]=b()),v("span",null,I(Ee(J.value)),1)]),v("p",null,[l[34]||(l[34]=v("strong",null,"创建时间:",-1)),l[35]||(l[35]=b()),v("span",null,I((Xe=J.value)!=null&&Xe.created_at?new Date(J.value.created_at).toLocaleString():""),1)]),v("div",ua,[t(i,{type:"primary",onClick:nl},{default:o(()=>[b(I(al()),1)]),_:1})])])])]}),_:1},8,["modelValue"]),t(Ae,{modelValue:R.value,"onUpdate:modelValue":l[10]||(l[10]=r=>R.value=r),title:"文件预览",width:"80%","destroy-on-close":""},{footer:o(()=>[t(i,{onClick:l[9]||(l[9]=r=>R.value=!1)},{default:o(()=>l[40]||(l[40]=[b("关闭")])),_:1}),M.value||N.value||me.value?(y(),Y(i,{key:0,type:"primary",onClick:qe},{default:o(()=>l[41]||(l[41]=[b(" 全屏查看 ")])),_:1})):G("",!0)]),default:o(()=>[v("div",da,[M.value?(y(),D("img",{key:0,src:B.value,class:"material-image",onClick:qe},null,8,ca)):N.value?(y(),D("iframe",{key:1,src:B.value,class:"material-frame"},null,8,fa)):Ce.value?(y(),D("iframe",{key:2,src:ce.value,class:"word-preview-frame"},null,8,pa)):me.value?(y(),D("iframe",{key:3,src:ce.value,class:"word-preview-frame"},null,8,va)):Pe.value?(y(),D("div",ma,[v("p",null,"链接地址："+I(B.value),1),t(i,{type:"primary",onClick:sl},{default:o(()=>l[37]||(l[37]=[b("打开链接")])),_:1})])):De.value?(y(),D("div",ga,[v("video",{src:B.value,controls:"",class:"material-video"},null,8,_a)])):Ue.value?(y(),D("div",ya,[v("div",{innerHTML:B.value,class:"text-content"},null,8,Aa)])):(y(),D("div",ha,[l[39]||(l[39]=v("p",null,"无法预览此类型的文件，请下载后查看",-1)),t(i,{type:"primary",onClick:il},{default:o(()=>l[38]||(l[38]=[b("下载文件")])),_:1})]))])]),_:1},8,["modelValue"]),t(Ae,{modelValue:ve.value,"onUpdate:modelValue":l[11]||(l[11]=r=>ve.value=r),title:"全屏预览",width:"100%",top:"0","show-close":!0,"destroy-on-close":"",class:"fullscreen-dialog"},{default:o(()=>[v("div",ba,[M.value?(y(),D("img",{key:0,src:B.value,class:"fullscreen-image"},null,8,wa)):N.value?(y(),D("iframe",{key:1,src:B.value,class:"fullscreen-frame"},null,8,Ca)):me.value?(y(),D("iframe",{key:2,src:ce.value,class:"fullscreen-frame"},null,8,ka)):G("",!0)])]),_:1},8,["modelValue"]),t(Zl,{visible:j.value,"onUpdate:visible":[l[12]||(l[12]=r=>j.value=r),ol]},null,8,["visible"]),t(Ae,{modelValue:T.value,"onUpdate:modelValue":l[16]||(l[16]=r=>T.value=r),title:w.value?`在 '${w.value.name||w.value.title||""}' 下创建文件夹`:"创建文件夹",width:"30%"},{footer:o(()=>[t(i,{onClick:l[15]||(l[15]=r=>T.value=!1)},{default:o(()=>l[42]||(l[42]=[b("取消")])),_:1}),t(i,{type:"primary",onClick:Al},{default:o(()=>l[43]||(l[43]=[b("确定")])),_:1})]),default:o(()=>[t(Ml,{model:Q,"label-width":"80px"},{default:o(()=>[t(Be,{label:"名称"},{default:o(()=>[t(a,{modelValue:Q.name,"onUpdate:modelValue":l[13]||(l[13]=r=>Q.name=r),placeholder:"请输入文件夹名称"},null,8,["modelValue"])]),_:1}),w.value?w.value?(y(),Y(Be,{key:1,label:"所在位置"},{default:o(()=>[t(El,{type:"info"},{default:o(()=>[b(I(w.value.is_folder?w.value.name:w.value.title),1)]),_:1})]),_:1})):G("",!0):(y(),Y(Be,{key:0,label:"所在位置"},{default:o(()=>[t(xl,{modelValue:Q.folderPath,"onUpdate:modelValue":l[14]||(l[14]=r=>Q.folderPath=r),options:z.value,props:{checkStrictly:!0,emitPath:!0,value:"id",label:"name",children:"children"},clearable:"",placeholder:"请选择文件夹位置",style:{width:"100%"}},{default:o(({node:r,data:$})=>[v("span",null,I($.name),1),r.isLeaf?G("",!0):(y(),D("span",xa," ("+I($.children.length)+") ",1))]),empty:o(()=>[t(x,{description:"加载中..."})]),_:1},8,["modelValue","options"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Da=ll(Ea,[["__scopeId","data-v-c9e82402"]]);export{Da as default};
