import{e as T,f as H,h as q,E as G}from"./elementPlus-BUR7wieg.js";import{u as E,b as j,s as J}from"./index-Y63Xf8yq.js";import{x as V,r as w,j as O,G as p,H as n,P as e,ag as o,A as d,L as I,M as b,u as f,aA as P,z as u,az as K,c as W,y as k,O as A,a6 as N,K as L,aF as Q}from"./vendor-CcmhhHhJ.js";import"./supabase-CHaJ5Hcu.js";const X={class:"toolbar",style:{display:"flex","justify-content":"end","align-items":"center"}},Y={style:{display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","margin-right":"5px"}},Z=V({__name:"Header",setup(F){const C=P(),c=E(),_=w(c.user);console.log(_.value,"user"),w(""),O(()=>{_.value=c.getUser()});const S=()=>{c.logout(),C.push("/login")};return(h,l)=>{const m=o("el-col"),R=o("el-avatar"),z=o("el-icon"),U=o("el-link"),M=o("el-dropdown-item"),D=o("el-dropdown-menu"),a=o("el-dropdown"),t=o("el-row"),g=o("el-header");return u(),p(g,{style:{"font-size":"16px"}},{default:n(()=>[e(t,{justify:"space-between",gutter:16,style:{height:"100%","align-items":"center"}},{default:n(()=>[e(m,{span:3},{default:n(()=>l[0]||(l[0]=[d("h1",{style:{"font-size":"40px","font-weight":"700"}},"IWISH",-1)])),_:1}),e(m,{span:4},{default:n(()=>{var s,r;return[d("div",X,[e(R,{style:{"margin-right":"10px","min-width":"40px","font-size":"20px","font-weight":"700","align-items":"center","line-height":"40px","justify-content":"center",background:"#2f87ff"},src:(s=_.value)==null?void 0:s.avatar_url},{default:n(()=>{var y,x,v;return[I(b(((v=(x=(y=_.value)==null?void 0:y.full_name)==null?void 0:x.charAt(0))==null?void 0:v.toUpperCase())||"U"),1)]}),_:1},8,["src"]),d("span",Y,b((r=_.value)==null?void 0:r.full_name),1),e(a,null,{dropdown:n(()=>[e(D,null,{default:n(()=>[e(M,null,{default:n(()=>[e(U,{href:"/system/personal-data"},{default:n(()=>l[1]||(l[1]=[I(" 个人中心")])),_:1})]),_:1}),e(M,{onClick:S},{default:n(()=>l[2]||(l[2]=[I("退出登录")])),_:1})]),_:1})]),default:n(()=>[e(z,{style:{"margin-right":"10px","margin-top":"1px","font-size":"18px",color:"#fff"}},{default:n(()=>[e(f(T))]),_:1})]),_:1})])]}),_:1})]),_:1})]),_:1})}}}),ee=j(Z,[["__scopeId","data-v-8f6d8bf3"]]),ne=V({__name:"Aside",setup(F){const C=P(),c=K();console.log(C,"==========",c.name);const _=w(""),S=w([]),h=w(!1),l=E(),m=W(()=>l.getMenus),R=a=>{_.value=a,a==="/system/demand"&&M()},z=w("");O(async()=>{h.value=!0,await l.fetchMenus();const{data:{session:a}}=await J.auth.getSession();z.value=(a==null?void 0:a.access_token)||"",h.value=!1});function U(a){const t=typeof a=="string"?a:JSON.stringify(a);return btoa(unescape(encodeURIComponent(t))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const M=()=>{var a,t,g,s,r,y,x,v;try{const $={id:((a=l.user)==null?void 0:a.user_id)||"",email:((t=l.user)==null?void 0:t.email)||"",name:((g=l.user)==null?void 0:g.full_name)||((r=(s=l.user)==null?void 0:s.email)==null?void 0:r.split("@")[0])||"用户",role:D((y=l.user)==null?void 0:y.role_id),rolename:(v=(x=l.user)==null?void 0:x.role)==null?void 0:v.name,origin:window.location.origin,exp:Math.floor(Date.now()/1e3)+900},i=U($);window.open(`https://iwishneed.netlify.app/auth/bridge#external_user=${i}&main_access_token=${z.value}`,"_blank")}catch($){console.error("处理demand跳转失败:",$),G.error("跳转失败，请稍后重试")}},D=a=>{if(!a)return"submitter";switch(a){case 0:case 1:return"admin";case 2:case 3:return"manager";case 4:case 5:return"developer";default:return"submitter"}};return(a,t)=>{const g=o("ArrowLeft"),s=o("el-icon"),r=o("el-menu-item"),y=o("InfoFilled"),x=o("DataAnalysis"),v=o("el-sub-menu"),$=o("el-menu");return u(),p($,{class:"el-menu-vertical-demo","active-text-color":"#fff","background-color":"#05479a","text-color":"#fff",style:{position:"fixed","z-index":"999",height:"calc(100vh - 84px)",left:"0",width:"240px"},router:!0,"unique-opened":!0,"default-active":_.value,"default-openeds":S.value,onSelect:R,loading:h.value},{default:n(()=>[f(c).name==="letter-to-employee"||f(c).name==="company-introduction"||f(c).name==="apply-for-registration"?(u(),k(A,{key:0},[e(r,{index:"/training-home"},{default:n(()=>[e(s,null,{default:n(()=>[e(g)]),_:1}),t[0]||(t[0]=d("span",null,"返回",-1))]),_:1}),e(r,{index:"/system/letter-to-employee"},{default:n(()=>[e(s,null,{default:n(()=>[e(f(H))]),_:1}),t[1]||(t[1]=d("span",null,"致员工的一封信",-1))]),_:1}),e(r,{index:"/system/company-introduction"},{default:n(()=>[e(s,null,{default:n(()=>[e(f(q))]),_:1}),t[2]||(t[2]=d("span",null,"了解艾维",-1))]),_:1}),e(r,{index:"/system/apply-for-registration"},{default:n(()=>[e(s,null,{default:n(()=>[e(y)]),_:1}),t[3]||(t[3]=d("span",null,"申请注册",-1))]),_:1})],64)):f(c).name==="digital-marketing"||f(c).name==="website-layout"?(u(),k(A,{key:1},[e(r,{index:"/training-home"},{default:n(()=>[e(s,null,{default:n(()=>[e(g)]),_:1}),t[4]||(t[4]=d("span",null,"返回",-1))]),_:1}),e(r,{index:"/system/digital-marketing"},{default:n(()=>[e(s,null,{default:n(()=>[e(f(H))]),_:1}),t[5]||(t[5]=d("span",null,"了解数字营销与品牌独立站",-1))]),_:1}),e(r,{index:"/system/website-layout"},{default:n(()=>[e(s,null,{default:n(()=>[e(x)]),_:1}),t[6]||(t[6]=d("span",null,"独立站的布局及优化诊断",-1))]),_:1})],64)):(u(!0),k(A,{key:2},N(m.value,i=>(u(),k(A,{key:i.id},[i.children&&i.children.length>0?(u(),p(v,{key:0,index:`/system${i.path}`},{title:n(()=>[e(s,null,{default:n(()=>[(u(),p(L(i.icon)))]),_:2},1024),d("span",null,b(i.name),1)]),default:n(()=>[(u(!0),k(A,null,N(i.children,B=>(u(),p(r,{key:B.id,index:`/system${B.path}`},{default:n(()=>[I(b(B.name),1)]),_:2},1032,["index"]))),128))]),_:2},1032,["index"])):i.path==="/demand"?(u(),p(r,{key:1,onClick:M},{default:n(()=>[e(s,null,{default:n(()=>[(u(),p(L(i.icon)))]),_:2},1024),d("span",null,b(i.name),1)]),_:2},1024)):(u(),p(r,{key:2,index:`/system${i.path}`},{default:n(()=>[e(s,null,{default:n(()=>[(u(),p(L(i.icon)))]),_:2},1024),d("span",null,b(i.name),1)]),_:2},1032,["index"]))],64))),128))]),_:1},8,["default-active","default-openeds","loading"])}}}),te={class:"common-layout"},oe={class:"page-container"},ae={class:"loading-container"},le=V({__name:"SystemMain",setup(F){return w([]),(C,c)=>{const _=o("el-aside"),S=o("RouterView"),h=o("el-skeleton"),l=o("el-main"),m=o("el-container");return u(),k("div",te,[e(m,{direction:"vertical",style:{height:"100vh"}},{default:n(()=>[e(ee),e(m,{style:{"margin-top":"84px"}},{default:n(()=>[e(_,{width:"240px"},{default:n(()=>[e(ne)]),_:1}),e(m,null,{default:n(()=>[e(l,null,{default:n(()=>[d("div",oe,[(u(),p(Q,null,{default:n(()=>[e(S)]),fallback:n(()=>[d("div",ae,[e(h,{rows:3,animated:""})])]),_:1}))])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),de=j(le,[["__scopeId","data-v-f490535e"]]);export{de as default};
