import{x as z,r as h,j as D,W as I,y as f,A as a,J as N,P as y,H as V,u as _,ag as $,D as b,O,a6 as R,n as W,L as j,aA as P,z as m,M as U}from"./vendor-CcmhhHhJ.js";import{f as F,b as J,m as Y,E as w}from"./elementPlus-BUR7wieg.js";import{m as A}from"./index-BoP3BFUL.js";import{b as G}from"./index-Y63Xf8yq.js";import"./supabase-CHaJ5Hcu.js";const K={class:"word-viewer-container"},Q={class:"viewer-header"},X={class:"header-right"},Z={class:"viewer-content"},ee={class:"sidebar-header"},te={class:"sidebar-actions"},ne={key:0,class:"sidebar-content"},se={class:"toc-tree"},oe=["onClick"],le={class:"main-content"},ae={class:"content-wrapper"},re={class:"view-mode"},ie=["innerHTML"],ce={key:0,class:"loading-overlay"},C="https://oziqjzzrouoclocfgoub.supabase.co/storage/v1/object/public/documents/word-files/learn-iwish.docx",de=z({__name:"Introduce",setup(he){P();const g=h(!1),k=h(""),u=h(!1),v=h(""),p=h([]),E=h(),L=async()=>{g.value=!0;try{console.log("开始加载Word文档:",C);const t=await fetch(C);if(!t.ok)throw new Error("文件下载失败");const e=await t.arrayBuffer(),r=await A.convertToHtml({arrayBuffer:e,convertImage:A.images.imgElement(function(s){return s.read("base64").then(function(n){return{src:"data:"+s.contentType+";base64,"+n}})}),styleMap:["p[style-name='Heading 1'] => h1:fresh","p[style-name='Heading 2'] => h2:fresh","p[style-name='Heading 3'] => h3:fresh","p[style-name='Heading 4'] => h4:fresh","p[style-name='Heading 5'] => h5:fresh","p[style-name='Heading 6'] => h6:fresh","p[style-name='Title'] => h1.title:fresh","p[style-name='Subtitle'] => h2.subtitle:fresh","p[style-name='标题 1'] => h1:fresh","p[style-name='标题 2'] => h2:fresh","p[style-name='标题 3'] => h3:fresh","p[style-name='标题 4'] => h4:fresh","p[style-name='标题 5'] => h5:fresh","p[style-name='标题 6'] => h6:fresh","p[style-name='标题1'] => h1:fresh","p[style-name='标题2'] => h2:fresh","p[style-name='标题3'] => h3:fresh","p[style-name='标题4'] => h4:fresh","p[style-name='标题5'] => h5:fresh","p[style-name='标题6'] => h6:fresh","r[style-name='Strong'] => strong","r[style-name='Emphasis'] => em","r[style-name='Hyperlink'] => a","r[style-name='加粗'] => strong","r[style-name='倾斜'] => em","r[style-name='超链接'] => a","table => table.table:fresh","tr => tr:fresh","td => td:fresh","th => th:fresh"],transformDocument:function(s){return s.children.forEach(function(n){n.children&&n.children.forEach(function(i){i.type==="hyperlink"&&(i.type="hyperlink")})}),s}});k.value=r.value,await W(),setTimeout(()=>{q()},500)}catch(t){console.error("加载文档失败:",t),w.error(`加载文档失败: ${t.message}`)}finally{g.value=!1}},q=()=>{const t=E.value;if(!t){console.log("wordContentRef.value 为空，无法生成目录");return}const e=[];t.querySelectorAll('a[id^="heading_"]').forEach((s,n)=>{var c,d;const i=s.getAttribute("id")||`heading-${n}`;let l=s.nextElementSibling,o="";if(l&&l.tagName.toLowerCase()==="strong")o=((c=l.textContent)==null?void 0:c.trim())||"";else{const S=s.parentElement;if(S){const T=S.querySelector("strong");T&&(o=((d=T.textContent)==null?void 0:d.trim())||"")}}o||(o=`标题 ${n+1}`),o&&o.length>0&&e.push({id:i,title:o,level:1,element:s})}),e.length===0&&t.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach((n,i)=>{var c;const l=x(n),o=((c=n.textContent)==null?void 0:c.trim())||"";if(o&&o.length>0){const d=`heading-${i}`;n.id=d,e.push({id:d,title:o,level:l,element:n})}}),e.length===0&&t.querySelectorAll('h1, h2, h3, h4, h5, h6, .title, .subtitle, p[style*="heading"], p[style*="title"], p[style*="Heading"]').forEach((n,i)=>{var c;const l=x(n),o=((c=n.textContent)==null?void 0:c.trim())||"";if(o&&o.length>0){const d=`heading-${i}`;n.id=d,e.push({id:d,title:o,level:l,element:n})}}),e.length===0&&t.querySelectorAll("p").forEach((n,i)=>{var o;const l=((o=n.textContent)==null?void 0:o.trim())||"";if(l.match(/^[一二三四五六七八九十]+[、．.]/)||l.match(/^\d+[、．.]/)||l.includes("了解")||l.includes("申请")||l.includes("培训")){const c=`heading-${i}`;n.id=c,e.push({id:c,title:l,level:1,element:n})}}),p.value=e,e.length===0?p.value=[{id:"test-1",title:"文档开始",level:1},{id:"test-2",title:"主要内容",level:2}]:console.log("目录生成成功，共",e.length,"个条目")},x=t=>{const e=t.tagName.toLowerCase();if(e.startsWith("h"))return parseInt(e.charAt(1));const r=t.className;if(r.includes("title"))return 1;if(r.includes("subtitle"))return 2;const s=t.textContent||"";return s.length<20&&t.tagName==="P"?2:s.length<50&&t.tagName==="P"?3:4},B=t=>{let e=document.getElementById(t);e||(e=document.querySelector(`a[id="${t}"]`)),e||(e=document.querySelector(`[id="${t}"]`)),e?(e.scrollIntoView({behavior:"smooth",block:"start"}),e.style.backgroundColor="#fff3cd",setTimeout(()=>{e.style.backgroundColor=""},2e3),v.value=t):w.warning("未找到对应的标题位置")},M=()=>{const t=document.createElement("a");t.href=C,t.download="艾维公司介绍.docx",document.body.appendChild(t),t.click(),document.body.removeChild(t),w.success("开始下载文档")},H=()=>{const t=window.pageYOffset||document.documentElement.scrollTop,e=p.value;for(let r=e.length-1;r>=0;r--){const s=e[r],n=document.getElementById(s.id);if(n&&n.offsetTop<=t+100){v.value=s.id;break}}};return D(()=>{L(),window.addEventListener("scroll",H)}),I(()=>{window.removeEventListener("scroll",H)}),(t,e)=>{const r=$("el-button"),s=$("el-loading");return m(),f("div",K,[a("div",Q,[e[2]||(e[2]=a("div",{class:"header-left"},[a("span",{class:"file-title"},"了解艾维公司")],-1)),a("div",X,[y(r,{type:"success",onClick:M,icon:_(F)},{default:V(()=>e[1]||(e[1]=[j(" 下载文档 ")])),_:1},8,["icon"])])]),a("div",Z,[a("div",{class:b(["sidebar",{collapsed:u.value}])},[a("div",ee,[e[3]||(e[3]=a("span",null,"目录",-1)),a("div",te,[y(r,{type:"text",onClick:e[0]||(e[0]=n=>u.value=!u.value),icon:u.value?_(J):_(Y)},null,8,["icon"])])]),u.value?N("",!0):(m(),f("div",ne,[a("div",se,[(m(!0),f(O,null,R(p.value,(n,i)=>(m(),f("div",{key:i,class:b(["toc-item",{active:v.value===n.id}]),onClick:l=>B(n.id)},[a("span",{class:b(["toc-level",`level-${n.level}`])},U(n.title),3)],10,oe))),128))])]))],2),a("div",le,[a("div",ae,[a("div",re,[a("div",{class:"word-content",innerHTML:k.value,ref_key:"wordContentRef",ref:E},null,8,ie)])])])]),g.value?(m(),f("div",ce,[y(s,{"element-loading-text":"正在加载文档...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"})])):N("",!0)])}}}),ve=G(de,[["__scopeId","data-v-3eac9bdf"]]);export{ve as default};
