import{E as x,s as nt,N as ne,u as re,P as Ue,F as Se,Q as rt,O as it,D as ut,t as ct,c as $e}from"./elementPlus-Be5V1zcU.js";import{s as C,u as dt,B as mt,e as _t,b as pt}from"./index-Dg6Dv2jL.js";import{x as vt,X as ie,c as ee,r as m,j as ft,y as d,P as t,A as o,H as s,ag as p,G as z,J as v,u as y,O as Te,a6 as Fe,L as _,I as gt,aq as ht,M as f,z as i}from"./vendor-CcmhhHhJ.js";import"./supabase-fOlwtt9p.js";const yt=r=>r===0||r===1||r===11,G={async getAllCases(r={}){let u=C.from("case_sharing").select("*",{count:"exact"});if(r.query&&(u=u.or(`title.ilike.%${r.query}%,custom_sharer.ilike.%${r.query}%,custom_department.ilike.%${r.query}%`)),r.category&&r.category!=="all"&&(u=u.eq("category",r.category)),r.startDate&&r.endDate&&(u=u.gte("created_at",r.startDate).lte("created_at",r.endDate)),r.viewType==="my"){const{data:{user:E}}=await C.auth.getUser();E&&(u=u.eq("created_by",E.id))}r.showStatus!==void 0?u=u.eq("is_show",r.showStatus==="true"):u=u.eq("is_show",!0);const g=((r.page||1)-1)*(r.pageSize||10),k=g+(r.pageSize||10)-1,{data:w,error:V,count:Y}=await u.order("created_at",{ascending:!1}).range(g,k);if(V)throw V;return{data:w,total:Y||0}},async getCase(r){const{data:u,error:g}=await C.from("case_sharing").select("*").eq("id",r).single();if(g)throw g;return u},async createCase(r){const{data:{user:u}}=await C.auth.getUser();if(!u)throw new Error("User not authenticated");const{data:g,error:k}=await C.from("user_profiles").select("full_name, organization_id").eq("user_id",u.id).single();if(k)throw k;const{data:w,error:V}=await C.from("case_sharing").insert({...r,created_by:u.id,created_by_name:g.full_name||u.email,organization_id:g.organization_id}).select().single();if(V)throw V;return w},async updateCase(r,u){const{data:g,error:k}=await C.from("case_sharing").update(u).eq("id",r).select().single();if(k)throw k;return g},async deleteCase(r){const{error:u}=await C.from("case_sharing").delete().eq("id",r);if(u)throw u},async uploadFile(r,u){const g=`${new Date().getTime()}_${r.name}`,k=`${u}/${g}`,{data:w,error:V}=await C.storage.from("materials").upload(k,r);if(V)throw V;const{data:{publicUrl:Y}}=C.storage.from("materials").getPublicUrl(k);return{url:Y,filename:g}}},wt={class:"layout"},bt={class:"layout-title"},kt={class:"status-tabs"},Vt={class:"cases-content"},Ct={class:"card-header"},xt={key:0,class:"header-actions"},zt={style:{"font-size":"14px",color:"#909399"}},Dt={class:"month-info"},Ut={key:0,class:"month-item"},St={class:"month-text"},$t={key:1,class:"month-empty"},Tt={class:"sharer-dept-info"},Ft={key:0,class:"sharer-item"},qt={class:"sharer-text"},At={key:1,class:"dept-item"},Et={class:"dept-text"},Mt={key:2,class:"sharer-dept-empty"},Bt={key:2},Nt={class:"dialog-content"},Pt={class:"case-details"},Lt={class:"case-header"},Yt={class:"case-title"},jt={class:"case-meta"},Ot={class:"meta-item"},Ht={class:"meta-item"},Qt={class:"meta-item"},Rt={class:"case-section"},Gt=["innerHTML"],Jt={key:0,class:"case-section"},Wt={class:"attachment-box"},Xt={class:"attachment-name"},Kt={key:1,class:"case-section"},Zt={class:"link-box"},It={class:"link-url"},ea={key:2,class:"case-section"},ta={class:"custom-info"},aa={key:0,class:"custom-item"},la={class:"custom-value"},sa={key:1,class:"custom-item"},oa={class:"custom-value"},na={key:2,class:"custom-item"},ra={class:"custom-value"},ia={class:"dialog-footer"},ua={class:"attachment-preview"},ca=["src"],da=["src"],ma={key:2,class:"attachment-download"},_a={class:"dialog-footer"},pa={class:"fullscreen-preview"},va=["src"],fa=["src"],ga={class:"dialog-footer"},ha=vt({__name:"CaseSharing",setup(r){const u=ie([{name:"分享分享",path:"/system/case-sharing"}]),g=dt(),k=ee(()=>{var a;return((a=g.user)==null?void 0:a.user_id)||""}),w=ee(()=>yt(Number(g.roleId))),V=m(!1),Y=m([]),E=m(!1),j=m(!1),c=m(null),te=m(""),T=m([]),J=m(""),W=m(!1),X=m("all"),M=m([]),ae=m(),B=m(!1),K=m(""),H=m(!1),F=m(""),O=m(""),le=m(!1),n=ie({id:"",title:"",content:"",category:"",is_show:!0,attachment_url:"",attachment_name:"",attachment_type:"",link_url:"",custom_month:"",custom_sharer:"",custom_department:""}),qe={title:[{required:!0,message:"请输入分享标题",trigger:"blur"},{min:2,max:100,message:"标题长度应在2到100个字符之间",trigger:"blur"}],category:[{required:!0,message:"请选择分享类型",trigger:"change"}],content:[{required:!1,message:"请输入分享内容",trigger:"blur"},{min:2,max:1e4,message:"内容长度应在8到10000个字符之间",trigger:"blur"}]},ue=[{label:"广告",value:"advertising"},{label:"素材",value:"material"},{label:"日常运营",value:"daily_operation"},{label:"客户案例",value:"customer_case"},{label:"技术分享",value:"technical"},{label:"其他",value:"other"}],q=ie({page:1,pageSize:10,total:0}),Z=m([]),S=m(null),Ae=[{text:"最近一周",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*7),[e,a]}},{text:"最近一个月",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*30),[e,a]}},{text:"最近三个月",value:()=>{const a=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*90),[e,a]}}],se=ee(()=>O.value?O.value.startsWith("image/"):!1),oe=ee(()=>O.value?O.value==="application/pdf":!1),Ee=a=>{switch(a){case"advertising":return"primary";case"material":return"success";case"daily_operation":return"warning";case"customer_case":return"danger";case"technical":return"info";case"other":return"";default:return"info"}},ce=a=>{switch(a){case"advertising":return"广告";case"material":return"素材";case"daily_operation":return"日常运营";case"customer_case":return"客户分享";case"technical":return"技术分享";case"other":return"其他";default:return a||"未知"}},Me=a=>w.value?!0:a.created_by===k.value,Be=a=>w.value?!0:a.created_by===k.value,Ne=a=>{q.page=a.page,q.pageSize=a.pageSize,N()},N=async()=>{V.value=!0;const a=T.value!=null&&T.value[0]!=null?T.value[0].toDateString():"",e=T.value!=null&&T.value[1]!=null?T.value[1].toDateString():"";try{const D=await G.getAllCases({query:te.value,startDate:a,endDate:e,page:q.page,pageSize:q.pageSize,category:K.value!==""?K.value:void 0,showStatus:w.value&&J.value!==""?J.value:void 0,viewType:X.value});Y.value=D.data,q.total=D.total}catch(D){x.error("搜索分享失败"),console.error("搜索分享失败:",D)}finally{V.value=!1}},Pe=async a=>{E.value=!0,c.value=a},Le=a=>{a.attachment_url&&(F.value=a.attachment_url,O.value=_e(a.attachment_name),H.value=!0)},Ye=()=>{var a;(a=c.value)!=null&&a.attachment_url&&(F.value=c.value.attachment_url,O.value=_e(c.value.attachment_name),H.value=!0)},je=()=>{F.value&&window.open(F.value,"_blank")},de=()=>{le.value=!0},me=a=>{a&&window.open(a,"_blank")},_e=a=>{if(!a)return"";const e=Oe(a);return["jpg","jpeg","png","gif","webp"].includes(e)?"image/"+e:e==="pdf"?"application/pdf":""},Oe=a=>{if(!a)return"";const e=a.split(".");return e.length>1?e[e.length-1].toLowerCase():""},He=()=>{B.value=!1,j.value=!0,Object.assign(n,{id:"",title:"",content:"",category:"",is_show:!0,attachment_url:"",attachment_name:"",attachment_type:"",link_url:"",custom_month:"",custom_sharer:"",custom_department:""}),Z.value=[],S.value=null},Qe=a=>{B.value=!0,j.value=!0,Object.assign(n,{id:a.id,title:a.title,content:a.content,category:a.category,is_show:a.is_show,attachment_url:a.attachment_url,attachment_name:a.attachment_name,attachment_type:a.attachment_type,link_url:a.link_url,custom_month:a.custom_month,custom_sharer:a.custom_sharer,custom_department:a.custom_department}),Z.value=[],S.value=null},Re=a=>{M.value=a},Ge=a=>{const e=["application/pdf","application/msword","text/plain","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/jpeg","image/png","image/gif","image/webp"],D=a.raw&&e.includes(a.raw.type),Q=a.raw&&a.raw.size/1024/1024<10;if(!D)return x.error("文件类型不支持！"),!1;if(!Q)return x.error("文件大小超过 10MB 限制！"),!1;S.value=a.raw,console.log("Selected file:",S.value)},Je=async a=>{if(!a)throw new Error("No file selected");const e=a.name.split(".").pop(),Q=`casesharing/${`${Date.now()}-${Math.random().toString(36).substring(2)}.${e}`}`,{data:A,error:P}=await C.storage.from("materials").upload(Q,a);if(P)throw P;const{data:R}=C.storage.from("materials").getPublicUrl(A.path);return R.publicUrl},We=async()=>{ae.value&&await ae.value.validate(async a=>{if(a){W.value=!0;try{if(S.value)try{const e=await Je(S.value);n.attachment_url=e,n.attachment_name=S.value.name,n.attachment_type=S.value.type}catch(e){x.error(`文件上传失败: ${e.message||"未知错误"}`),W.value=!1;return}B.value?(await G.updateCase(n.id,{title:n.title,content:n.content,category:n.category,is_show:n.is_show,attachment_url:n.attachment_url,attachment_name:n.attachment_name,attachment_type:n.attachment_type,link_url:n.link_url,custom_month:n.custom_month,custom_sharer:n.custom_sharer,custom_department:n.custom_department}),x.success("分享已更新")):(await G.createCase({title:n.title,content:n.content,category:n.category,is_show:n.is_show,attachment_url:n.attachment_url,attachment_name:n.attachment_name,attachment_type:n.attachment_type,link_url:n.link_url,custom_month:n.custom_month,custom_sharer:n.custom_sharer,custom_department:n.custom_department}),x.success("分享已创建")),j.value=!1,N(),Z.value=[],S.value=null}catch(e){x.error(B.value?"更新分享失败":"创建分享失败"),console.error(B.value?"更新分享失败:":"创建分享失败:",e)}finally{W.value=!1}}})},Xe=async a=>{try{await $e.confirm(`确定要删除 "${a.title}" 这个分享吗？`,"提示",{type:"warning"}),await G.deleteCase(a.id),x.success("删除成功"),N()}catch(e){e!=="cancel"&&(x.error("删除失败"),console.error("删除失败:",e))}},Ke=async()=>{if(M.value.length!==0)try{await $e.confirm(`确定要删除选中的 ${M.value.length} 个分享吗？此操作不可恢复。`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=M.value.map(e=>G.deleteCase(e.id));await Promise.all(a),x.success(`成功删除 ${M.value.length} 个分享`),M.value=[],N()}catch(a){a!=="cancel"&&(console.error("批量删除分享失败:",a),x.error("批量删除失败"))}},Ze=a=>{X.value=a,q.page=1,N()};return ft(()=>{N()}),(a,e)=>{const D=p("el-tab-pane"),Q=p("el-tabs"),A=p("el-input"),P=p("el-option"),R=p("el-select"),pe=p("el-date-picker"),h=p("el-button"),Ie=p("el-space"),ve=p("el-card"),U=p("el-table-column"),b=p("el-icon"),fe=p("el-tag"),et=p("el-button-group"),tt=p("el-empty"),at=p("el-table"),I=p("el-dialog"),$=p("el-form-item"),lt=p("el-upload"),st=p("el-switch"),ot=ht("loading");return i(),d("div",wt,[t(mt,{breadcrumb:u},null,8,["breadcrumb"]),o("div",bt,[e[21]||(e[21]=o("h1",{class:"title"},"知识分享",-1)),o("div",kt,[t(Q,{class:"demo-tabs",modelValue:X.value,"onUpdate:modelValue":e[0]||(e[0]=l=>X.value=l),onTabChange:Ze},{default:s(()=>[t(D,{name:"all",label:"全部分享"}),t(D,{name:"my",label:"我的分享"})]),_:1},8,["modelValue"])])]),t(ve,{shadow:"always",style:{"margin-bottom":"20px"}},{default:s(()=>[t(Ie,{wrap:"",alignment:"start",size:30},{default:s(()=>[t(A,{modelValue:te.value,"onUpdate:modelValue":e[1]||(e[1]=l=>te.value=l),style:{width:"400px"},placeholder:"搜索标题、分享人、部门（支持模糊搜索）","suffix-icon":y(nt),size:"large",clearable:""},null,8,["modelValue","suffix-icon"]),t(R,{modelValue:K.value,"onUpdate:modelValue":e[2]||(e[2]=l=>K.value=l),placeholder:"分享类型",clearable:"",style:{width:"180px"},size:"large"},{default:s(()=>[(i(),d(Te,null,Fe(ue,l=>t(P,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),t(pe,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=l=>T.value=l),type:"daterange","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:Ae,size:"large"},null,8,["modelValue"]),w.value?(i(),z(R,{key:0,modelValue:J.value,"onUpdate:modelValue":e[4]||(e[4]=l=>J.value=l),placeholder:"选择展示状态",style:{width:"160px"},size:"large",clearable:""},{default:s(()=>[t(P,{label:"显示",value:"true"}),t(P,{label:"隐藏",value:"false"})]),_:1},8,["modelValue"])):v("",!0),t(h,{type:"primary",size:"large",onClick:N},{default:s(()=>e[22]||(e[22]=[_("搜索")])),_:1}),t(h,{type:"success",size:"large",onClick:He},{default:s(()=>e[23]||(e[23]=[_("添加分享")])),_:1})]),_:1})]),_:1}),o("div",Vt,[t(ve,{style:{"min-height":"400px"}},{header:s(()=>[o("div",Ct,[e[25]||(e[25]=_(" 分享列表 ")),w.value?(i(),d("div",xt,[t(h,{type:"danger",disabled:!M.value.length,onClick:Ke},{default:s(()=>e[24]||(e[24]=[_(" 批量删除 ")])),_:1},8,["disabled"]),o("div",zt,"共计"+f(q.total)+"条数据",1)])):v("",!0)])]),default:s(()=>[gt((i(),z(at,{data:Y.value,onSelectionChange:Re,"scrollbar-always-on":!0,style:{width:"100%"}},{default:s(()=>[w.value?(i(),z(U,{key:0,type:"selection",width:"55",fixed:"left"})):v("",!0),t(U,{label:"分享月份",width:"120"},{default:s(({row:l})=>[o("div",Dt,[l.custom_month?(i(),d("div",Ut,[t(b,{color:"#E6A23C",size:"14"},{default:s(()=>[t(y(ne))]),_:1}),o("span",St,f(l.custom_month),1)])):(i(),d("div",$t,e[26]||(e[26]=[o("span",{class:"empty-text"},"-",-1)])))])]),_:1}),t(U,{prop:"title",label:"标题","min-width":"200"}),t(U,{label:"分享人/部门","min-width":"150"},{default:s(({row:l})=>[o("div",Tt,[l.custom_sharer?(i(),d("div",Ft,[t(b,{color:"#67C23A",size:"14"},{default:s(()=>[t(y(re))]),_:1}),o("span",qt,f(l.custom_sharer),1)])):v("",!0),l.custom_department?(i(),d("div",At,[t(b,{color:"#F56C6C",size:"14"},{default:s(()=>[t(y(Ue))]),_:1}),o("span",Et,f(l.custom_department),1)])):v("",!0),!l.custom_sharer&&!l.custom_department?(i(),d("div",Mt,e[27]||(e[27]=[o("span",{class:"empty-text"},"-",-1)]))):v("",!0)])]),_:1}),t(U,{prop:"category",label:"类型",width:"100"},{default:s(({row:l})=>[t(fe,{type:Ee(l.category),size:"large"},{default:s(()=>[_(f(ce(l.category)),1)]),_:2},1032,["type"])]),_:1}),t(U,{label:"附件/链接",width:"100"},{default:s(({row:l})=>[l.attachment_url?(i(),z(h,{key:0,type:"primary",link:"",onClick:L=>Le(l)},{default:s(()=>[t(b,{color:"#409EFF",size:"18"},{default:s(()=>[t(y(Se))]),_:1})]),_:2},1032,["onClick"])):l.link_url?(i(),z(h,{key:1,type:"primary",link:"",onClick:L=>me(l.link_url)},{default:s(()=>[t(b,{color:"#67C23A",size:"18"},{default:s(()=>[t(y(rt))]),_:1})]),_:2},1032,["onClick"])):(i(),d("span",Bt,"-"))]),_:1}),w.value?(i(),z(U,{key:1,prop:"is_show",label:"展示状态",width:"80"},{default:s(({row:l})=>[t(fe,{type:l.is_show?"success":"danger",size:"large"},{default:s(()=>[_(f(l.is_show?"显示":"隐藏"),1)]),_:2},1032,["type"])]),_:1})):v("",!0),t(U,{prop:"created_at",label:"创建时间",width:"150"},{default:s(({row:l})=>[_(f(new Date(l.created_at).toLocaleString()),1)]),_:1}),w.value?(i(),z(U,{key:2,prop:"created_by_name",label:"创建人",width:"80"})):v("",!0),t(U,{label:"操作",width:"230",fixed:"right"},{default:s(({row:l})=>[t(et,null,{default:s(()=>[t(h,{type:"primary",onClick:L=>Pe(l)},{default:s(()=>e[28]||(e[28]=[_("查看")])),_:2},1032,["onClick"]),Me(l)?(i(),z(h,{key:0,type:"warning",onClick:L=>Qe(l)},{default:s(()=>e[29]||(e[29]=[_("编辑")])),_:2},1032,["onClick"])):v("",!0),Be(l)?(i(),z(h,{key:1,type:"danger",onClick:L=>Xe(l)},{default:s(()=>e[30]||(e[30]=[_("删除")])),_:2},1032,["onClick"])):v("",!0)]),_:2},1024)]),_:1}),t(tt,null,{description:s(()=>e[31]||(e[31]=[_(" 暂无分享数据 ")])),_:1})]),_:1},8,["data"])),[[ot,V.value]])]),_:1}),t(_t,{pagination:q,"onUpdate:pagination":Ne},null,8,["pagination"]),t(I,{title:"分享详情",modelValue:E.value,"onUpdate:modelValue":e[7]||(e[7]=l=>E.value=l),width:"60%","close-on-click-modal":!1,top:"5vh",class:"case-detail-dialog"},{footer:s(()=>[o("span",ia,[t(h,{onClick:e[6]||(e[6]=l=>E.value=!1)},{default:s(()=>e[42]||(e[42]=[_("关闭")])),_:1})])]),default:s(()=>{var l,L,ge,he,ye,we,be,ke,Ve,Ce,xe,ze,De;return[o("div",Nt,[o("div",Pt,[o("div",Lt,[o("h2",Yt,f(((l=c.value)==null?void 0:l.title)||"无标题"),1),o("div",jt,[o("span",Ot,[t(b,null,{default:s(()=>[t(y(re))]),_:1}),o("span",null,f(((L=c.value)==null?void 0:L.created_by_name)||"未知用户"),1)]),o("span",Ht,[t(b,null,{default:s(()=>[t(y(ne))]),_:1}),o("span",null,f(c.value?new Date((ge=c.value)==null?void 0:ge.created_at).toLocaleString():"未知时间"),1)]),o("span",Qt,[t(b,null,{default:s(()=>[t(y(it))]),_:1}),o("span",null,f(ce(((he=c.value)==null?void 0:he.category)||"")),1)])])]),o("div",Rt,[e[32]||(e[32]=o("div",{class:"section-title"},"内容",-1)),o("div",{class:"case-content",style:{padding:"10px"},innerHTML:((ye=c.value)==null?void 0:ye.content)||"无内容"},null,8,Gt)]),(we=c.value)!=null&&we.attachment_url?(i(),d("div",Jt,[e[34]||(e[34]=o("div",{class:"section-title"},"附件",-1)),o("div",Wt,[t(b,{color:"#409EFF",size:"16"},{default:s(()=>[t(y(Se))]),_:1}),o("span",Xt,f(c.value.attachment_name),1),t(h,{type:"primary",size:"small",onClick:Ye},{default:s(()=>e[33]||(e[33]=[_("查看附件")])),_:1})])])):v("",!0),(be=c.value)!=null&&be.link_url?(i(),d("div",Kt,[e[37]||(e[37]=o("div",{class:"section-title"},"相关链接",-1)),o("div",Zt,[t(b,{color:"#67C23A",size:"16"},{default:s(()=>e[35]||(e[35]=[o("link",null,null,-1)])),_:1}),o("span",It,f(c.value.link_url),1),t(h,{type:"success",size:"small",onClick:e[5]||(e[5]=ya=>me(c.value.link_url))},{default:s(()=>e[36]||(e[36]=[_("打开链接")])),_:1})])])):v("",!0),(ke=c.value)!=null&&ke.custom_month||(Ve=c.value)!=null&&Ve.custom_sharer||(Ce=c.value)!=null&&Ce.custom_department?(i(),d("div",ea,[e[41]||(e[41]=o("div",{class:"section-title"},"分享信息",-1)),o("div",ta,[(xe=c.value)!=null&&xe.custom_month?(i(),d("div",aa,[t(b,{color:"#E6A23C",size:"16"},{default:s(()=>[t(y(ne))]),_:1}),e[38]||(e[38]=o("span",{class:"custom-label"},"月份：",-1)),o("span",la,f(c.value.custom_month),1)])):v("",!0),(ze=c.value)!=null&&ze.custom_sharer?(i(),d("div",sa,[t(b,{color:"#67C23A",size:"16"},{default:s(()=>[t(y(re))]),_:1}),e[39]||(e[39]=o("span",{class:"custom-label"},"分享人：",-1)),o("span",oa,f(c.value.custom_sharer),1)])):v("",!0),(De=c.value)!=null&&De.custom_department?(i(),d("div",na,[t(b,{color:"#F56C6C",size:"16"},{default:s(()=>[t(y(Ue))]),_:1}),e[40]||(e[40]=o("span",{class:"custom-label"},"部门：",-1)),o("span",ra,f(c.value.custom_department),1)])):v("",!0)])])):v("",!0)])])]}),_:1},8,["modelValue"]),t(I,{modelValue:H.value,"onUpdate:modelValue":e[9]||(e[9]=l=>H.value=l),title:"附件预览",width:"80%","destroy-on-close":""},{footer:s(()=>[o("span",_a,[t(h,{onClick:e[8]||(e[8]=l=>H.value=!1)},{default:s(()=>e[45]||(e[45]=[_("关闭")])),_:1}),se.value||oe.value?(i(),z(h,{key:0,type:"primary",onClick:de},{default:s(()=>e[46]||(e[46]=[_(" 全屏查看 ")])),_:1})):v("",!0)])]),default:s(()=>[o("div",ua,[se.value?(i(),d("img",{key:0,src:F.value,class:"attachment-image",onClick:de},null,8,ca)):oe.value?(i(),d("iframe",{key:1,src:F.value,class:"attachment-frame"},null,8,da)):(i(),d("div",ma,[e[44]||(e[44]=o("p",null,"无法预览此类型的文件，请下载后查看",-1)),t(h,{type:"primary",onClick:je},{default:s(()=>e[43]||(e[43]=[_("下载附件")])),_:1})]))])]),_:1},8,["modelValue"]),t(I,{modelValue:le.value,"onUpdate:modelValue":e[10]||(e[10]=l=>le.value=l),title:"全屏预览",width:"100%",top:"0","show-close":!0,"destroy-on-close":"",class:"fullscreen-dialog"},{default:s(()=>[o("div",pa,[se.value?(i(),d("img",{key:0,src:F.value,class:"fullscreen-image"},null,8,va)):oe.value?(i(),d("iframe",{key:1,src:F.value,class:"fullscreen-frame"},null,8,fa)):v("",!0)])]),_:1},8,["modelValue"]),t(I,{title:B.value?"编辑分享":"知识分享",modelValue:j.value,"onUpdate:modelValue":e[20]||(e[20]=l=>j.value=l),width:"50%","close-on-click-modal":!1},{footer:s(()=>[o("span",ga,[t(h,{onClick:e[19]||(e[19]=l=>j.value=!1)},{default:s(()=>e[49]||(e[49]=[_("取消")])),_:1}),t(h,{type:"primary",onClick:We,loading:W.value},{default:s(()=>[_(f(B.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:s(()=>[t(y(ut),{model:n,rules:qe,ref_key:"caseForm",ref:ae,"label-width":"80px",style:{"max-width":"800px"}},{default:s(()=>[t($,{label:"标题",prop:"title"},{default:s(()=>[t(A,{modelValue:n.title,"onUpdate:modelValue":e[11]||(e[11]=l=>n.title=l),placeholder:"请输入分享标题"},null,8,["modelValue"])]),_:1}),t($,{label:"类型",prop:"category"},{default:s(()=>[t(R,{modelValue:n.category,"onUpdate:modelValue":e[12]||(e[12]=l=>n.category=l),placeholder:"选择分享类型",style:{width:"100%"}},{default:s(()=>[(i(),d(Te,null,Fe(ue,l=>t(P,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t($,{label:"内容",prop:"content"},{default:s(()=>[t(A,{type:"textarea",modelValue:n.content,"onUpdate:modelValue":e[13]||(e[13]=l=>n.content=l),rows:10,placeholder:"请输入分享内容"},null,8,["modelValue"])]),_:1}),t($,{label:"附件"},{default:s(()=>[t(lt,{class:"upload-box","auto-upload":!1,"on-change":Ge,"file-list":Z.value,limit:1,drag:"",action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15",multiple:""},{tip:s(()=>e[47]||(e[47]=[o("div",{class:"el-upload__tip"}," 支持 .pdf, .doc, .docx, .xls, .xlsx, 图片等格式文件，不超过10MB ",-1)])),default:s(()=>[t(b,{class:"el-icon--upload"},{default:s(()=>[t(y(ct))]),_:1}),e[48]||(e[48]=o("div",{class:"el-upload__text"},[_(" 拖拽文件或"),o("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1}),t($,{label:"链接"},{default:s(()=>[t(A,{modelValue:n.link_url,"onUpdate:modelValue":e[14]||(e[14]=l=>n.link_url=l),placeholder:"请输入相关链接（可选）"},null,8,["modelValue"])]),_:1}),t($,{label:"分享月份"},{default:s(()=>[t(pe,{modelValue:n.custom_month,"onUpdate:modelValue":e[15]||(e[15]=l=>n.custom_month=l),type:"month",placeholder:"选择月份（可选）",format:"YYYY年MM月","value-format":"YYYY年MM月",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t($,{label:"分享人"},{default:s(()=>[t(A,{modelValue:n.custom_sharer,"onUpdate:modelValue":e[16]||(e[16]=l=>n.custom_sharer=l),placeholder:"请输入自定义分享人（可选）"},null,8,["modelValue"])]),_:1}),t($,{label:"分享部门"},{default:s(()=>[t(A,{modelValue:n.custom_department,"onUpdate:modelValue":e[17]||(e[17]=l=>n.custom_department=l),placeholder:"请输入分享部门（可选）"},null,8,["modelValue"])]),_:1}),w.value?(i(),z($,{key:0,label:"状态"},{default:s(()=>[t(st,{modelValue:n.is_show,"onUpdate:modelValue":e[18]||(e[18]=l=>n.is_show=l),"active-text":"显示","inactive-text":"隐藏"},null,8,["modelValue"])]),_:1})):v("",!0)]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])])}}}),Ca=pt(ha,[["__scopeId","data-v-eeb5e432"]]);export{Ca as default};
