import{e as L,E as j}from"./elementPlus-DvW_yQnS.js";import{u as H,_ as N,s as O}from"./index-qHT9h40T.js";import{x as R,r as g,j as A,G as u,H as e,P as t,ag as a,A as f,L as S,M as x,u as P,az as D,z as s,c as T,y as $,O as z,a6 as E,K as U,aE as q}from"./vendor-COQJj1AX.js";import"./supabase-ndUUYBZa.js";const F={class:"toolbar",style:{display:"flex","justify-content":"end","align-items":"center"}},G={style:{display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","margin-right":"5px"}},J=R({__name:"Header",setup(B){const w=D(),y=H(),l=g(y.user);console.log(l.value,"user"),g(""),A(()=>{l.value=y.getUser()});const r=()=>{y.logout(),w.push("/login")};return(k,c)=>{const d=a("el-col"),M=a("el-avatar"),b=a("el-icon"),C=a("el-link"),n=a("el-dropdown-item"),m=a("el-dropdown-menu"),i=a("el-dropdown"),_=a("el-row"),v=a("el-header");return s(),u(v,{style:{"font-size":"16px"}},{default:e(()=>[t(_,{justify:"space-between",gutter:16,style:{height:"100%","align-items":"center"}},{default:e(()=>[t(d,{span:3},{default:e(()=>c[0]||(c[0]=[f("h1",{style:{"font-size":"40px","font-weight":"700"}},"IWISH",-1)])),_:1}),t(d,{span:4},{default:e(()=>{var h,o;return[f("div",F,[t(M,{style:{"margin-right":"10px","min-width":"40px","font-size":"20px","font-weight":"700","align-items":"center","line-height":"40px","justify-content":"center",background:"#2f87ff"},src:(h=l.value)==null?void 0:h.avatar_url},{default:e(()=>{var p,I,V;return[S(x(((V=(I=(p=l.value)==null?void 0:p.full_name)==null?void 0:I.charAt(0))==null?void 0:V.toUpperCase())||"U"),1)]}),_:1},8,["src"]),f("span",G,x((o=l.value)==null?void 0:o.full_name),1),t(i,null,{dropdown:e(()=>[t(m,null,{default:e(()=>[t(n,null,{default:e(()=>[t(C,{href:"/system/personal-data"},{default:e(()=>c[1]||(c[1]=[S(" 个人中心")])),_:1})]),_:1}),t(n,{onClick:r},{default:e(()=>c[2]||(c[2]=[S("退出登录")])),_:1})]),_:1})]),default:e(()=>[t(b,{style:{"margin-right":"10px","margin-top":"1px","font-size":"18px",color:"#fff"}},{default:e(()=>[t(P(L))]),_:1})]),_:1})])]}),_:1})]),_:1})]),_:1})}}}),K=N(J,[["__scopeId","data-v-8f6d8bf3"]]),W=R({__name:"Aside",setup(B){D();const w=g(""),y=g([]),l=g(!1),r=H(),k=T(()=>r.getMenus),c=n=>{w.value=n,n==="/system/demand"&&b()},d=g("");A(async()=>{l.value=!0,await r.fetchMenus();const{data:{session:n}}=await O.auth.getSession();d.value=(n==null?void 0:n.access_token)||"",l.value=!1});function M(n){const m=typeof n=="string"?n:JSON.stringify(n);return btoa(unescape(encodeURIComponent(m))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const b=()=>{var n,m,i,_,v,h;try{const o={id:((n=r.user)==null?void 0:n.user_id)||"",email:((m=r.user)==null?void 0:m.email)||"",name:((i=r.user)==null?void 0:i.full_name)||((v=(_=r.user)==null?void 0:_.email)==null?void 0:v.split("@")[0])||"用户",role:C((h=r.user)==null?void 0:h.role_id)},p=M(o);window.open(`https://iwishneed.netlify.app/auth/bridge?external_user=${p}&main_access_token=${d.value}`,"_blank")}catch(o){console.error("处理demand跳转失败:",o),j.error("跳转失败，请稍后重试")}},C=n=>{if(!n)return"submitter";switch(n){case 0:case 1:return"admin";case 2:case 3:return"manager";case 4:case 5:return"developer";default:return"submitter"}};return(n,m)=>{const i=a("el-icon"),_=a("el-menu-item"),v=a("el-sub-menu"),h=a("el-menu");return s(),u(h,{class:"el-menu-vertical-demo","active-text-color":"#fff","background-color":"#05479a","text-color":"#fff",style:{position:"fixed","z-index":"999",height:"calc(100vh - 84px)",left:"0",width:"240px"},router:!0,"unique-opened":!0,"default-active":w.value,"default-openeds":y.value,onSelect:c,loading:l.value},{default:e(()=>[(s(!0),$(z,null,E(k.value,o=>(s(),$(z,{key:o.id},[o.children&&o.children.length>0?(s(),u(v,{key:0,index:`/system${o.path}`},{title:e(()=>[t(i,null,{default:e(()=>[(s(),u(U(o.icon)))]),_:2},1024),f("span",null,x(o.name),1)]),default:e(()=>[(s(!0),$(z,null,E(o.children,p=>(s(),u(_,{key:p.id,index:`/system${p.path}`},{default:e(()=>[S(x(p.name),1)]),_:2},1032,["index"]))),128))]),_:2},1032,["index"])):o.path==="/demand"?(s(),u(_,{key:1,onClick:b},{default:e(()=>[t(i,null,{default:e(()=>[(s(),u(U(o.icon)))]),_:2},1024),f("span",null,x(o.name),1)]),_:2},1024)):(s(),u(_,{key:2,index:`/system${o.path}`},{default:e(()=>[t(i,null,{default:e(()=>[(s(),u(U(o.icon)))]),_:2},1024),f("span",null,x(o.name),1)]),_:2},1032,["index"]))],64))),128))]),_:1},8,["default-active","default-openeds","loading"])}}}),Q={class:"common-layout"},X={class:"page-container"},Y={class:"loading-container"},Z=R({__name:"SystemMain",setup(B){return g([]),(w,y)=>{const l=a("el-aside"),r=a("RouterView"),k=a("el-skeleton"),c=a("el-main"),d=a("el-container");return s(),$("div",Q,[t(d,{direction:"vertical",style:{height:"100vh"}},{default:e(()=>[t(K),t(d,{style:{"margin-top":"84px"}},{default:e(()=>[t(l,{width:"240px"},{default:e(()=>[t(W)]),_:1}),t(d,null,{default:e(()=>[t(c,null,{default:e(()=>[f("div",X,[(s(),u(q,null,{default:e(()=>[t(r)]),fallback:e(()=>[f("div",Y,[t(k,{rows:3,animated:""})])]),_:1}))])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),ae=N(Z,[["__scopeId","data-v-f490535e"]]);export{ae as default};
