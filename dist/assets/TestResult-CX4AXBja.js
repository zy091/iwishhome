import{t as B}from"./testResultService-CLKXJGUr.js";import{d as Q,r as g,u as H,k as J,o as K,l as v,e as t,a as l,y as $,c as N,q as f,t as o,w as n,O as P,b as p,M as m,f as u,F as k,m as W,i as X,j as d,_ as Y}from"./index-BsBxzW2u.js";const Z={class:"test-result"},ee={class:"test-body"},te={class:"test-header"},se={class:"details-header"},ae={class:"detail-item"},le={class:"detail-item"},ne={class:"label"},re={class:"detail-item"},oe={class:"answer-list"},ie={class:"question-header"},ue={class:"question-number"},de={class:"question-type"},ce={key:0,class:"answer-result"},_e={class:"question-content"},ve={class:"content"},pe={class:"answer-content"},ge={class:"content"},fe={key:0,class:"answer-content"},me={class:"content"},ye={class:"evaluation-section"},be={class:"evaluation-header"},we={class:"evaluation-item"},he={class:"evaluation-feedback"},ke={class:"feedback-content"},De=Q({__name:"TestResult",setup(Te){const A=X(),b=g(!1),w=g(!1),y=g([]),h=g(!1),r=g(null),D=g([]),T=H(),x=J(()=>{var e,i;const s=(i=(e=T.user)==null?void 0:e.role)==null?void 0:i.mark;return Array.isArray(s)&&s.length>0}),L=async()=>{b.value=!0;try{const{data:s}=await B.getUserTestResults({page:1,pageSize:100});y.value=s.sort((e,i)=>new Date(i.submitted_at).getTime()-new Date(e.submitted_at).getTime())}catch(s){console.error("获取测试记录失败:",s),s.message==="用户未登录"?m.error("请先登录后再查看测试记录"):s.message==="无效的用户ID格式"?m.error("用户信息异常，请重新登录"):m.error("获取测试记录失败，请稍后重试"),y.value=[]}finally{b.value=!1}},M=async s=>{w.value=!0,r.value=s,h.value=!0;try{const e=await B.getTestResultDetails(s.id);D.value=e.answerDetails}catch(e){console.error("加载测试详情失败:",e),m.error("加载测试详情失败，请稍后重试")}finally{w.value=!1}},q=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",z=(s,e,i,c)=>{if(s===null)return"info";if(e=="comprehensive")return i?"success":"warning";if(e=="case")switch(c){case"A":return"success";case"B":return"warning";case"C":return"warning";case"D":return"danger";default:return"info"}return s>=80?"success":s>=60?"warning":"danger"},C=s=>{const{score:e,type:i,is_graded:c,grade_level:_}=s;return c?i==="case"?_?`评级: ${_}`:`${e}分`:i==="comprehensive"?`${e}分`:`${e}分`:"待批改"},U=s=>{switch(s){case"A":return"success";case"B":return"success";case"C":return"warning";case"D":return"danger";default:return"info"}},j=s=>{switch(s){case"select":return"选择题";case"judge":return"判断题";case"fill":return"填空题";case"question":return"简答题";case"reading":return"阅读题";default:return"未知类型"}},E=()=>{var s,e;if(x.value){const i=(e=(s=T.user)==null?void 0:s.role)==null?void 0:e.mark[0];A.push(`/system/training-and-learning?platform=${i}`)}else m.error("您没有权限进行学习")};return K(()=>{L()}),(s,e)=>{const i=p("el-button"),c=p("el-table-column"),_=p("el-tag"),F=p("el-button-group"),I=p("el-empty"),G=p("el-table"),R=p("el-divider"),O=p("el-dialog"),V=P("loading");return d(),v("div",Z,[t("div",ee,[t("div",te,[t("div",null,"共计"+o(y.value.length)+"条测试记录",1),x.value?(d(),N(i,{key:0,type:"primary",onClick:E},{default:n(()=>e[1]||(e[1]=[u("开始学习")])),_:1})):f("",!0)]),$((d(),N(G,{data:y.value},{default:n(()=>[l(c,{prop:"test_title",label:"测试标题"}),l(c,{prop:"score",label:"分数/评级"},{default:n(a=>[l(_,{size:"large",style:{"font-size":"14px"},type:z(a.row.score,a.row.type,a.row.is_graded,a.row.grade_level||"")},{default:n(()=>[u(o(C(a.row)),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"is_graded",label:"批改状态"},{default:n(a=>[l(_,{style:{"font-size":"14px"},size:"large",type:a.row.is_graded?"success":"warning"},{default:n(()=>[u(o(a.row.is_graded?"已批改":"待批改"),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"submitted_at",label:"提交时间",width:"180"},{default:n(a=>[u(o(q(a.row.submitted_at)),1)]),_:1}),l(c,{label:"操作",width:"100"},{default:n(a=>[l(F,null,{default:n(()=>[l(i,{type:"primary",onClick:S=>M(a.row)},{default:n(()=>e[2]||(e[2]=[u("查看详情")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1}),l(I,null,{description:n(()=>e[3]||(e[3]=[u(" 暂无测试记录 ")])),_:1})]),_:1},8,["data"])),[[V,b.value]])]),l(O,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),title:"测试详情",width:"700px"},{default:n(()=>[$((d(),v("div",null,[r.value?(d(),v(k,{key:0},[t("div",se,[t("div",ae,[e[4]||(e[4]=t("span",{class:"label"},"测试标题:",-1)),t("span",null,o(r.value.test_title||"无标题"),1)]),e[6]||(e[6]=t("div",{class:"detail-item"},[t("span",{class:"label"},"满分:100"),t("span")],-1)),t("div",le,[t("span",ne,o(r.value.type==="case"&&r.value.grade_level?"评级:":"得分:"),1),l(_,{size:"large",style:{"font-size":"14px"},type:z(r.value.score,r.value.type,r.value.is_graded,r.value.grade_level||"")},{default:n(()=>[u(o(C(r.value)),1)]),_:1},8,["type"])]),t("div",re,[e[5]||(e[5]=t("span",{class:"label"},"提交时间:",-1)),t("span",null,o(q(r.value.submitted_at)),1)])]),l(R),t("div",oe,[(d(!0),v(k,null,W(D.value,(a,S)=>(d(),v("div",{key:a.id,class:"answer-item"},[t("div",ie,[t("div",ue,"问题 "+o(S+1),1),t("div",de,[l(_,null,{default:n(()=>[u(o(j(a.question_type)),1)]),_:2},1024)]),a.is_correct!==null&&a.question_type!="reading"?(d(),v("div",ce,[l(_,{type:a.is_correct?"success":"danger"},{default:n(()=>[u(o(a.is_correct?"正确":"错误"),1)]),_:2},1032,["type"])])):f("",!0)]),t("div",_e,[e[7]||(e[7]=t("div",{class:"label"},"题目:",-1)),t("div",ve,o(a.question_text),1)]),t("div",pe,[e[8]||(e[8]=t("div",{class:"label"},"您的答案:",-1)),t("div",ge,o(a.answer),1)]),a.question_type==="reading"&&a.score==0?f("",!0):(d(),v("div",fe,[e[9]||(e[9]=t("div",{class:"label"},"得分:",-1)),t("div",me,o(a.score),1)]))]))),128))]),r.value.type==="case"&&r.value.is_graded?(d(),v(k,{key:0},[l(R,{"content-position":"left"},{default:n(()=>e[10]||(e[10]=[u("教师评价")])),_:1}),t("div",ye,[t("div",be,[t("div",we,[e[11]||(e[11]=t("span",{class:"label"},"综合评级:",-1)),l(_,{size:"large",style:{"font-size":"16px"},type:U(r.value.grade_level)},{default:n(()=>[u(o(r.value.grade_level||"-"),1)]),_:1},8,["type"])])]),t("div",he,[e[12]||(e[12]=t("div",{class:"label"},"评语:",-1)),t("div",ke,o(r.value.feedback_text||"老师暂未留下具体评价。"),1)])])],64)):f("",!0)],64)):f("",!0)])),[[V,w.value]])]),_:1},8,["modelValue"])])}}}),ze=Y(De,[["__scopeId","data-v-fd859345"]]);export{ze as default};
