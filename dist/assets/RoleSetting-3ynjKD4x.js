import{d as K,r as p,J as O,k as P,o as Q,l as Y,a as t,e as m,K as G,w as a,b as s,P as W,M as _,g as X,a5 as Z,f as i,y as ee,O as te,c as x,t as R,q as le,U as ae,j as v,_ as oe}from"./index-DftwwiuU.js";import{g as ne,d as re,u as se,c as ie}from"./role-yrQ7DzLs.js";const de={class:"layout"},ue={class:"role-content"},pe={class:"card-header"},ce={class:"header-actions"},me={style:{"font-size":"14px",color:"#909399"}},_e={class:"dialog-footer"},fe=K({__name:"RoleSetting",setup(ge){const U=[{name:"角色管理",path:"/system/role-setting"}],h=p(!1),g=p([]),b=p(""),f=p(!1),y=p(""),C=p(null),r=O({page:1,pageSize:10,total:0}),n=p({role_id:"",name:"",mark:[],description:""}),$={role_id:[{required:!0,message:"请输入角色ID",trigger:"blur"}],name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],description:[{required:!0,message:"请输入描述",trigger:"blur"}]},V=p([]),B=P(()=>{const l=(r.page-1)*r.pageSize,e=l+r.pageSize;return g.value.slice(l,e)}),w=async()=>{h.value=!0;try{const l=await ne();V.value=l.data,g.value=l.data,r.total=l.data.length}catch(l){console.error("获取角色列表失败:",l),_.error("获取角色列表失败")}finally{h.value=!1}},N=l=>{r.page=l.page,r.pageSize=l.pageSize,w()},M=()=>{if(r.page=1,!b.value){g.value=V.value,r.total=V.value.length;return}g.value=V.value.filter(l=>l.name.includes(b.value)),r.total=g.value.length},I=()=>{y.value="添加角色",n.value={role_id:"",name:"",mark:[],description:""},f.value=!0},L=l=>{y.value="编辑角色",n.value={...l},f.value=!0},q=async l=>{if(Number(l.role_id)===0){_.warning("系统内置角色不允许删除！");return}try{await ae.confirm("确定要删除该角色吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await re(Number(l.role_id)),_.success("删除成功"),w()}catch(e){e!=="cancel"&&(console.error("删除角色失败:",e),_.error("删除失败"))}},E=async()=>{C.value&&await C.value.validate(async l=>{if(l)try{n.value.id?(await se(Number(n.value.role_id),n.value),_.success("更新成功")):(await ie(n.value),_.success("创建成功")),f.value=!1,w()}catch(e){console.error(n.value.role_id?"更新失败:":"创建失败:",e),_.error(n.value.role_id?"更新失败":"创建失败")}})};function z(l){if(!l)return"-";const e=new Date(l),c=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),D=String(e.getDate()).padStart(2,"0"),k=String(e.getHours()).padStart(2,"0"),u=String(e.getMinutes()).padStart(2,"0");return`${c}-${d}-${D} ${k}:${u}`}return Q(async()=>{await w()}),(l,e)=>{const c=s("el-input"),d=s("el-button"),D=s("el-space"),k=s("el-card"),u=s("el-table-column"),F=s("el-button-group"),T=s("el-table"),S=s("el-form-item"),j=s("el-form"),A=s("el-dialog"),H=te("loading");return v(),Y("div",de,[t(G,{breadbcrum:U}),e[14]||(e[14]=m("div",{class:"layout-title"},[m("h1",{class:"title"},"角色管理")],-1)),t(k,{shadow:"always",style:{"margin-bottom":"20px"}},{default:a(()=>[t(D,{wrap:"",alignment:"start",size:30},{default:a(()=>[t(c,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),style:{width:"240px"},placeholder:"请输入角色名称","suffix-icon":X(Z),size:"large",clearable:""},null,8,["modelValue","suffix-icon"]),t(d,{type:"primary",size:"large",onClick:M},{default:a(()=>e[7]||(e[7]=[i("搜索")])),_:1}),t(d,{type:"success",size:"large",onClick:I},{default:a(()=>e[8]||(e[8]=[i("添加角色")])),_:1})]),_:1})]),_:1}),m("div",ue,[t(k,{style:{"min-height":"400px"}},{header:a(()=>[m("div",pe,[e[9]||(e[9]=i(" 角色列表 ")),m("div",ce,[m("div",me,"共计"+R(r.total)+"条数据",1)])])]),default:a(()=>[ee((v(),x(T,{data:B.value,"row-key":"role_id"},{default:a(()=>[t(u,{prop:"role_id",label:"ID",width:"80"}),t(u,{prop:"name",label:"角色名称",width:"180"}),t(u,{prop:"description",label:"描述"}),t(u,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:o})=>[i(R(z(o.created_at)),1)]),_:1}),t(u,{prop:"updated_at",label:"更新时间",width:"180"},{default:a(({row:o})=>[i(R(z(o.updated_at)),1)]),_:1}),t(u,{label:"操作",width:"200"},{default:a(({row:o})=>[t(F,null,{default:a(()=>[t(d,{type:"primary",onClick:J=>L(o)},{default:a(()=>e[10]||(e[10]=[i(" 编辑 ")])),_:2},1032,["onClick"]),Number(o.role_id)!==0?(v(),x(d,{key:0,type:"danger",onClick:J=>q(o)},{default:a(()=>e[11]||(e[11]=[i(" 删除 ")])),_:2},1032,["onClick"])):le("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[H,h.value]])]),_:1}),t(W,{pagination:r,"onUpdate:pagination":N},null,8,["pagination"]),t(A,{title:y.value,modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=o=>f.value=o),width:"500px"},{footer:a(()=>[m("span",_e,[t(d,{onClick:e[5]||(e[5]=o=>f.value=!1)},{default:a(()=>e[12]||(e[12]=[i("取消")])),_:1}),t(d,{type:"primary",onClick:E},{default:a(()=>e[13]||(e[13]=[i("确定")])),_:1})])]),default:a(()=>[t(j,{model:n.value,rules:$,ref_key:"roleFormRef",ref:C,"label-width":"100px"},{default:a(()=>[y.value==="编辑角色"?(v(),x(S,{key:0,label:"角色ID",prop:"role_id"},{default:a(()=>[t(c,{modelValue:n.value.role_id,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.role_id=o),disabled:""},null,8,["modelValue"])]),_:1})):(v(),x(S,{key:1,label:"角色ID",prop:"role_id"},{default:a(()=>[t(c,{modelValue:n.value.role_id,"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.role_id=o)},null,8,["modelValue"])]),_:1})),t(S,{label:"角色名称",prop:"name"},{default:a(()=>[t(c,{modelValue:n.value.name,"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.name=o)},null,8,["modelValue"])]),_:1}),t(S,{label:"描述",prop:"description"},{default:a(()=>[t(c,{modelValue:n.value.description,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.description=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])])}}}),ye=oe(fe,[["__scopeId","data-v-6abd80c9"]]);export{ye as default};
