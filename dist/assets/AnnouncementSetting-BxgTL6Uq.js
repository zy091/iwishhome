import{E as f,s as W,c as X}from"./elementPlus-Be5V1zcU.js";import{B as Z,e as ee,s as x,b as te}from"./index-Dg6Dv2jL.js";import{x as ae,r as d,c as le,j as ne,y as oe,P as t,A as p,H as l,ag as s,u as se,L as u,I as re,aq as ue,G as ie,M as g,z as U}from"./vendor-CcmhhHhJ.js";import"./supabase-fOlwtt9p.js";const de={class:"layout"},ce={class:"announcement-content"},pe={class:"card-header"},me={class:"header-actions"},fe={style:{"font-size":"14px",color:"#909399"}},ve={class:"dialog-footer"},_e=ae({__name:"AnnouncementSetting",setup(ge){const A=[{name:"公告管理",path:"/system/announcement-setting"}],S=d(!1),v=d([]),y=d(""),m=d(!1),k=d(""),z=d(null),r=d({page:1,pageSize:10,total:0}),o=d({title:"",content:"",type:"normal",status:!1}),T={title:[{required:!0,message:"请输入公告标题",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}],type:[{required:!0,message:"请选择公告类型",trigger:"change"}]},b=d([]),q=le(()=>{const a=(r.value.page-1)*r.value.pageSize,e=a+r.value.pageSize;return v.value.slice(a,e)}),w=async()=>{S.value=!0;try{const{data:a,error:e}=await x.from("announcements").select("*").order("created_at",{ascending:!1});if(e)throw e;b.value=a||[],v.value=a||[],r.value.total=(a==null?void 0:a.length)||0}catch(a){console.error("获取公告列表失败:",a),f.error("获取公告列表失败")}finally{S.value=!1}},L=a=>{r.value.page=a.page,r.value.pageSize=a.pageSize,w()},M=()=>{if(r.value.page=1,!y.value){v.value=b.value,r.value.total=b.value.length;return}v.value=b.value.filter(a=>a.title.includes(y.value)),r.value.total=v.value.length},E=()=>{k.value="添加公告",o.value={title:"",content:"",type:"normal",status:!1},m.value=!0},F=a=>{k.value="编辑公告",o.value={...a},m.value=!0},I=async a=>{try{await X.confirm("确定要删除该公告吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const{error:e}=await x.from("announcements").delete().eq("id",a.id);if(e)throw e;f.success("删除成功"),w()}catch(e){e!=="cancel"&&(console.error("删除公告失败:",e),f.error("删除失败"))}},N=async()=>{z.value&&await z.value.validate(async a=>{if(a)try{if(o.value.id){const{error:e}=await x.from("announcements").update(o.value).eq("id",o.value.id);if(e)throw e;f.success("更新成功")}else{const{error:e}=await x.from("announcements").insert(o.value);if(e)throw e;f.success("创建成功")}m.value=!1,w()}catch(e){console.error(o.value.id?"更新失败:":"创建失败:",e),f.error(o.value.id?"更新失败":"创建失败")}})};function $(a){if(!a)return"-";const e=new Date(a),_=e.getFullYear(),c=String(e.getMonth()+1).padStart(2,"0"),C=String(e.getDate()).padStart(2,"0"),h=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0");return`${_}-${c}-${C} ${h}:${i}`}function H(a){switch(a){case"important":return"danger";case"update":return"success";default:return"info"}}function R(a){switch(a){case"important":return"重要";case"update":return"更新";default:return"普通"}}return ne(async()=>{await w()}),(a,e)=>{const _=s("el-input"),c=s("el-button"),C=s("el-space"),h=s("el-card"),i=s("el-table-column"),D=s("el-tag"),j=s("el-button-group"),G=s("el-table"),V=s("el-form-item"),B=s("el-option"),P=s("el-select"),Q=s("el-switch"),Y=s("el-form"),J=s("el-dialog"),K=ue("loading");return U(),oe("div",de,[t(Z,{breadcrumb:A}),e[14]||(e[14]=p("div",{class:"layout-title"},[p("h1",{class:"title"},"公告管理")],-1)),t(h,{shadow:"always",style:{"margin-bottom":"20px"}},{default:l(()=>[t(C,{wrap:"",alignment:"start",size:30},{default:l(()=>[t(_,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=n=>y.value=n),style:{width:"240px"},placeholder:"请输入公告标题","suffix-icon":se(W),size:"large",clearable:""},null,8,["modelValue","suffix-icon"]),t(c,{type:"primary",size:"large",onClick:M},{default:l(()=>e[7]||(e[7]=[u("搜索")])),_:1}),t(c,{type:"success",size:"large",onClick:E},{default:l(()=>e[8]||(e[8]=[u("添加公告")])),_:1})]),_:1})]),_:1}),p("div",ce,[t(h,{style:{"min-height":"400px"}},{header:l(()=>[p("div",pe,[e[9]||(e[9]=u(" 公告列表 ")),p("div",me,[p("div",fe,"共计"+g(r.value.total)+"条数据",1)])])]),default:l(()=>[re((U(),ie(G,{data:q.value,"row-key":"id"},{default:l(()=>[t(i,{prop:"id",label:"ID",width:"80"}),t(i,{prop:"title",label:"标题",width:"200"}),t(i,{prop:"content",label:"内容","show-overflow-tooltip":""}),t(i,{prop:"type",label:"类型",width:"100"},{default:l(({row:n})=>[t(D,{type:H(n.type)},{default:l(()=>[u(g(R(n.type)),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"status",label:"状态",width:"100"},{default:l(({row:n})=>[t(D,{type:n.status?"success":"info"},{default:l(()=>[u(g(n.status?"已发布":"未发布"),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"created_at",label:"创建时间",width:"180"},{default:l(({row:n})=>[u(g($(n.created_at)),1)]),_:1}),t(i,{prop:"updated_at",label:"更新时间",width:"180"},{default:l(({row:n})=>[u(g($(n.updated_at)),1)]),_:1}),t(i,{label:"操作",width:"200"},{default:l(({row:n})=>[t(j,null,{default:l(()=>[t(c,{type:"primary",onClick:O=>F(n)},{default:l(()=>e[10]||(e[10]=[u(" 编辑 ")])),_:2},1032,["onClick"]),t(c,{type:"danger",onClick:O=>I(n)},{default:l(()=>e[11]||(e[11]=[u(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[K,S.value]])]),_:1}),t(ee,{pagination:r.value,"onUpdate:pagination":L},null,8,["pagination"]),t(J,{title:k.value,modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=n=>m.value=n),width:"600px"},{footer:l(()=>[p("span",ve,[t(c,{onClick:e[5]||(e[5]=n=>m.value=!1)},{default:l(()=>e[12]||(e[12]=[u("取消")])),_:1}),t(c,{type:"primary",onClick:N},{default:l(()=>e[13]||(e[13]=[u("确定")])),_:1})])]),default:l(()=>[t(Y,{model:o.value,rules:T,ref_key:"announcementFormRef",ref:z,"label-width":"100px"},{default:l(()=>[t(V,{label:"标题",prop:"title"},{default:l(()=>[t(_,{modelValue:o.value.title,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.title=n)},null,8,["modelValue"])]),_:1}),t(V,{label:"内容",prop:"content"},{default:l(()=>[t(_,{modelValue:o.value.content,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.content=n),type:"textarea",rows:4},null,8,["modelValue"])]),_:1}),t(V,{label:"类型",prop:"type"},{default:l(()=>[t(P,{modelValue:o.value.type,"onUpdate:modelValue":e[3]||(e[3]=n=>o.value.type=n),placeholder:"请选择公告类型"},{default:l(()=>[t(B,{label:"重要",value:"important"}),t(B,{label:"普通",value:"normal"}),t(B,{label:"更新",value:"update"})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"状态",prop:"status"},{default:l(()=>[t(Q,{modelValue:o.value.status,"onUpdate:modelValue":e[4]||(e[4]=n=>o.value.status=n),"active-text":"发布","inactive-text":"隐藏"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])])}}}),Ve=te(_e,[["__scopeId","data-v-d0cb1b7e"]]);export{Ve as default};
