import{e as L,E as j}from"./elementPlus-DTEdDlyA.js";import{u as I,_ as N}from"./index-Dg-ntNTN.js";import{x as B,r as y,j as A,G as d,H as e,P as t,ag as n,A as f,L as $,M as b,u as O,az as D,z as l,c as P,y as M,O as U,a6 as E,K as H,aE as q}from"./vendor-COQJj1AX.js";import"./supabase-Dt8ksRgS.js";const F={class:"toolbar",style:{display:"flex","justify-content":"end","align-items":"center"}},G={style:{display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","margin-right":"5px"}},J=B({__name:"Header",setup(R){const w=D(),g=I(),r=y(g.user);console.log(r.value,"user"),y(""),A(()=>{r.value=g.getUser()});const s=()=>{g.logout(),w.push("/login")};return(k,c)=>{const i=n("el-col"),z=n("el-avatar"),C=n("el-icon"),a=n("el-link"),_=n("el-dropdown-item"),p=n("el-dropdown-menu"),m=n("el-dropdown"),h=n("el-row"),v=n("el-header");return l(),d(v,{style:{"font-size":"16px"}},{default:e(()=>[t(h,{justify:"space-between",gutter:16,style:{height:"100%","align-items":"center"}},{default:e(()=>[t(i,{span:3},{default:e(()=>c[0]||(c[0]=[f("h1",{style:{"font-size":"40px","font-weight":"700"}},"IWISH",-1)])),_:1}),t(i,{span:4},{default:e(()=>{var o,u;return[f("div",F,[t(z,{style:{"margin-right":"10px","min-width":"40px","font-size":"20px","font-weight":"700","align-items":"center","line-height":"40px","justify-content":"center",background:"#2f87ff"},src:(o=r.value)==null?void 0:o.avatar_url},{default:e(()=>{var x,S,V;return[$(b(((V=(S=(x=r.value)==null?void 0:x.full_name)==null?void 0:S.charAt(0))==null?void 0:V.toUpperCase())||"U"),1)]}),_:1},8,["src"]),f("span",G,b((u=r.value)==null?void 0:u.full_name),1),t(m,null,{dropdown:e(()=>[t(p,null,{default:e(()=>[t(_,null,{default:e(()=>[t(a,{href:"/system/personal-data"},{default:e(()=>c[1]||(c[1]=[$(" 个人中心")])),_:1})]),_:1}),t(_,{onClick:s},{default:e(()=>c[2]||(c[2]=[$("退出登录")])),_:1})]),_:1})]),default:e(()=>[t(C,{style:{"margin-right":"10px","margin-top":"1px","font-size":"18px",color:"#fff"}},{default:e(()=>[t(O(L))]),_:1})]),_:1})])]}),_:1})]),_:1})]),_:1})}}}),K=N(J,[["__scopeId","data-v-8f6d8bf3"]]),T=B({__name:"Aside",setup(R){D();const w=y(""),g=y([]),r=y(!1),s=I(),k=P(()=>s.getMenus);A(async()=>{r.value=!0,await s.fetchMenus(),r.value=!1,console.log(k.value,"aside menus")});const c=a=>{w.value=a,a==="/system/demand"&&z()};function i(a){const _=typeof a=="string"?a:JSON.stringify(a);return btoa(_).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const z=()=>{var a,_,p,m,h,v,o,u;try{const x={id:((a=s.user)==null?void 0:a.user_id)||"",email:((_=s.user)==null?void 0:_.email)||"",name:((p=s.user)==null?void 0:p.full_name)||((h=(m=s.user)==null?void 0:m.email)==null?void 0:h.split("@")[0])||"用户",role:C((v=s.user)==null?void 0:v.role_id),avatar:((o=s.user)==null?void 0:o.avatar_url)||`https://api.dicebear.com/7.x/avataaars/svg?seed=${((u=s.user)==null?void 0:u.user_id)||"user"}`},S=i(x);window.open(`http://localhost:5173/auth/bridge?external_user=${S}`,"_blank")}catch(x){console.error("处理demand跳转失败:",x),j.error("跳转失败，请稍后重试")}},C=a=>{if(!a)return"submitter";switch(a){case 0:case 1:return"admin";case 2:case 3:return"manager";case 4:case 5:return"developer";default:return"submitter"}};return(a,_)=>{const p=n("el-icon"),m=n("el-menu-item"),h=n("el-sub-menu"),v=n("el-menu");return l(),d(v,{class:"el-menu-vertical-demo","active-text-color":"#fff","background-color":"#05479a","text-color":"#fff",style:{position:"fixed","z-index":"999",height:"calc(100vh - 84px)",left:"0",width:"240px"},router:!0,"unique-opened":!0,"default-active":w.value,"default-openeds":g.value,onSelect:c,loading:r.value},{default:e(()=>[(l(!0),M(U,null,E(k.value,o=>(l(),M(U,{key:o.id},[o.children&&o.children.length>0?(l(),d(h,{key:0,index:`/system${o.path}`},{title:e(()=>[t(p,null,{default:e(()=>[(l(),d(H(o.icon)))]),_:2},1024),f("span",null,b(o.name),1)]),default:e(()=>[(l(!0),M(U,null,E(o.children,u=>(l(),d(m,{key:u.id,index:`/system${u.path}`},{default:e(()=>[$(b(u.name),1)]),_:2},1032,["index"]))),128))]),_:2},1032,["index"])):(l(),d(m,{key:1,index:`/system${o.path}`},{default:e(()=>[t(p,null,{default:e(()=>[(l(),d(H(o.icon)))]),_:2},1024),f("span",null,b(o.name),1)]),_:2},1032,["index"]))],64))),128))]),_:1},8,["default-active","default-openeds","loading"])}}}),W={class:"common-layout"},Q={class:"page-container"},X={class:"loading-container"},Y=B({__name:"SystemMain",setup(R){return y([]),(w,g)=>{const r=n("el-aside"),s=n("RouterView"),k=n("el-skeleton"),c=n("el-main"),i=n("el-container");return l(),M("div",W,[t(i,{direction:"vertical",style:{height:"100vh"}},{default:e(()=>[t(K),t(i,{style:{"margin-top":"84px"}},{default:e(()=>[t(r,{width:"240px"},{default:e(()=>[t(T)]),_:1}),t(i,null,{default:e(()=>[t(c,null,{default:e(()=>[f("div",Q,[(l(),d(q,null,{default:e(()=>[t(s)]),fallback:e(()=>[f("div",X,[t(k,{rows:3,animated:""})])]),_:1}))])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),oe=N(Y,[["__scopeId","data-v-f490535e"]]);export{oe as default};
