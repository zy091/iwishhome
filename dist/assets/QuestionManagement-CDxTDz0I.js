import{E as q,s as Be,y as Fe,c as ue}from"./elementPlus-DTEdDlyA.js";import{B as Me,b as Qe,s as F,_ as Ne}from"./index-CcL09R9_.js";import{x as Ee,X as L,r as y,j as Oe,y as m,P as n,A as s,H as o,ag as d,u as ie,O as V,a6 as h,L as u,I as Ie,G as b,J as v,aq as Te,M as g,D as Ae,z as r}from"./vendor-COQJj1AX.js";import"./supabase-Dt8ksRgS.js";const Ge={class:"layout"},Le={class:"card-header"},Pe={class:"header-actions"},Re={style:{"font-size":"14px",color:"#909399"}},je={class:"tooltip-content"},He={class:"text-truncate"},Je={style:{"margin-top":"10px"}},Xe={class:"question-details"},Ke={class:"detail-row"},We={class:"question-text"},Ye={key:0},Ze={key:1,class:"question-text question-text-reading"},et={class:"options-list"},tt=Ee({__name:"QuestionManagement",setup(lt){const de=L([{name:"数据管理",path:"/system/data-management"},{name:"试题管理",path:"/system/question-management"}]),M=y(!1),T=y([]),Q=y(""),N=y(""),E=y(""),k=y([]),C=y(!1),O=y(!1),I=y(!1),p=y(null),A=y(null),l=L({id:null,text:"",options:["",""],correct_answer:"",question_type:"select",platform:"",chapter:""}),P=[{label:"选择题",value:"select"},{label:"简答题",value:"reading"}],G=[{value:"google",label:"Google"},{value:"facebook",label:"Facebook"},{value:"microsoft",label:"Microsoft"},{value:"meta",label:"Meta"},{value:"other",label:"Other"}],R=[{value:"base",label:"基础"},{value:"middle",label:"中级"},{value:"advanced",label:"高级"}],w=L({page:1,pageSize:10,total:0}),pe={question_type:[{required:!0,message:"请选择题型",trigger:"change"}],platform:[{required:!0,message:"请选择平台",trigger:"change"}],chapter:[{required:!0,message:"请输入章节",trigger:"blur"}],text:[{required:!0,message:"请输入问题内容",trigger:"blur"}],correct_answer:[{required:!0,message:"请选择正确答案",trigger:"change"}]},j=a=>{const e=P.find(i=>i.value===a);return e?e.label:a},H=a=>{const e=G.find(i=>i.value===a);return e?e.label:a},ce=a=>{const e=R.find(i=>i.value===a);return e?e.label:a},me=a=>{w.page=a.page,w.pageSize=a.pageSize,z()},fe=a=>{k.value=a},z=async()=>{M.value=!0;try{let a=F.from("googlequestions").select("*",{count:"exact"});Q.value&&(a=a.ilike("text",`%${Q.value}%`)),N.value&&(a=a.eq("question_type",N.value)),E.value&&(a=a.eq("platform",E.value));const{data:e,error:i,count:f}=await a.order("id",{ascending:!1}).range((w.page-1)*w.pageSize,w.page*w.pageSize-1);if(i)throw i;T.value=e||[],w.total=f||0}catch(a){q.error("搜索问题失败"),console.error(a)}finally{M.value=!1}},ge=()=>{I.value=!1,J(),C.value=!0},ve=a=>{I.value=!0,J(),l.id=a.id,l.text=a.text,l.question_type=a.question_type,l.platform=a.platform,l.chapter=a.chapter,a.question_type==="select"&&(l.options=[...a.options]),l.correct_answer=a.correct_answer,C.value=!0},_e=a=>{p.value=a,O.value=!0},J=()=>{l.id=null,l.text="",l.options=["",""],l.correct_answer="",l.question_type="select",l.platform="",l.chapter=""},ye=()=>{l.options.length<6&&l.options.push("")},be=a=>{l.options.length>2&&(l.options.splice(a,1),l.correct_answer===l.options[a]&&(l.correct_answer=""))},we=async()=>{if(A.value)try{await A.value.validate();const a={text:l.text,question_type:l.question_type,platform:l.platform,chapter:l.chapter};l.question_type==="select"?(a.options=l.options,a.correct_answer=l.correct_answer):(a.options=null,a.correct_answer=null);let e;if(I.value&&l.id){const{data:i,error:f}=await F.from("googlequestions").update(a).eq("id",l.id).select();if(f)throw f;e=i,q.success("问题更新成功")}else{const{data:i,error:f}=await F.from("googlequestions").insert(a).select();if(f)throw f;e=i,q.success("问题添加成功")}C.value=!1,z()}catch(a){a!=="cancel"&&(console.error("保存问题失败:",a),q.error("保存失败，请检查表单"))}},Ve=async a=>{try{await ue.confirm("确定要删除这个问题吗？此操作不可恢复。","警告",{type:"warning"});const{error:e}=await F.from("googlequestions").delete().eq("id",a.id);if(e)throw e;q.success("删除成功"),z()}catch(e){e!=="cancel"&&(console.error("删除问题失败:",e),q.error("删除失败"))}},qe=async()=>{if(k.value.length!==0)try{await ue.confirm(`确定要删除选中的 ${k.value.length} 个问题吗？此操作不可恢复。`,"警告",{type:"warning"});const a=k.value.map(i=>i.id),{error:e}=await F.from("googlequestions").delete().in("id",a);if(e)throw e;q.success(`成功删除 ${k.value.length} 个问题`),k.value=[],z()}catch(a){a!=="cancel"&&(console.error("批量删除问题失败:",a),q.error("批量删除失败"))}};return Oe(()=>{z()}),(a,e)=>{const i=d("el-input"),f=d("el-option"),D=d("el-select"),_=d("el-button"),ke=d("el-space"),X=d("el-card"),U=d("el-table-column"),xe=d("el-tooltip"),S=d("el-tag"),he=d("el-button-group"),Ce=d("el-table"),ze=d("el-empty"),K=d("el-radio"),Ue=d("el-radio-group"),x=d("el-form-item"),$e=d("el-icon"),De=d("el-form"),W=d("el-dialog"),Se=Te("loading");return r(),m("div",Ge,[n(Me,{breadbcrum:de},null,8,["breadbcrum"]),e[38]||(e[38]=s("div",{class:"layout-title"},[s("h1",{class:"title"},"试题管理")],-1)),n(X,{shadow:"always",style:{"margin-bottom":"20px"}},{default:o(()=>[n(ke,{wrap:"",alignment:"start",size:30},{default:o(()=>[n(i,{modelValue:Q.value,"onUpdate:modelValue":e[0]||(e[0]=t=>Q.value=t),style:{width:"240px"},placeholder:"请输入试题内容","suffix-icon":ie(Be),size:"large",clearable:""},null,8,["modelValue","suffix-icon"]),n(D,{modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=t=>N.value=t),placeholder:"题型",clearable:"",style:{width:"180px"},size:"large"},{default:o(()=>[(r(),m(V,null,h(P,t=>n(f,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),n(D,{modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=t=>E.value=t),placeholder:"平台",clearable:"",style:{width:"180px"},size:"large"},{default:o(()=>[(r(),m(V,null,h(G,t=>n(f,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),n(_,{type:"primary",size:"large",onClick:z},{default:o(()=>e[14]||(e[14]=[u("搜索")])),_:1}),n(_,{type:"primary",size:"large",onClick:ge},{default:o(()=>e[15]||(e[15]=[u("添加试题")])),_:1})]),_:1})]),_:1}),n(X,{style:{"min-height":"400px"}},{header:o(()=>[s("div",Le,[e[17]||(e[17]=s("span",null,"试题列表",-1)),s("div",Pe,[n(_,{type:"danger",disabled:!k.value.length,onClick:qe},{default:o(()=>e[16]||(e[16]=[u(" 批量删除 ")])),_:1},8,["disabled"]),s("div",Re,"共计 "+g(w.total)+" 条数据",1)])])]),default:o(()=>[Ie((r(),b(Ce,{data:T.value,onSelectionChange:fe},{default:o(()=>[n(U,{type:"selection",width:"55"}),n(U,{prop:"question_type",label:"题型",width:"100"},{default:o(({row:t})=>[u(g(j(t.question_type)),1)]),_:1}),n(U,{prop:"text",label:"试题内容"},{default:o(({row:t})=>[n(xe,{placement:"top","show-after":500,"max-width":300},{content:o(()=>[s("div",je,g(t.text),1)]),default:o(()=>[s("div",He,g(t.text),1)]),_:2},1024)]),_:1}),n(U,{prop:"platform",label:"平台"},{default:o(({row:t})=>[u(g(H(t.platform)),1)]),_:1}),n(U,{prop:"chapter",label:"章节",width:"200"},{default:o(({row:t})=>[t.chapter==="base"?(r(),b(S,{key:0,type:"success",class:"chapter-tag",size:"large"},{default:o(()=>e[18]||(e[18]=[u("基础")])),_:1})):v("",!0),t.chapter==="middle"?(r(),b(S,{key:1,type:"warning",class:"chapter-tag",size:"large"},{default:o(()=>e[19]||(e[19]=[u("中级")])),_:1})):v("",!0),t.chapter==="advanced"?(r(),b(S,{key:2,type:"danger",class:"chapter-tag",size:"large"},{default:o(()=>e[20]||(e[20]=[u("高级")])),_:1})):v("",!0)]),_:1}),n(U,{label:"操作",width:"220",fixed:"right"},{default:o(({row:t})=>[n(he,null,{default:o(()=>[n(_,{type:"primary",onClick:c=>_e(t)},{default:o(()=>e[21]||(e[21]=[u("查看")])),_:2},1032,["onClick"]),n(_,{type:"success",onClick:c=>ve(t)},{default:o(()=>e[22]||(e[22]=[u("编辑")])),_:2},1032,["onClick"]),n(_,{type:"danger",onClick:c=>Ve(t)},{default:o(()=>e[23]||(e[23]=[u("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Se,M.value]]),!M.value&&T.value.length===0?(r(),b(ze,{key:0,description:"暂无问题"})):v("",!0)]),_:1}),n(Qe,{pagination:w,"onUpdate:pagination":me},null,8,["pagination"]),n(W,{title:I.value?"编辑试题":"添加试题",modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=t=>C.value=t),width:"50%"},{footer:o(()=>[n(_,{onClick:e[10]||(e[10]=t=>C.value=!1)},{default:o(()=>e[27]||(e[27]=[u("取消")])),_:1}),n(_,{type:"primary",onClick:we},{default:o(()=>e[28]||(e[28]=[u("确定")])),_:1})]),default:o(()=>[n(De,{model:l,rules:pe,ref_key:"questionFormRef",ref:A,"label-width":"100px"},{default:o(()=>[n(x,{label:"题型",prop:"question_type"},{default:o(()=>[n(Ue,{modelValue:l.question_type,"onUpdate:modelValue":e[3]||(e[3]=t=>l.question_type=t)},{default:o(()=>[n(K,{label:"select"},{default:o(()=>e[24]||(e[24]=[u("选择题")])),_:1}),n(K,{label:"reading"},{default:o(()=>e[25]||(e[25]=[u("简答题")])),_:1})]),_:1},8,["modelValue"])]),_:1}),n(x,{label:"平台",prop:"platform"},{default:o(()=>[n(D,{modelValue:l.platform,"onUpdate:modelValue":e[4]||(e[4]=t=>l.platform=t),placeholder:"请选择平台",style:{width:"100%"}},{default:o(()=>[(r(),m(V,null,h(G,t=>n(f,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),n(x,{label:"章节",prop:"chapter"},{default:o(()=>[n(D,{modelValue:l.chapter,"onUpdate:modelValue":e[5]||(e[5]=t=>l.chapter=t),placeholder:"请选择章节",style:{width:"100%"}},{default:o(()=>[(r(),m(V,null,h(R,t=>n(f,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),n(x,{label:"试题内容",prop:"text"},{default:o(()=>[l.question_type==="select"?(r(),b(i,{key:0,modelValue:l.text,"onUpdate:modelValue":e[6]||(e[6]=t=>l.text=t),type:"textarea",rows:4,placeholder:"请输入试题内容"},null,8,["modelValue"])):v("",!0),l.question_type==="reading"?(r(),b(i,{key:1,modelValue:l.text,"onUpdate:modelValue":e[7]||(e[7]=t=>l.text=t),type:"textarea",rows:8,placeholder:"请输入试题内容"},null,8,["modelValue"])):v("",!0)]),_:1}),l.question_type==="reading"?(r(),b(x,{key:0,label:"参考答案"},{default:o(()=>[n(i,{modelValue:l.correct_answer,"onUpdate:modelValue":e[8]||(e[8]=t=>l.correct_answer=t),type:"textarea",rows:5,placeholder:"请输入参考答案"},null,8,["modelValue"])]),_:1})):v("",!0),l.question_type==="select"?(r(),m(V,{key:1},[n(x,{label:"选项",prop:"options"},{default:o(()=>[(r(!0),m(V,null,h(l.options,(t,c)=>(r(),m("div",{key:c,class:"option-item"},[n(i,{modelValue:l.options[c],"onUpdate:modelValue":B=>l.options[c]=B,placeholder:"请输入选项内容"},{prefix:o(()=>[s("span",null,g(String.fromCharCode(65+c))+". ",1)]),append:o(()=>[n(_,{onClick:B=>be(c),disabled:l.options.length<=2},{default:o(()=>[n($e,null,{default:o(()=>[n(ie(Fe))]),_:1})]),_:2},1032,["onClick","disabled"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128)),s("div",Je,[n(_,{onClick:ye,disabled:l.options.length>=6},{default:o(()=>e[26]||(e[26]=[u("添加选项")])),_:1},8,["disabled"])])]),_:1}),n(x,{label:"正确答案",prop:"correct_answer"},{default:o(()=>[n(D,{modelValue:l.correct_answer,"onUpdate:modelValue":e[9]||(e[9]=t=>l.correct_answer=t),placeholder:"请选择正确答案",style:{width:"100%"}},{default:o(()=>[(r(!0),m(V,null,h(l.options,(t,c)=>(r(),b(f,{key:c,label:`${String.fromCharCode(65+c)}. ${t}`,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})],64)):v("",!0)]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),n(W,{title:"试题详情",modelValue:O.value,"onUpdate:modelValue":e[13]||(e[13]=t=>O.value=t),width:"50%"},{footer:o(()=>[n(_,{onClick:e[12]||(e[12]=t=>O.value=!1)},{default:o(()=>e[37]||(e[37]=[u("关闭")])),_:1})]),default:o(()=>{var t,c,B,Y,Z,ee,te,le,ae,oe;return[s("div",Xe,[s("div",Ke,[s("p",null,[e[29]||(e[29]=s("strong",null,"题型:",-1)),e[30]||(e[30]=u()),s("span",null,g(j((t=p.value)==null?void 0:t.question_type)),1)]),s("p",null,[e[31]||(e[31]=s("strong",null,"平台:",-1)),e[32]||(e[32]=u()),s("span",null,g(H((c=p.value)==null?void 0:c.platform)),1)]),n(S,{type:((B=p.value)==null?void 0:B.chapter)==="base"?"success":((Y=p.value)==null?void 0:Y.chapter)==="middle"?"warning":"danger",class:"chapter-detail-tag"},{default:o(()=>{var $;return[u(g(ce(($=p.value)==null?void 0:$.chapter)),1)]}),_:1},8,["type"])]),e[36]||(e[36]=s("p",null,[s("strong",null,"试题内容:")],-1)),s("div",We,g((Z=p.value)==null?void 0:Z.text),1),((ee=p.value)==null?void 0:ee.question_type)==="reading"?(r(),m("p",Ye,e[33]||(e[33]=[s("strong",null,"参考答案:",-1)]))):v("",!0),((te=p.value)==null?void 0:te.question_type)==="reading"?(r(),m("div",Ze,g((le=p.value)==null?void 0:le.correct_answer),1)):v("",!0),((ae=p.value)==null?void 0:ae.question_type)==="select"?(r(),m(V,{key:2},[e[35]||(e[35]=s("p",null,[s("strong",null,"选项:")],-1)),s("div",et,[(r(!0),m(V,null,h((oe=p.value)==null?void 0:oe.options,($,ne)=>{var se,re;return r(),m("div",{key:ne,class:"option-item"},[s("div",{class:Ae({"correct-answer":$===((se=p.value)==null?void 0:se.correct_answer)})},[u(g(String.fromCharCode(65+ne))+". "+g($)+" ",1),$===((re=p.value)==null?void 0:re.correct_answer)?(r(),b(S,{key:0,size:"small",type:"success"},{default:o(()=>e[34]||(e[34]=[u("正确答案")])),_:1})):v("",!0)],2)])}),128))])],64)):v("",!0)])]}),_:1},8,["modelValue"])])}}}),rt=Ne(tt,[["__scopeId","data-v-bd5a695a"]]);export{rt as default};
