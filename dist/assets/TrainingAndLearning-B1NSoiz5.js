import{x as re,r as c,az as ce,w as J,c as Q,X,j as ue,y as p,P as l,A as o,M as u,I as de,H as n,ag as d,aq as pe,G as B,J as L,O as me,a6 as _e,L as m,aA as ge,z as i}from"./vendor-CcmhhHhJ.js";import{B as ve,e as fe,b as ye}from"./index-BmK0bamU.js";import{t as he,P as be}from"./PersonalTestHistory-BmfXMtsz.js";import{t as we}from"./testResultService-B56Keqpe.js";import{E as z,c as ke}from"./elementPlus-Be5V1zcU.js";import"./supabase-fOlwtt9p.js";const Te={class:"training"},xe={class:"training-title"},Ce={class:"title"},Ve={class:"training-content"},Be={class:"test-list-container"},ze={class:"test-list"},qe={key:1,class:"test-grid"},Re={class:"test-card-content"},Se={class:"test-type-tag flex"},$e={class:"test-title"},Ae={class:"test-info"},Ie={class:"info-item"},Le={class:"info-item"},Ne={class:"info-item"},De={class:"test-status"},Ee={key:0,class:"status-tag"},Ue={class:"score-text"},Me={key:1,class:"status-tag"},Ge={key:2,class:"status-tag"},Pe={class:"test-actions"},Fe={key:2,class:"pagination"},f=2,He=re({__name:"TrainingAndLearning",setup(je){const y=ce(),N=ge(),h=c(y.query.platform||"google"),K=c(y.query.chapter||"base");J(()=>y.query.platform,e=>{h.value=e||"google"},{immediate:!0}),J(()=>y.query.chapter,e=>{K.value=e||"base"},{immediate:!0});const q=Q(()=>{switch(h.value){case"google":return"Google";case"facebook":return"FaceBook";default:return"Google"}}),W=X([{name:`${q.value}培训过程考核`,path:`/system/optimize?platform=${h.value}`},{name:`${q.value}考试内容`,path:"/system/training/study-materials"}]),b=c(!0),R=c([]),D=c({}),w=c(""),k=c(""),S=c(!1),_=X({page:1,pageSize:10,total:0}),Y=e=>{_.page=e.page,_.pageSize=e.pageSize,$()},E=c([]),Z=async()=>{try{const{data:e}=await we.getUserTestResults({page:1,pageSize:100}),t={};e.forEach(s=>{s.test_id&&(!t[s.test_id]||new Date(s.submitted_at)>new Date(t[s.test_id].submitted_at))&&(t[s.test_id]=s)}),E.value=e,D.value=t}catch(e){console.error("加载测试结果失败:",e),z.error("加载测试结果失败，请稍后重试")}};ue(async()=>{await Promise.all([$(),Z()])});const $=async()=>{b.value=!0;try{const{data:e,total:t}=await he.getTests({platform:h.value});_.total=t;let s=[...e];w.value&&(s=s.filter(r=>r.title.toLowerCase().includes(w.value.toLowerCase()))),k.value&&(s=s.filter(r=>r.type===k.value)),R.value=s,_.total=s.length}catch(e){console.error("加载测验失败:",e),z.error("加载测验失败，请稍后重试")}finally{b.value=!1}},A=()=>{_.page=1,$()},g=Q(()=>e=>D.value[e]),ee=e=>{var r;if(e.type==="case"&&C(e.id)>=f){z.warning(`您已达到maxAttempts(${f}次)，不能再次作答`);return}const t=e.type;let s="";switch(t){case"case":s="case-study";break;case"select":s="multiple-choice";break;case"comprehensive":s="comprehensive-test";break;default:s="multiple-choice"}((r=g.value(e.id))==null?void 0:r.completion_status)==="completed"?ke.confirm("您已完成此测验，确定要重新开始吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{N.push({name:s,query:{testId:e.id,testName:x(e.platform||"")+"-"+e.title,platform:e.platform,score_weight:e.score_weight,type:e.type}})}).catch(()=>{z.info("已取消重新开始")}):N.push({name:s,query:{testId:e.id,testName:x(e.platform||"")+"-"+e.title,platform:e.platform,score_weight:e.score_weight,type:e.type}})},T=c(null),te=e=>{T.value=e,S.value=!0},x=e=>{switch(e){case"select":return"选择题";case"case":return"案例分析";case"comprehensive":return"综合测验";case"google":return"Google";case"facebook":return"FaceBook";case"base":return"基础";case"middle":return"中级";case"advanced":return"高级";default:return"未知类型"}},U=e=>{switch(e){case"select":return"primary";case"case":return"success";case"comprehensive":return"warning";case"google":return"danger";case"facebook":return"primary";case"base":return"primary";case"middle":return"success";case"advanced":return"warning";default:return"info"}},C=e=>{let t=0;return Object.values(E.value).forEach(s=>{s.test_id===e&&t++}),t},ae=(e,t)=>{if(C((t==null?void 0:t.id)||"")>=f)return"尝试次数已用完";switch(e){case"completed":return"重新测试";case"in_progress":return"继续测试";default:return"开始测试"}},se=e=>e?e.is_graded?e.type==="case"&&e.grade_level?`评级: ${e.grade_level}`:`${e.score}分`:"待批改":"0分";return(e,t)=>{var P;const s=d("el-input"),r=d("el-option"),M=d("el-select"),I=d("el-button"),oe=d("el-space"),G=d("el-card"),le=d("el-empty"),v=d("el-tag"),ne=d("el-dialog"),ie=pe("loading");return i(),p("div",Te,[l(ve,{breadbcrum:W},null,8,["breadbcrum"]),o("div",xe,[o("h1",Ce,u(q.value)+"考试内容",1)]),o("div",Ve,[o("div",Be,[l(G,{class:"testing-search",style:{"margin-bottom":"20px"}},{default:n(()=>[l(oe,{alignment:"start",size:30},{default:n(()=>[l(s,{size:"large",style:{width:"240px"},modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=a=>w.value=a),placeholder:"搜索测验名称",class:"search-input",clearable:"",onInput:A},null,8,["modelValue"]),l(M,{size:"large",style:{width:"240px"},modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=a=>k.value=a),placeholder:"测验类型",onChange:A,class:"filter-select"},{default:n(()=>[l(r,{label:"全部类型",value:""}),l(r,{label:"选择题",value:"select"}),l(r,{label:"案例分析",value:"case"}),l(r,{label:"综合测验",value:"comprehensive"})]),_:1},8,["modelValue"]),l(I,{type:"primary",size:"large",onClick:A},{default:n(()=>t[3]||(t[3]=[m("搜索")])),_:1})]),_:1})]),_:1}),de((i(),p("div",ze,[R.value.length===0&&!b.value?(i(),B(le,{key:0,description:"暂无测验内容"})):(i(),p("div",qe,[(i(!0),p(me,null,_e(R.value,a=>(i(),B(G,{key:a.id,class:"test-card",shadow:"hover"},{default:n(()=>{var F,H,j,O;return[o("div",Re,[o("div",Se,[l(v,{type:U(a.type)},{default:n(()=>[m(u(x(a.type)),1)]),_:2},1032,["type"]),l(v,{type:U(a.platform||"")},{default:n(()=>[m(u(x(a.platform||"")),1)]),_:2},1032,["type"])]),o("h3",$e,u(a.title),1),o("div",Ae,[o("div",Ie,[t[4]||(t[4]=o("i",{class:"el-icon-question"},null,-1)),o("span",null,u(a.question_count||0)+"道题目",1)]),o("div",Le,[t[5]||(t[5]=o("i",{class:"el-icon-medal"},null,-1)),o("span",null,u(a.score_weight||100)+"分值",1)]),o("div",Ne,[t[6]||(t[6]=o("i",{class:"el-icon-refresh"},null,-1)),o("span",null,"尝试次数: "+u(C(a.id))+"/"+u(f),1)])]),o("div",De,[((F=g.value(a.id))==null?void 0:F.completion_status)==="completed"?(i(),p("div",Ee,[l(v,{type:"success"},{default:n(()=>t[7]||(t[7]=[m("已完成")])),_:1}),o("span",Ue,"最新分数: "+u(se(g.value(a.id))),1)])):((H=g.value(a.id))==null?void 0:H.completion_status)==="in_progress"?(i(),p("div",Me,[l(v,{type:"warning"},{default:n(()=>t[8]||(t[8]=[m("进行中")])),_:1})])):(i(),p("div",Ge,[l(v,{type:"info"},{default:n(()=>t[9]||(t[9]=[m("未开始")])),_:1})]))]),o("div",Pe,[l(I,{type:"primary",disabled:((j=g.value(a.id))==null?void 0:j.completion_status)==="in_progress"||C(a.id)>=f,onClick:V=>ee(a)},{default:n(()=>{var V;return[m(u(ae((V=g.value(a.id))==null?void 0:V.completion_status,a)),1)]}),_:2},1032,["disabled","onClick"]),((O=g.value(a.id))==null?void 0:O.completion_status)==="completed"?(i(),B(I,{key:0,type:"info",plain:"",onClick:V=>te(a)},{default:n(()=>t[10]||(t[10]=[m(" 查看历史 ")])),_:2},1032,["onClick"])):L("",!0)])])]}),_:2},1024))),128))])),_.total>0?(i(),p("div",Fe,[l(fe,{pagination:_,onUpdate:Y},null,8,["pagination"])])):L("",!0)])),[[ie,b.value]]),l(ne,{modelValue:S.value,"onUpdate:modelValue":t[2]||(t[2]=a=>S.value=a),title:((P=T.value)==null?void 0:P.title)+" - 测试历史记录",width:"800px"},{default:n(()=>[T.value?(i(),B(be,{key:0,testId:T.value.id},null,8,["testId"])):L("",!0)]),_:1},8,["modelValue","title"])])])])}}}),Ye=ye(He,[["__scopeId","data-v-bd625f1e"]]);export{Ye as default};
