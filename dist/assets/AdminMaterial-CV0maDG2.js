import{_ as _e,a as me,b as ge,c as ve,d as fe,e as be,f as ye,g as we,h as he,i as ke,j as xe,k as Ve,l as Ce}from"./zip-KiBfUjci.js";import{d as Me,J as O,r as c,o as ze,l as E,a,e as o,K as De,w as s,b as i,P as Se,s as b,M as k,g as Ue,a6 as $e,F as G,m as J,f as r,y as Fe,c as q,q as K,O as Ee,t as m,U as Q,j as y,_ as qe}from"./index-DCqMzgSt.js";import{U as Be}from"./UploadMaterials-CGams6tp.js";const Pe={class:"layout"},Ne={class:"materials-content"},je={class:"card-header"},Le={class:"header-actions"},Te={style:{"font-size":"14px",color:"#909399"}},Ae={class:"dialog-content"},Ie={class:"material-details"},Oe={class:"material-header"},Ge={class:"material-title"},Je={class:"material-actions"},Ke=Me({__name:"AdminMaterial",setup(Qe){const R=O([{name:"数据管理",path:"/system/data-management"},{name:"学习资料管理",path:"/system/admin-material"}]),x=c(!1),U=c([]),V=c(!1),u=c(null),w=c(""),C=c(""),M=c(""),z=c(""),g=c([]),D=c(!1),B=[{value:"image",label:"图片"},{value:"video",label:"视频"},{value:"ppt",label:"PPT"},{value:"pdf",label:"PDF"},{value:"link",label:"链接"},{value:"txt",label:"文本"},{value:"word",label:"Word"},{value:"excel",label:"Excel"},{value:"zip",label:"压缩包"}],P=[{value:"google",label:"Google"},{value:"facebook",label:"Facebook"},{value:"microsoft",label:"Microsoft"},{value:"meta",label:"Meta"},{value:"other",label:"Other"}],p=O({page:1,pageSize:10,total:0}),W=()=>{D.value=!0},H=t=>{D.value=t,t||f()},X=t=>{p.page=t.page,p.pageSize=t.pageSize,f()},f=async()=>{x.value=!0;try{let t=b.from("study_materials").select(`
                *,
                platform_info:ad_platforms(name),
                category_info:ad_categories(name),
                subcategory_info:ad_subcategories(name),
                topic_info:ad_topics(name)
            `,{count:"exact"});C.value&&(t=t.ilike("title",`%${C.value}%`)),M.value&&(t=t.eq("type",M.value)),z.value&&(t=t.eq("platform",z.value));const{data:e,error:n,count:_}=await t.order("created_at",{ascending:!1}).range((p.page-1)*p.pageSize,p.page*p.pageSize-1);if(n)throw n;U.value=e,p.total=_||0}catch(t){k.error("搜索学习资料失败"),console.error(t)}finally{x.value=!1}},Y=async t=>{u.value=t,V.value=!0;try{const{data:e,error:n}=await b.from("material_contents").select("*").eq("material_id",t.id).single();if(n)throw n;w.value=e.content}catch(e){console.error("获取资料内容失败:",e),w.value=""}},Z=t=>{w.value&&window.open(w.value,"_blank")},ee=async t=>{try{await Q.confirm(`确定要删除资料 "${t.title}" 吗？此操作不可恢复。`,"警告",{type:"warning"});const{error:e}=await b.from("material_contents").delete().eq("material_id",t.id);if(e)throw e;const{error:n}=await b.from("study_materials").delete().eq("id",t.id);if(n)throw n;k.success("删除成功"),f()}catch(e){e!=="cancel"&&(console.error("删除资料失败:",e),k.error("删除失败"))}},te=async()=>{if(g.value.length!==0)try{await Q.confirm(`确定要删除选中的 ${g.value.length} 个资料吗？此操作不可恢复。`,"警告",{type:"warning"});const t=g.value.map(_=>_.id),{error:e}=await b.from("material_contents").delete().in("material_id",t);if(e)throw e;const{error:n}=await b.from("study_materials").delete().in("id",t);if(n)throw n;k.success(`成功删除 ${g.value.length} 个资料`),g.value=[],f()}catch(t){t!=="cancel"&&(console.error("批量删除资料失败:",t),k.error("批量删除失败"))}},le=t=>{g.value=t},N=t=>new URL(Object.assign({"/src/assets/icons/excel.png":Ce,"/src/assets/icons/file.png":Ve,"/src/assets/icons/image.png":xe,"/src/assets/icons/link.png":ke,"/src/assets/icons/music.png":he,"/src/assets/icons/pdf.png":we,"/src/assets/icons/ppt.png":ye,"/src/assets/icons/reading.png":be,"/src/assets/icons/select.png":fe,"/src/assets/icons/txt.png":ve,"/src/assets/icons/video.png":ge,"/src/assets/icons/word.png":me,"/src/assets/icons/zip.png":_e})[`/src/assets/icons/${t||"file"}.png`],import.meta.url).href,ae=t=>{const e=B.find(n=>n.value===t);return(e==null?void 0:e.label)||t},oe=t=>{const e=P.find(n=>n.value===t);return(e==null?void 0:e.label)||t},$=t=>{var n,_,h,d;if(!t)return"";const e=[];return(n=t.platform_info)!=null&&n.name&&e.push(t.platform_info.name),(_=t.category_info)!=null&&_.name&&e.push(t.category_info.name),(h=t.subcategory_info)!=null&&h.name&&e.push(t.subcategory_info.name),(d=t.topic_info)!=null&&d.name&&e.push(t.topic_info.name),e.join(" > ")||"根目录"},se=t=>{const e=$(t);return e.length>30?e.substring(0,27)+"...":e};return ze(()=>{f()}),(t,e)=>{const n=i("el-input"),_=i("el-option"),h=i("el-select"),d=i("el-button"),ne=i("el-space"),j=i("el-card"),v=i("el-table-column"),L=i("el-image"),ie=i("el-tooltip"),re=i("el-button-group"),ue=i("el-table"),de=i("el-empty"),ce=i("el-dialog"),pe=Ee("loading");return y(),E("div",Pe,[a(De,{breadbcrum:R},null,8,["breadbcrum"]),e[22]||(e[22]=o("div",{class:"layout-title"},[o("h1",{class:"title"},"学习资料管理")],-1)),a(j,{shadow:"always",style:{"margin-bottom":"20px"}},{default:s(()=>[a(ne,{wrap:"",alignment:"start",size:30},{default:s(()=>[a(n,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),style:{width:"240px"},placeholder:"请输入资料标题","suffix-icon":Ue($e),size:"large",clearable:""},null,8,["modelValue","suffix-icon"]),a(h,{modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=l=>M.value=l),placeholder:"文件类型",clearable:"",style:{width:"180px"},size:"large"},{default:s(()=>[(y(),E(G,null,J(B,l=>a(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a(h,{modelValue:z.value,"onUpdate:modelValue":e[2]||(e[2]=l=>z.value=l),placeholder:"平台",clearable:"",style:{width:"180px"},size:"large"},{default:s(()=>[(y(),E(G,null,J(P,l=>a(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a(d,{type:"primary",size:"large",onClick:f},{default:s(()=>e[7]||(e[7]=[r("搜索")])),_:1}),a(d,{type:"primary",size:"large",onClick:W},{default:s(()=>e[8]||(e[8]=[r("资料上传")])),_:1})]),_:1})]),_:1}),o("div",Ne,[a(j,{style:{"min-height":"400px"}},{header:s(()=>[o("div",je,[e[10]||(e[10]=r(" 学习资料列表 ")),o("div",Le,[a(d,{type:"danger",disabled:!g.value.length,onClick:te},{default:s(()=>e[9]||(e[9]=[r(" 批量删除 ")])),_:1},8,["disabled"]),o("div",Te,"共计 "+m(p.total)+" 条数据",1)])])]),default:s(()=>[Fe((y(),q(ue,{data:U.value,onSelectionChange:le},{default:s(()=>[a(v,{type:"selection",width:"55"}),a(v,{label:"类型",width:"80"},{default:s(({row:l})=>[a(L,{style:{width:"30px",height:"30px"},src:N(l.type),fit:"contain"},null,8,["src"])]),_:1}),a(v,{prop:"title",label:"标题"}),a(v,{prop:"platform",label:"平台"}),a(v,{label:"所在位置"},{default:s(({row:l})=>[a(ie,{effect:"dark",content:$(l),placement:"top"},{default:s(()=>[o("span",null,m(se(l)),1)]),_:2},1032,["content"])]),_:1}),a(v,{prop:"created_at",label:"创建时间",width:"180"},{default:s(({row:l})=>[r(m(new Date(l.created_at).toLocaleString()),1)]),_:1}),a(v,{label:"操作",width:"180"},{default:s(({row:l})=>[a(re,null,{default:s(()=>[a(d,{type:"primary",onClick:S=>Y(l)},{default:s(()=>e[11]||(e[11]=[r("查看")])),_:2},1032,["onClick"]),a(d,{type:"danger",onClick:S=>ee(l)},{default:s(()=>e[12]||(e[12]=[r("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[pe,x.value]]),!x.value&&U.value.length===0?(y(),q(de,{key:0,description:"暂无学习资料"})):K("",!0)]),_:1}),a(Se,{pagination:p,"onUpdate:pagination":X},null,8,["pagination"]),a(ce,{title:"资料详情",modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=l=>V.value=l),width:"50%"},{footer:s(()=>[a(d,{onClick:e[4]||(e[4]=l=>V.value=!1)},{default:s(()=>e[21]||(e[21]=[r("关闭")])),_:1})]),default:s(()=>{var l,S,T,A,I;return[o("div",Ae,[o("div",Ie,[o("div",Oe,[a(L,{style:{width:"40px",height:"40px"},src:N((l=u.value)==null?void 0:l.type),fit:"contain"},null,8,["src"]),o("h2",Ge,m(((S=u.value)==null?void 0:S.title)||"无标题"),1)]),o("p",null,[e[13]||(e[13]=o("strong",null,"类型:",-1)),e[14]||(e[14]=r()),o("span",null,m(ae((T=u.value)==null?void 0:T.type)),1)]),o("p",null,[e[15]||(e[15]=o("strong",null,"平台:",-1)),e[16]||(e[16]=r()),o("span",null,m(oe((A=u.value)==null?void 0:A.platform)),1)]),o("p",null,[e[17]||(e[17]=o("strong",null,"位置:",-1)),e[18]||(e[18]=r()),o("span",null,m($(u.value)),1)]),o("p",null,[e[19]||(e[19]=o("strong",null,"创建时间:",-1)),e[20]||(e[20]=r()),o("span",null,m((I=u.value)!=null&&I.created_at?new Date(u.value.created_at).toLocaleString():""),1)]),o("div",Je,[w.value?(y(),q(d,{key:0,type:"primary",onClick:e[3]||(e[3]=F=>Z(u.value))},{default:s(()=>{var F;return[r(m(((F=u.value)==null?void 0:F.type)==="link"?"打开链接":"查看文件"),1)]}),_:1})):K("",!0)])])])]}),_:1},8,["modelValue"]),a(Be,{visible:D.value,"onUpdate:visible":[e[6]||(e[6]=l=>D.value=l),H]},null,8,["visible"])])])}}}),Xe=qe(Ke,[["__scopeId","data-v-7da9c7c6"]]);export{Xe as default};
