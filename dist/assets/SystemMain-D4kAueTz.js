import{e as P,f as L,h as q,E as G}from"./elementPlus-Be5V1zcU.js";import{u as F,b as E,s as K}from"./index-Dg6Dv2jL.js";import{x as B,r as k,j as T,c as j,az as J,G as c,H as n,P as e,ag as o,A as i,L as U,M as C,u as m,J as W,aA as O,z as s,y as $,O as z,a6 as N,K as V,aF as Q}from"./vendor-CcmhhHhJ.js";import"./supabase-fOlwtt9p.js";const X={class:"toolbar",style:{display:"flex","justify-content":"end","align-items":"center"}},Y={style:{display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","margin-right":"5px"}},Z=B({__name:"Header",setup(H){const f=O(),h=F(),_=k(h.user);console.log(_.value,"user");const g=J();k(""),T(()=>{_.value=h.getUser()});const d=()=>{h.logout(),f.push("/login")},A=j(()=>g.path.includes("/training-")||g.path.includes("/training-home"));return(b,p)=>{const I=o("el-col"),R=o("el-avatar"),D=o("el-icon"),a=o("el-link"),t=o("el-dropdown-item"),y=o("el-dropdown-menu"),r=o("el-dropdown"),u=o("el-row"),S=o("el-header");return s(),c(S,{style:{"font-size":"16px"}},{default:n(()=>[e(u,{justify:"space-between",gutter:16,style:{height:"100%","align-items":"center"}},{default:n(()=>[e(I,{span:3},{default:n(()=>p[0]||(p[0]=[i("h1",{style:{"font-size":"40px","font-weight":"700"}},"IWISH",-1)])),_:1}),e(I,{span:4},{default:n(()=>{var v,w;return[i("div",X,[e(R,{style:{"margin-right":"10px","min-width":"40px","font-size":"20px","font-weight":"700","align-items":"center","line-height":"40px","justify-content":"center",background:"#2f87ff"},src:(v=_.value)==null?void 0:v.avatar_url},{default:n(()=>{var x,l,M;return[U(C(((M=(l=(x=_.value)==null?void 0:x.full_name)==null?void 0:l.charAt(0))==null?void 0:M.toUpperCase())||"U"),1)]}),_:1},8,["src"]),i("span",Y,C((w=_.value)==null?void 0:w.full_name),1),e(r,null,{dropdown:n(()=>[e(y,null,{default:n(()=>[A.value?W("",!0):(s(),c(t,{key:0},{default:n(()=>[e(a,{href:"/system/personal-data"},{default:n(()=>p[1]||(p[1]=[U(" 个人中心")])),_:1})]),_:1})),e(t,{onClick:d},{default:n(()=>p[2]||(p[2]=[U("退出登录")])),_:1})]),_:1})]),default:n(()=>[e(D,{style:{"margin-right":"10px","margin-top":"1px","font-size":"18px",color:"#fff"}},{default:n(()=>[e(m(P))]),_:1})]),_:1})])]}),_:1})]),_:1})]),_:1})}}}),ee=E(Z,[["__scopeId","data-v-9f2c58f7"]]),ne=B({__name:"Aside",setup(H){O();const f=J(),h=k(""),_=k([]),g=k(!1),d=F(),A=j(()=>d.getMenus),b=a=>{h.value=a,a==="/system/demand"&&R()},p=k("");T(async()=>{g.value=!0,await d.fetchMenus();const{data:{session:a}}=await K.auth.getSession();p.value=(a==null?void 0:a.access_token)||"",g.value=!1});function I(a){const t=typeof a=="string"?a:JSON.stringify(a);return btoa(unescape(encodeURIComponent(t))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const R=()=>{var a,t,y,r,u,S,v,w;try{const x={id:((a=d.user)==null?void 0:a.user_id)||"",email:((t=d.user)==null?void 0:t.email)||"",name:((y=d.user)==null?void 0:y.full_name)||((u=(r=d.user)==null?void 0:r.email)==null?void 0:u.split("@")[0])||"用户",role:D((S=d.user)==null?void 0:S.role_id),rolename:(w=(v=d.user)==null?void 0:v.role)==null?void 0:w.name,origin:window.location.origin,exp:Math.floor(Date.now()/1e3)+900},l=I(x);window.open(`https://iwishneed.netlify.app/auth/bridge#external_user=${l}&main_access_token=${p.value}`,"_blank")}catch(x){console.error("处理demand跳转失败:",x),G.error("跳转失败，请稍后重试")}},D=a=>{if(!a)return"submitter";switch(a){case 0:case 1:return"admin";case 2:case 3:return"manager";case 4:case 5:return"developer";default:return"submitter"}};return(a,t)=>{const y=o("ArrowLeft"),r=o("el-icon"),u=o("el-menu-item"),S=o("InfoFilled"),v=o("DataAnalysis"),w=o("el-sub-menu"),x=o("el-menu");return s(),c(x,{class:"el-menu-vertical-demo","active-text-color":"#fff","background-color":"#05479a","text-color":"#fff",style:{position:"fixed","z-index":"999",height:"calc(100vh - 84px)",left:"0",width:"240px","overflow-y":"auto","overflow-x":"hidden"},router:!0,"unique-opened":!0,"default-active":h.value,"default-openeds":_.value,onSelect:b,loading:g.value},{default:n(()=>[m(f).name==="letter-to-employee"||m(f).name==="company-introduction"||m(f).name==="apply-for-registration"?(s(),$(z,{key:0},[e(u,{index:"/training-home"},{default:n(()=>[e(r,null,{default:n(()=>[e(y)]),_:1}),t[0]||(t[0]=i("span",null,"返回",-1))]),_:1}),e(u,{index:"/system/training-letter"},{default:n(()=>[e(r,null,{default:n(()=>[e(m(L))]),_:1}),t[1]||(t[1]=i("span",null,"致员工的一封信",-1))]),_:1}),e(u,{index:"/system/training-company"},{default:n(()=>[e(r,null,{default:n(()=>[e(m(q))]),_:1}),t[2]||(t[2]=i("span",null,"了解艾维",-1))]),_:1}),e(u,{index:"/system/training-apply"},{default:n(()=>[e(r,null,{default:n(()=>[e(S)]),_:1}),t[3]||(t[3]=i("span",null,"申请注册",-1))]),_:1})],64)):m(f).name==="digital-marketing"||m(f).name==="website-layout"?(s(),$(z,{key:1},[e(u,{index:"/training-home"},{default:n(()=>[e(r,null,{default:n(()=>[e(y)]),_:1}),t[4]||(t[4]=i("span",null,"返回",-1))]),_:1}),e(u,{index:"/system/training-marketing"},{default:n(()=>[e(r,null,{default:n(()=>[e(m(L))]),_:1}),t[5]||(t[5]=i("span",null,"了解数字营销与品牌独立站",-1))]),_:1}),e(u,{index:"/system/training-website"},{default:n(()=>[e(r,null,{default:n(()=>[e(v)]),_:1}),t[6]||(t[6]=i("span",null,"独立站的布局及优化诊断",-1))]),_:1})],64)):(s(!0),$(z,{key:2},N(A.value,l=>(s(),$(z,{key:l.id},[l.children&&l.children.length>0?(s(),c(w,{key:0,index:`/system${l.path}`},{title:n(()=>[e(r,null,{default:n(()=>[(s(),c(V(l.icon)))]),_:2},1024),i("span",null,C(l.name),1)]),default:n(()=>[(s(!0),$(z,null,N(l.children,M=>(s(),c(u,{key:M.id,index:`/system${M.path}`},{default:n(()=>[U(C(M.name),1)]),_:2},1032,["index"]))),128))]),_:2},1032,["index"])):l.path==="/demand"?(s(),c(u,{key:1,onClick:R},{default:n(()=>[e(r,null,{default:n(()=>[(s(),c(V(l.icon)))]),_:2},1024),i("span",null,C(l.name),1)]),_:2},1024)):(s(),c(u,{key:2,index:`/system${l.path}`},{default:n(()=>[e(r,null,{default:n(()=>[(s(),c(V(l.icon)))]),_:2},1024),i("span",null,C(l.name),1)]),_:2},1032,["index"]))],64))),128))]),_:1},8,["default-active","default-openeds","loading"])}}}),te={class:"common-layout"},oe={class:"page-container"},ae={class:"loading-container"},le=B({__name:"SystemMain",setup(H){return k([]),(f,h)=>{const _=o("el-aside"),g=o("RouterView"),d=o("el-skeleton"),A=o("el-main"),b=o("el-container");return s(),$("div",te,[e(b,{direction:"vertical",style:{height:"100vh"}},{default:n(()=>[e(ee),e(b,{style:{"margin-top":"84px"}},{default:n(()=>[e(_,{width:"240px"},{default:n(()=>[e(ne)]),_:1}),e(b,null,{default:n(()=>[e(A,null,{default:n(()=>[i("div",oe,[(s(),c(Q,null,{default:n(()=>[e(g)]),fallback:n(()=>[i("div",ae,[e(d,{rows:3,animated:""})])]),_:1}))])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),de=E(le,[["__scopeId","data-v-f490535e"]]);export{de as default};
