import{J as Jl,_ as Fl,a as zl,b as Tl,c as ql,d as Yl,e as Ll,f as Sl,g as Gl,h as jl,i as Nl,j as Hl,k as Kl,l as Ol,m as Wl}from"./index-CRGctEdD.js";import{x as nl,c as W,r as p,X as Ce,w as Ue,y as D,P as t,ag as h,H as o,G as Y,J as S,O as ye,a6 as Ae,A as f,M as P,L as y,z as _,j as Xl,W as Rl,u as ke,I as tl,aq as Zl,a4 as ea,D as la}from"./vendor-kUynFKsh.js";import{E as k,s as ol,m as aa,w as ta,c as De}from"./elementPlus-7n3J9xVR.js";import{s as d,b as sl,B as oa,e as ra}from"./index-BKDCXq68.js";/* empty css                  */import"./index-BBl8hZ3Q.js";import{d as rl,H as Pe}from"./index-Cg_8VX7H.js";import"./supabase-Dk90AXsH.js";const na={class:"upload"},sa={key:0},ia=nl({__name:"UploadMaterials",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup($e,{emit:xe}){const se=$e,oe=W({get:()=>se.visible,set:w=>ie("update:visible",w)}),ie=xe,ue=p([{value:"image",label:"图片"},{value:"video",label:"视频"},{value:"ppt",label:"PPT"},{value:"pdf",label:"PDF"},{value:"link",label:"链接"},{value:"txt",label:"文本"},{value:"word",label:"Word"},{value:"excel",label:"Excel"},{value:"zip",label:"压缩包"},{value:"md",label:"Markdown"}]),U=p([{value:"google",label:"Google"},{value:"facebook",label:"Facebook"},{value:"microsoft",label:"Microsoft"},{value:"meta",label:"Meta"},{value:"other",label:"Other"}]),B=p([]),de=async()=>{try{const{data:w,error:v}=await d.from("ad_platforms").select("*");if(v)throw v;B.value=await Promise.all(w.map(async C=>{const{data:M,error:$}=await d.from("ad_categories").select("*").eq("platform_id",C.id);if($)throw $;const A=await Promise.all(M.map(async I=>{const{data:m,error:i}=await d.from("ad_subcategories").select("*").eq("category_id",I.id);if(i)throw i;const F=await Promise.all(m.map(async T=>{const{data:b,error:G}=await d.from("ad_topics").select("*").eq("subcategory_id",T.id);if(G)throw G;return{...T,children:b}}));return{...I,children:F}}));return{id:C.id,name:C.name,children:A}}))}catch(w){k.error("加载文件夹结构失败："+w.message)}finally{}},g=Ce({title:"",type:"",platform:"",chapter:"",folderPath:[],linkUrl:""});Ue(()=>g.platform,w=>{de()});const re=()=>{g.title="",g.type="",g.platform="",g.chapter="",g.folderPath=[],g.linkUrl="",H.value=[],K.value=null},H=p([]),K=p(null),le=p(!1),ve=w=>{var F,T;const v=["image/png","image/jpeg","image/webp","video/mp4","application/pdf","application/vnd.ms-powerpoint","text/plain","text/csv","text/html","text/xml","application/json","application/xml","application/octet-stream","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/markdown","text/x-markdown","application/x-markdown"],C=[".png",".jpg",".jpeg",".webp",".mp4",".pdf",".ppt",".pptx",".txt",".csv",".html",".xml",".json",".md",".doc",".docx",".xls",".xlsx",".zip",".rar",".7z"],M=w.raw&&v.includes(w.raw.type),$=w.name||"",A=$.toLowerCase().substring($.lastIndexOf(".")),I=C.includes(A),m=M||I,i=w.raw&&w.raw.size/1024/1024<100;if(!m)return k.error(`文件类型不支持！支持的格式：${C.join(", ")}`),!1;if(!i)return k.error("文件大小超过 100MB 限制！"),!1;K.value=w.raw,console.log("文件信息:",{name:w.name,type:(F=w.raw)==null?void 0:F.type,extension:A,size:(T=w.raw)==null?void 0:T.size})},ce=async()=>{var w;if(g.type==="link"&&!g.linkUrl){k.warning("请输入链接地址");return}if(g.type!=="link"&&!K.value){k.warning("请选择文件");return}le.value=!0;try{await L(g.type==="link"?null:K.value,{title:g.title,platform:g.platform,type:g.type},g.type==="link"?g.title:((w=K.value)==null?void 0:w.name)||"")&&(k.success("上传成功！"),re())}catch(v){k.error(`上传失败: ${v.message}`)}finally{le.value=!1}},L=async(w,v,C)=>{try{let M="";if(v.type==="link")M=g.linkUrl;else{if(!w)throw new Error("未选择文件");const i=w.name.split(".").pop(),F=`${Date.now()}-${Math.random().toString(36).slice(2)}.${i}`,{data:T,error:b}=await d.storage.from("materials").upload(`documents/${F}`,w);if(b)throw b;const{data:G}=d.storage.from("materials").getPublicUrl(T.path);M=G.publicUrl}const $=["platform_id","category_id","subcategory_id","topic_id"],{data:A,error:I}=await d.from("study_materials").insert({...v,[$[g.folderPath.length-1]]:g.folderPath[g.folderPath.length-1]}).select("id").single();if(I)throw I;const{error:m}=await d.from("material_contents").insert({material_id:A.id,title:v.title,content:M,content_type:v.type});if(m)throw m;return console.log("文件上传并关联成功！"),M}catch(M){return console.error("操作失败:",M.message),null}};return(w,v)=>{const C=h("el-input"),M=h("el-form-item"),$=h("el-option"),A=h("el-select"),I=h("el-empty"),m=h("el-cascader"),i=h("upload-filled"),F=h("el-icon"),T=h("el-upload"),b=h("el-button"),G=h("el-form"),X=h("el-dialog");return _(),D("div",na,[t(X,{onClose:v[5]||(v[5]=V=>ie("update:visible",!1)),modelValue:oe.value,"onUpdate:modelValue":v[6]||(v[6]=V=>oe.value=V),title:"资料上传",width:"50%"},{default:o(()=>[t(G,{model:g,"label-width":"auto",style:{"max-width":"600px",margin:"50px 30px"}},{default:o(()=>[t(M,{label:"文件标题"},{default:o(()=>[t(C,{size:"large",modelValue:g.title,"onUpdate:modelValue":v[0]||(v[0]=V=>g.title=V),placeholder:"输入文件标题"},null,8,["modelValue"])]),_:1}),t(M,{label:"文件类型"},{default:o(()=>[t(A,{size:"large",modelValue:g.type,"onUpdate:modelValue":v[1]||(v[1]=V=>g.type=V),placeholder:"选择文件类型"},{default:o(()=>[(_(!0),D(ye,null,Ae(ue.value,(V,j)=>(_(),Y($,{label:V.label,value:V.value,key:j},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(M,{label:"文件所属平台"},{default:o(()=>[t(A,{size:"large",modelValue:g.platform,"onUpdate:modelValue":v[2]||(v[2]=V=>g.platform=V),placeholder:"选择平台"},{default:o(()=>[(_(!0),D(ye,null,Ae(U.value,(V,j)=>(_(),Y($,{label:V.label,value:V.value,key:j},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(M,{label:"选择文件夹"},{default:o(()=>[t(m,{size:"large",modelValue:g.folderPath,"onUpdate:modelValue":v[3]||(v[3]=V=>g.folderPath=V),options:B.value,props:{checkStrictly:!0,emitPath:!0,value:"id",label:"name",children:"children"},clearable:"",placeholder:"请选择资料存放位置",style:{width:"100%"}},{default:o(({node:V,data:j})=>[f("span",null,P(j.name),1),V.isLeaf?S("",!0):(_(),D("span",sa," ("+P(j.children.length)+") ",1))]),empty:o(()=>[t(I,{description:"暂无数据，先选择平台"})]),_:1},8,["modelValue","options"])]),_:1}),g.type==="link"?(_(),Y(M,{key:0,label:"链接地址"},{default:o(()=>[t(C,{size:"large",modelValue:g.linkUrl,"onUpdate:modelValue":v[4]||(v[4]=V=>g.linkUrl=V),placeholder:"请输入链接地址"},null,8,["modelValue"])]),_:1})):S("",!0),g.type!=="link"?(_(),Y(M,{key:1,label:"文件上传"},{default:o(()=>[t(T,{class:"upload-box","auto-upload":!1,"on-change":ve,"file-list":H.value,limit:1,drag:"",action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15",multiple:""},{tip:o(()=>v[7]||(v[7]=[f("div",{class:"el-upload__tip"},"支持所有文本型、图片、视频等文件，且不超过 100MB",-1)])),default:o(()=>[t(F,{class:"el-icon--upload"},{default:o(()=>[t(i)]),_:1}),v[8]||(v[8]=f("div",{class:"el-upload__text"},[y(" 拖拽文件或"),f("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})):S("",!0),t(M,null,{default:o(()=>[t(b,{type:"primary",loading:le.value,onClick:ce},{default:o(()=>v[9]||(v[9]=[y("开始上传")])),_:1},8,["loading"]),t(b,{onClick:re},{default:o(()=>v[10]||(v[10]=[y("清空内容")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),ua=sl(ia,[["__scopeId","data-v-9d4f2542"]]),da={class:"layout"},ca={class:"materials-content"},fa={class:"card-header"},pa={class:"header-actions"},va={style:{"font-size":"14px",color:"#909399"}},ma={class:"dialog-content"},ga={class:"material-details"},_a={class:"material-header"},ya={class:"material-title"},Aa={class:"material-actions"},ha={class:"material-preview"},wa=["src"],ba=["src"],ka=["src"],Ca=["src"],xa={key:4,class:"link-preview"},Ea={key:5,class:"video-preview"},Ma=["src"],Va={key:6,class:"text-preview"},Ba=["innerHTML"],Ia={key:7,class:"markdown-preview"},Qa={class:"markdown-toolbar"},Da={key:0,class:"markdown-editor"},Pa={key:1,class:"markdown-preview-content"},Ua=["innerHTML"],$a={key:8,class:"material-download"},Ja={class:"fullscreen-preview"},Fa=["src"],za=["src"],Ta=["src"],qa={key:0},Ya=nl({__name:"AdminMaterialAndFolders",setup($e){const xe=Ce([{name:"数据管理",path:""},{name:"学习资料管理",path:"/system/admin-material"}]),se=p("materials"),oe=p(!1),ie=p([]),ue=p(!1),U=p(null),B=p(""),de=p(""),g=p(""),re=p(""),H=p([]),K=p(!1),le=p(!1),ve=p(!1),ce=p(""),L=p("preview"),w=p(""),v=p(!1),C=p(!1),M=p(""),$=p(""),A=p(null),I=p(null),m=p(null),i=p([]),F=p([]),T=p(!1),b=p(null),G=p([]),X=p(new Map),V=p(new Map),j=p(new Map),me=p(new Map),he=W(()=>{var e;return((e=U.value)==null?void 0:e.type)==="image"}),we=W(()=>{var e;return((e=U.value)==null?void 0:e.type)==="pdf"}),Ee=W(()=>{var e;return((e=U.value)==null?void 0:e.type)==="word"}),Je=W(()=>{var e;return((e=U.value)==null?void 0:e.type)==="link"}),Fe=W(()=>{var e;return((e=U.value)==null?void 0:e.type)==="video"}),ze=W(()=>{var e;return((e=U.value)==null?void 0:e.type)==="txt"}),Te=W(()=>{var e;return((e=U.value)==null?void 0:e.type)==="md"}),ge=W(()=>{var e;return((e=U.value)==null?void 0:e.type)==="excel"});rl.setOptions({highlight:function(e,l){if(l&&Pe.getLanguage(l))try{return Pe.highlight(e,{language:l}).value}catch(a){console.error("代码高亮错误:",a)}return Pe.highlightAuto(e).value},breaks:!0,gfm:!0});const il=W(()=>w.value?rl(w.value):""),ul=()=>he.value?"预览图片":we.value?"预览PDF":Ee.value?"预览Word":ge.value?"预览Excel":Je.value?"打开链接":Fe.value?"预览视频":ze.value?"预览文本":Te.value?"预览Markdown":"查看文件",J=Ce({name:"",platform:"",folderPath:[]}),qe=[{value:"image",label:"图片"},{value:"video",label:"视频"},{value:"ppt",label:"PPT"},{value:"pdf",label:"PDF"},{value:"link",label:"链接"},{value:"txt",label:"文本"},{value:"word",label:"Word"},{value:"excel",label:"Excel"},{value:"zip",label:"压缩包"},{value:"md",label:"Markdown"}],Ye=[{value:"google",label:"Google"},{value:"facebook",label:"Facebook"},{value:"microsoft",label:"Microsoft"},{value:"meta",label:"Meta"},{value:"other",label:"Other"}],R=Ce({page:1,pageSize:10,total:0}),Le=p(null);let z=null;const dl=()=>{K.value=!0},cl=e=>{K.value=e,e||fe()},fl=e=>{R.page=e.page,R.pageSize=e.pageSize,fe()},fe=async()=>{oe.value=!0;try{let e=d.from("study_materials").select(`
                *,
                platform_info:ad_platforms(name),
                category_info:ad_categories(name),
                subcategory_info:ad_subcategories(name),
                topic_info:ad_topics(name)
            `,{count:"exact"});de.value&&(e=e.ilike("title",`%${de.value}%`)),g.value&&(e=e.eq("type",g.value)),re.value&&(e=e.eq("platform",re.value));const{data:l,error:a,count:n}=await e.order("created_at",{ascending:!1}).range((R.page-1)*R.pageSize,R.page*R.pageSize-1);if(a)throw a;ie.value=l,R.total=n||0}catch(e){k.error("搜索学习资料失败"),console.error(e)}finally{oe.value=!1}},Se=async e=>{U.value=e,ue.value=!0,z&&(z.destruct(),z=null),e.type!=="link"&&e.type!=="video"&&e.type!=="pdf"&&Le.value&&(z=Jl.make(Le.value,{height:500,readonly:!0,toolbar:!1,statusbar:!1,language:"zh_cn",disablePlugins:["cdn"],uploader:{insertImageAsBase64URI:!0}}),z.value='<div style="text-align: center; padding: 50px;">文件加载中，请稍候...</div>');try{const{data:l,error:a}=await d.from("material_contents").select("*").eq("material_id",e.id).single();if(a)throw a;if(console.log("Material content data:",l),e.type==="link"||e.type==="video"||e.type==="pdf"||e.type==="ppt"||e.type==="word"||e.type==="excel")B.value=l.content;else{const n=l.content;console.log("Attempting to fetch file from path:",n);const u=l.content.split("/materials/").pop();try{if(e.type==="txt"){const{data:s,error:c}=await d.storage.from("materials").download(u);if(c)throw c;const Q=await s.text();B.value=Q,z&&(z.value=B.value)}else if(e.type==="md"){const{data:s,error:c}=await d.storage.from("materials").download(u);if(c)throw c;const Q=await s.text();B.value=Q,w.value=Q,L.value="preview"}else if(e.type==="image"){const{data:{publicUrl:s}}=await d.storage.from("materials").getPublicUrl(u);B.value=s,z&&(z.value=`<img src="${s}" alt="${e.title}" style="max-width: 100%;">`)}else{const{data:{publicUrl:s}}=await d.storage.from("materials").getPublicUrl(u);B.value=s,z&&(z.value=`
                            <div style="text-align: center; padding: 20px;">
                                <p>此文件类型不支持直接预览</p>
                                <a href="${s}" target="_blank" class="el-button el-button--primary">
                                    下载文件
                                </a>
                            </div>
                        `)}}catch(s){throw console.error("Storage error:",s),k.error(`无法获取文件: ${s.message}`),s;z&&(z.value=`
                        <div style="color: red; text-align: center; padding: 20px;">
                            <p>文件加载失败: ${s.message||"未知错误"}</p>
                        </div>
                    `)}}}catch(l){console.error("获取资料内容失败:",l),B.value="",k.error("获取文件内容失败"),z&&(z.value=`
                <div style="color: red; text-align: center; padding: 20px;">
                    <p>无法获取文件信息</p>
                </div>
            `)}},pl=()=>{B.value&&((Ee.value||ge.value)&&(ce.value=`https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(B.value)}`),le.value=!0)},Ge=()=>{ve.value=!0},vl=()=>{B.value&&window.open(B.value,"_blank")},ml=()=>{B.value&&window.open(B.value,"_blank")},gl=async()=>{if(!U.value||!w.value){k.warning("没有可保存的内容");return}v.value=!0;try{const e=new File([w.value],U.value.title+".md",{type:"text/markdown"}),l=e.name.split(".").pop(),a=`${Date.now()}-${Math.random().toString(36).slice(2)}.${l}`,{data:n,error:u}=await d.storage.from("materials").upload(`documents/${a}`,e,{upsert:!0});if(u)throw u;const{data:s}=d.storage.from("materials").getPublicUrl(n.path),{error:c}=await d.from("material_contents").update({content:s.publicUrl}).eq("material_id",U.value.id);if(c)throw c;B.value=s.publicUrl,k.success("Markdown文件保存成功！")}catch(e){console.error("保存Markdown失败:",e),k.error(`保存失败: ${e.message}`)}finally{v.value=!1}},je=async e=>{try{await De.confirm(`确定要删除资料 "${e.title}" 吗？此操作不可恢复。`,"警告",{type:"warning"});const{error:l}=await d.from("material_contents").delete().eq("material_id",e.id);if(l)throw l;const{error:a}=await d.from("study_materials").delete().eq("id",e.id);if(a)throw a;k.success("删除成功"),fe()}catch(l){l!=="cancel"&&(console.error("删除资料失败:",l),k.error("删除失败"))}},_l=async()=>{if(H.value.length!==0)try{await De.confirm(`确定要删除选中的 ${H.value.length} 个资料吗？此操作不可恢复。`,"警告",{type:"warning"});const e=H.value.map(n=>n.id),{error:l}=await d.from("material_contents").delete().in("material_id",e);if(l)throw l;const{error:a}=await d.from("study_materials").delete().in("id",e);if(a)throw a;k.success(`成功删除 ${H.value.length} 个资料`),H.value=[],fe()}catch(e){e!=="cancel"&&(console.error("批量删除资料失败:",e),k.error("批量删除失败"))}},yl=e=>{H.value=e},Al=()=>new URL("data:image/png;base64,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",import.meta.url).href,Me=e=>new URL(Object.assign({"/src/assets/icons/excel.png":Wl,"/src/assets/icons/file.png":Ol,"/src/assets/icons/image.png":Kl,"/src/assets/icons/link.png":Hl,"/src/assets/icons/md.png":Nl,"/src/assets/icons/music.png":jl,"/src/assets/icons/pdf.png":Gl,"/src/assets/icons/ppt.png":Sl,"/src/assets/icons/reading.png":Ll,"/src/assets/icons/select.png":Yl,"/src/assets/icons/txt.png":ql,"/src/assets/icons/video.png":Tl,"/src/assets/icons/word.png":zl,"/src/assets/icons/zip.png":Fl})[`/src/assets/icons/${e||"file"}.png`],import.meta.url).href,hl=e=>e?new Date(e).toLocaleString():"",Ve=async()=>{C.value=!0;try{i.value=[],m.value=null,A.value=null,I.value=null;const e="root",l=X.value.get(e);if(l){F.value=l;return}const{data:a,error:n}=await d.from("ad_platforms").select("*").order("name");if(n)throw n;const u=a.map(s=>({...s,is_folder:!0}));F.value=u,X.value.set(e,u)}catch(e){console.error("加载平台列表失败:",e),k.error("加载平台列表失败")}finally{C.value=!1}},wl=async()=>{C.value=!0;try{if(i.value=[],m.value=null,M.value){const{data:e,error:l}=await d.from("ad_platforms").select("*").eq("platform",M.value).single();if(l)throw l;A.value=e.id,I.value=e.name}else A.value=null,I.value=null;await Z()}catch(e){k.error("加载文件夹结构失败"),console.error(e)}finally{C.value=!1}},Z=async()=>{C.value=!0;try{let e,l;const n=A.value?i.value.length===1?`platform_${A.value}`:i.value.length===2?`category_${m.value}`:i.value.length===3?`subcategory_${m.value}`:`topic_${m.value}`:"root",u=X.value.get(n),s=V.value.get(n);if(!A.value){if(u){F.value=u,C.value=!1;return}const{data:O,error:ee}=await d.from("ad_platforms").select("*").order("name");if(ee)throw ee;const ne=O.map(x=>({...x,is_folder:!0}));F.value=ne,X.value.set(n,ne),C.value=!1;return}if(u&&s){F.value=[...u,...s],C.value=!1;return}i.value.length===1?(e=d.from("ad_categories").select("*").eq("platform_id",A.value).order("sort_order, name"),l=d.from("study_materials").select("*").eq("platform_id",A.value).is("category_id",null).order("title")):i.value.length===2?(e=d.from("ad_subcategories").select("*").eq("category_id",m.value).order("sort_order, name"),l=d.from("study_materials").select("*").eq("category_id",m.value).is("subcategory_id",null).order("title")):i.value.length===3?(e=d.from("ad_topics").select("*").eq("subcategory_id",m.value).order("sort_order, name"),l=d.from("study_materials").select("*").eq("subcategory_id",m.value).is("topic_id",null).order("title")):(e=null,l=d.from("study_materials").select("*").eq("topic_id",m.value).order("title"));const[c,Q]=await Promise.all([e||Promise.resolve({data:[],error:null}),l]);if(c!=null&&c.error)throw c.error;if(Q.error)throw Q.error;const E=((c==null?void 0:c.data)||[]).map(O=>({...O,is_folder:!0})),N=(Q.data||[]).map(O=>({...O,is_folder:!1}));X.value.set(n,E),V.value.set(n,N),F.value=[...E,...N]}catch(e){console.error("加载失败:",e),k.error("加载失败")}finally{C.value=!1}},Ne=async e=>{var l;if(e.is_folder){if($.value.trim()&&e.folder_level){if($.value="",i.value=[],e.folder_level==="platform")A.value=e.id,I.value=e.name,i.value.push(e),m.value=e.id;else if(e.folder_level==="category"){if(e.platform_id)try{const{data:a,error:n}=await d.from("ad_platforms").select("*").eq("id",e.platform_id).single();if(n)throw n;A.value=a.id,I.value=a.name,i.value.push(a),i.value.push(e),m.value=e.id}catch(a){console.error("获取平台信息失败:",a),A.value=null,I.value=null}}else if(e.folder_level==="subcategory"){if(e.category_id)try{const{data:a,error:n}=await d.from("ad_categories").select("*, platform:ad_platforms(*)").eq("id",e.category_id).single();if(n)throw n;a.platform&&(A.value=a.platform.id,I.value=a.platform.name,i.value.push(a.platform)),i.value.push(a),i.value.push(e),m.value=e.id}catch(a){console.error("获取分类信息失败:",a),A.value=null,I.value=null}}else if(e.folder_level==="topic"&&e.subcategory_id)try{const{data:a,error:n}=await d.from("ad_subcategories").select("*, category:ad_categories(*, platform:ad_platforms(*))").eq("id",e.subcategory_id).single();if(n)throw n;(l=a.category)!=null&&l.platform&&(A.value=a.category.platform.id,I.value=a.category.platform.name,i.value.push(a.category.platform)),a.category&&i.value.push(a.category),i.value.push(a),i.value.push(e),m.value=e.id}catch(a){console.error("获取子分类信息失败:",a),A.value=null,I.value=null}await Z();return}i.value.length===0?(A.value=e.id,I.value=e.name,i.value.push(e),m.value=e.id):(i.value.length===1||i.value.length,i.value.push(e),m.value=e.id),await Z()}else e.type&&Se(e)},bl=async()=>{i.value.length>0&&(i.value.pop(),i.value.length===0?(m.value=null,A.value=null,I.value=null):m.value=i.value[i.value.length-1].id,await Z())},kl=async()=>{i.value=[],m.value=null,A.value=null,I.value=null,await Z()},Cl=async e=>{const l=i.value.findIndex(a=>a.id===e.id);l>=0&&(i.value=i.value.slice(0,l+1),m.value=e.id,await Z())},xl=async e=>{try{if(!await El(e)){k.warning(`无法删除，${e.is_folder?"文件夹可能包含子项":"无权删除此文件"}`);return}if(await De.confirm(`确定要删除${e.is_folder?"文件夹":"文件"} "${e.is_folder?e.name:e.title}" 吗？此操作不可恢复。`,"警告",{type:"warning"}),e.is_folder){C.value=!0;let a="",n="id",u=e.id;console.log("准备删除文件夹:",e);try{if(e.folder_level==="platform"||i.value.length===0&&!e.folder_level)a="ad_categories",n="id",console.log("删除类型: 分类, ID:",u);else if(e.folder_level==="category"||i.value.length===1&&!e.folder_level)a="ad_subcategories",n="id",console.log("删除类型: 子分类, ID:",u);else if(e.folder_level==="subcategory"||i.value.length===2&&!e.folder_level)a="ad_topics",n="id",console.log("删除类型: 主题, ID:",u);else throw new Error("未知的文件夹类型");console.log(`开始删除 ${a} 表中 ${n}=${u} 的记录`);const{data:s,error:c}=await d.from(a).select("id").eq(n,u).limit(1);if(c)throw console.error("检查记录是否存在失败:",c),c;if(!s||s.length===0){console.warn("要删除的记录不存在"),k.warning("要删除的记录不存在"),C.value=!1;return}const{error:Q}=await d.from(a).delete().eq(n,u);if(Q)throw console.error(`删除 ${a} 失败:`,Q),Q;const{data:E,error:N}=await d.from(a).select("id").eq(n,u).limit(1);if(N&&console.warn("验证删除结果时出错:",N),E&&E.length>0){console.error("删除操作执行了但记录仍然存在"),k.error("删除未成功，请刷新页面后重试"),C.value=!1;return}ae(),await Z(),k.success("删除成功")}catch(s){console.error("删除过程中出错:",s),k.error(`删除失败: ${s.message||"未知错误"}`)}finally{C.value=!1}}else await je(e),We()}catch(l){l!=="cancel"&&(console.error("删除操作失败:",l),k.error("删除失败，请检查是否有关联的资料"))}},El=async e=>{if(!e.is_folder)return!0;const l=`delete_${e.id}`;if(j.value.has(l))return j.value.get(l);try{let a=!1;if(console.log("检查文件夹是否可删除:",e.id,e.name,"当前路径层级:",i.value.length),e.folder_level==="platform"||i.value.length===0&&!e.folder_level){const{count:n,error:u}=await d.from("ad_categories").select("*",{count:"exact"}).eq("platform_id",e.id);if(u)throw u;console.log("平台下分类数量:",n);const{count:s,error:c}=await d.from("study_materials").select("*",{count:"exact"}).eq("platform_id",e.id).is("category_id",null);if(c)throw c;console.log("平台直接关联的资料数量:",s),a=n===0&&s===0}else if(e.folder_level==="category"||i.value.length===1&&!e.folder_level){const{count:n,error:u}=await d.from("ad_subcategories").select("*",{count:"exact"}).eq("category_id",e.id);if(u)throw u;console.log("分类下子分类数量:",n);const{count:s,error:c}=await d.from("study_materials").select("*",{count:"exact"}).eq("category_id",e.id).is("subcategory_id",null);if(c)throw c;console.log("分类下直接关联的资料数量:",s),a=n===0&&s===0}else if(e.folder_level==="subcategory"||i.value.length===2&&!e.folder_level){const{count:n,error:u}=await d.from("ad_topics").select("*",{count:"exact"}).eq("subcategory_id",e.id);if(u)throw u;console.log("子分类下主题数量:",n);const{count:s,error:c}=await d.from("study_materials").select("*",{count:"exact"}).eq("subcategory_id",e.id).is("topic_id",null);if(c)throw c;console.log("子分类下直接关联的资料数量:",s),a=n===0&&s===0}else if(e.folder_level==="topic"||i.value.length===3&&!e.folder_level){const{count:n,error:u}=await d.from("study_materials").select("*",{count:"exact"}).eq("topic_id",e.id);if(u)throw u;console.log("主题下资料数量:",n),a=n===0}return console.log("文件夹是否可删除结果:",a),j.value.set(l,a),a}catch(a){return console.error("检查删除权限失败:",a),!1}},He=(e=null)=>{var l;b.value=e,J.name="",J.platform=M.value,J.folderPath=[],console.log("showCreateFolderDialog 参数:",e?"有folder":"无folder"),console.log("parentFolder.value:",b.value),e?(console.log("在特定文件夹下创建子文件夹:",e),G.value=[],e.folder_level==="platform"||!e.folder_level&&i.value.length===0?J.folderPath=[e.id]:e.folder_level==="category"||!e.folder_level&&i.value.length===1?J.folderPath=[e.id]:(e.folder_level==="subcategory"||!e.folder_level&&i.value.length===2)&&(J.folderPath=[(l=i.value[1])==null?void 0:l.id,e.id])):(console.log("从顶部按钮创建，加载文件夹路径选择器"),Bl()),setTimeout(()=>{T.value=!0},100)},Ml=async()=>{if(!J.name){k.warning("请输入文件夹名称");return}if(!b.value&&J.folderPath.length===0){k.warning("请选择文件夹位置");return}C.value=!0;try{let e,l=J.folderPath;if(b.value){if(console.log("使用预设路径创建文件夹:",l),b.value.folder_level==="platform"||!b.value.folder_level&&i.value.length===0){const{data:a,error:n}=await d.from("ad_categories").insert({name:J.name,platform_id:b.value.id,sort_order:0}).select();if(n)throw n;e=a,ae(`platform_${b.value.id}`)}else if(b.value.folder_level==="category"||!b.value.folder_level&&i.value.length===1){const{data:a,error:n}=await d.from("ad_subcategories").insert({name:J.name,category_id:b.value.id,sort_order:0}).select();if(n)throw n;e=a,ae(`category_${b.value.id}`)}else if(b.value.folder_level==="subcategory"||!b.value.folder_level&&i.value.length===2){const{data:a,error:n}=await d.from("ad_topics").insert({name:J.name,subcategory_id:b.value.id,sort_order:0}).select();if(n)throw n;e=a,ae(`subcategory_${b.value.id}`)}}else if(l.length===1){const a=l[0],{data:n,error:u}=await d.from("ad_categories").insert({name:J.name,platform_id:a,sort_order:0}).select();if(u)throw u;e=n,ae(`platform_${a}`)}else if(l.length===2){const a=l[0],{data:n,error:u}=await d.from("ad_subcategories").insert({name:J.name,category_id:a,sort_order:0}).select();if(u)throw u;e=n,ae(`category_${a}`)}else if(l.length===3){const a=l[1],{data:n,error:u}=await d.from("ad_topics").insert({name:J.name,subcategory_id:a,sort_order:0}).select();if(u)throw u;e=n,ae(`subcategory_${a}`)}else throw new Error("无法在当前层级创建文件夹");k.success("创建成功"),T.value=!1,We()}catch(e){console.error("创建文件夹失败:",e),k.error(`创建失败: ${e.message||"文件夹最多只能有3级"}`)}finally{C.value=!1}},Ke=e=>{const l=qe.find(a=>a.value===e);return(l==null?void 0:l.label)||e},Oe=e=>{const l=Ye.find(a=>a.value===e);return(l==null?void 0:l.label)||e},Be=e=>{var a,n,u,s;if(!e)return"";const l=[];return(a=e.platform_info)!=null&&a.name&&l.push(e.platform_info.name),(n=e.category_info)!=null&&n.name&&l.push(e.category_info.name),(u=e.subcategory_info)!=null&&u.name&&l.push(e.subcategory_info.name),(s=e.topic_info)!=null&&s.name&&l.push(e.topic_info.name),l.join(" > ")||"根目录"},Vl=e=>{const l=Be(e);return l.length>30?l.substring(0,27)+"...":l},Bl=async()=>{const e=M.value?`folder_options_${M.value}_${A.value||""}_${m.value||""}`:"folder_options_all";if(me.value.has(e)){G.value=me.value.get(e)||[];return}try{const{data:l,error:a}=await d.from("ad_platforms").select("*").order("name");if(a)throw a;const n=l.map(u=>({id:u.id,name:u.name,children:[]}));if(G.value=n,M.value&&A.value)try{const{data:u}=await d.from("ad_categories").select("*").eq("platform_id",A.value).order("name"),s=n.findIndex(c=>c.id===A.value);if(s>=0&&u&&(n[s].children=u.map(c=>({id:c.id,name:c.name,children:[]})),i.value.length===1&&m.value)){const{data:c}=await d.from("ad_subcategories").select("*").eq("category_id",m.value).order("name"),Q=n[s].children.findIndex(E=>E.id===m.value);Q>=0&&c&&(n[s].children[Q].children=c.map(E=>({id:E.id,name:E.name,children:[]})))}}catch(u){console.error("获取分类失败:",u)}me.value.set(e,n),G.value=n}catch(l){console.error("加载文件夹选项失败:",l),k.error("加载文件夹结构失败"),G.value=[]}},ae=e=>{e?(X.value.delete(e),V.value.delete(e),j.value.clear(),me.value.clear()):(X.value.clear(),V.value.clear(),j.value.clear(),me.value.clear())},We=()=>{ae(A.value?i.value.length===1?`platform_${A.value}`:i.value.length===2?`category_${m.value}`:i.value.length===3?`subcategory_${m.value}`:`topic_${m.value}`:"root"),Z()},Xe=async()=>{if(!$.value.trim()){i.value.length===0&&Ve();return}C.value=!0;try{const e=[],{data:l,error:a}=await d.from("ad_platforms").select("*").ilike("name",`%${$.value}%`).order("name");if(a)throw a;const n=l.map(x=>({...x,is_folder:!0,folder_level:"platform"}));e.push(...n);const{data:u,error:s}=await d.from("ad_categories").select("*, platform:ad_platforms(name)").ilike("name",`%${$.value}%`).order("name");if(s)throw s;const c=u.map(x=>({...x,is_folder:!0,folder_level:"category",path_info:x.platform?`${x.platform.name} > ${x.name}`:x.name}));e.push(...c);const{data:Q,error:E}=await d.from("ad_subcategories").select("*, category:ad_categories(name, platform:ad_platforms(name))").ilike("name",`%${$.value}%`).order("name");if(E)throw E;const N=Q.map(x=>{var te;return{...x,is_folder:!0,folder_level:"subcategory",path_info:x.category?`${((te=x.category.platform)==null?void 0:te.name)||""} > ${x.category.name} > ${x.name}`:x.name}});e.push(...N);const{data:O,error:ee}=await d.from("ad_topics").select("*, subcategory:ad_subcategories(name, category:ad_categories(name, platform:ad_platforms(name)))").ilike("name",`%${$.value}%`).order("name");if(ee)throw ee;const ne=O.map(x=>{var te,_e,pe;return{...x,is_folder:!0,folder_level:"topic",path_info:x.subcategory?`${((_e=(te=x.subcategory.category)==null?void 0:te.platform)==null?void 0:_e.name)||""} > ${((pe=x.subcategory.category)==null?void 0:pe.name)||""} > ${x.subcategory.name} > ${x.name}`:x.name}});e.push(...ne),F.value=e}catch(e){console.error("搜索文件夹失败:",e),k.error("搜索文件夹失败")}finally{C.value=!1}};Xl(()=>{fe(),se.value==="folders"&&Ve()});const Re=p(!1);Ue(se,e=>{e==="folders"&&!Re.value&&F.value.length===0&&(Ve(),Re.value=!0)});let Ie=null;return Ue(M,(e,l)=>{Ie&&clearTimeout(Ie),e!==l&&(Ie=setTimeout(()=>{e?wl():(A.value=null,I.value=null,i.value=[],m.value=null,Z())},300))}),Rl(()=>{z&&z.destruct()}),(e,l)=>{const a=h("el-input"),n=h("el-option"),u=h("el-select"),s=h("el-button"),c=h("el-space"),Q=h("el-card"),E=h("el-table-column"),N=h("el-image"),O=h("el-tooltip"),ee=h("el-button-group"),ne=h("el-table"),x=h("el-empty"),te=h("el-tab-pane"),_e=h("el-icon"),pe=h("el-text"),Il=h("el-breadcrumb-item"),Ql=h("el-breadcrumb"),Dl=h("el-tabs"),be=h("el-dialog"),Qe=h("el-form-item"),Pl=h("el-cascader"),Ul=h("el-tag"),$l=h("el-form"),Ze=Zl("loading");return _(),D("div",da,[t(oa,{breadcrumb:xe},null,8,["breadcrumb"]),l[52]||(l[52]=f("div",{class:"layout-title"},[f("h1",{class:"title"},"学习资料管理")],-1)),t(Dl,{modelValue:se.value,"onUpdate:modelValue":l[6]||(l[6]=r=>se.value=r),class:"tabs-container"},{default:o(()=>[t(te,{label:"资料管理",name:"materials"},{default:o(()=>[t(Q,{shadow:"always",style:{"margin-bottom":"20px"}},{default:o(()=>[t(c,{wrap:"",alignment:"start",size:30},{default:o(()=>[t(a,{modelValue:de.value,"onUpdate:modelValue":l[0]||(l[0]=r=>de.value=r),style:{width:"240px"},placeholder:"请输入资料标题","suffix-icon":ke(ol),size:"large",clearable:""},null,8,["modelValue","suffix-icon"]),t(u,{modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=r=>g.value=r),placeholder:"文件类型",clearable:"",style:{width:"180px"},size:"large"},{default:o(()=>[(_(),D(ye,null,Ae(qe,r=>t(n,{key:r.value,label:r.label,value:r.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),t(u,{modelValue:re.value,"onUpdate:modelValue":l[2]||(l[2]=r=>re.value=r),placeholder:"平台",clearable:"",style:{width:"180px"},size:"large"},{default:o(()=>[(_(),D(ye,null,Ae(Ye,r=>t(n,{key:r.value,label:r.label,value:r.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),t(s,{type:"primary",size:"large",onClick:fe},{default:o(()=>l[21]||(l[21]=[y("搜索")])),_:1}),t(s,{type:"primary",size:"large",onClick:dl},{default:o(()=>l[22]||(l[22]=[y("资料上传")])),_:1})]),_:1})]),_:1}),f("div",ca,[t(Q,{style:{"min-height":"400px"}},{header:o(()=>[f("div",fa,[l[24]||(l[24]=y(" 学习资料列表 ")),f("div",pa,[t(s,{type:"danger",disabled:!H.value.length,onClick:_l},{default:o(()=>l[23]||(l[23]=[y(" 批量删除 ")])),_:1},8,["disabled"]),f("div",va,"共计 "+P(R.total)+" 条数据",1)])])]),default:o(()=>[tl((_(),Y(ne,{data:ie.value,onSelectionChange:yl},{default:o(()=>[t(E,{type:"selection",width:"55"}),t(E,{label:"类型",width:"80"},{default:o(({row:r})=>[t(N,{style:{width:"30px",height:"30px"},src:Me(r.type),fit:"contain"},null,8,["src"])]),_:1}),t(E,{prop:"title",label:"标题"}),t(E,{prop:"platform",label:"平台"},{default:o(({row:r})=>[y(P(Oe(r.platform)),1)]),_:1}),t(E,{label:"所在位置"},{default:o(({row:r})=>[t(O,{effect:"dark",content:Be(r),placement:"top"},{default:o(()=>[f("span",null,P(Vl(r)),1)]),_:2},1032,["content"])]),_:1}),t(E,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:r})=>[y(P(new Date(r.created_at).toLocaleString()),1)]),_:1}),t(E,{label:"操作",width:"180",fixed:"right"},{default:o(({row:r})=>[t(ee,null,{default:o(()=>[t(s,{type:"primary",onClick:q=>Se(r)},{default:o(()=>l[25]||(l[25]=[y("查看")])),_:2},1032,["onClick"]),t(s,{type:"danger",onClick:q=>je(r)},{default:o(()=>l[26]||(l[26]=[y("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ze,oe.value]]),!oe.value&&ie.value.length===0?(_(),Y(x,{key:0,description:"暂无学习资料"})):S("",!0)]),_:1}),t(ra,{pagination:R,"onUpdate:pagination":fl},null,8,["pagination"])])]),_:1}),t(te,{label:"文件夹管理",name:"folders"},{default:o(()=>[t(Q,{style:{"margin-bottom":"20px"}},{default:o(()=>[t(c,{wrap:"",alignment:"start",size:30},{default:o(()=>[t(a,{modelValue:$.value,"onUpdate:modelValue":l[3]||(l[3]=r=>$.value=r),placeholder:"搜索文件夹名称",clearable:"",style:{width:"240px"},size:"large",onKeyup:ea(Xe,["enter"]),"suffix-icon":ke(ol)},null,8,["modelValue","suffix-icon"]),t(s,{type:"primary",size:"large",onClick:Xe},{default:o(()=>l[27]||(l[27]=[y("搜索")])),_:1}),t(s,{type:"primary",size:"large",onClick:He},{default:o(()=>l[28]||(l[28]=[y("新建文件夹")])),_:1})]),_:1})]),_:1}),t(Q,{class:"folder-breadcrumb",style:{"margin-bottom":"20px"}},{default:o(()=>[t(pe,{onClick:l[4]||(l[4]=r=>bl()),style:{cursor:"pointer","margin-right":"10px"}},{default:o(()=>[t(_e,{size:16,color:"#000"},{default:o(()=>[t(ke(aa))]),_:1})]),_:1}),t(pe,{onClick:l[5]||(l[5]=r=>kl()),style:{cursor:"pointer","margin-right":"10px"}},{default:o(()=>[t(_e,{size:16,color:"#000"},{default:o(()=>[t(ke(ta))]),_:1})]),_:1}),t(Ql,{separator:"/"},{default:o(()=>[(_(!0),D(ye,null,Ae(i.value,r=>(_(),Y(Il,{key:r.id,onClick:q=>Cl(r)},{default:o(()=>[y(P(r.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),tl((_(),Y(Q,{style:{"min-height":"400px"}},{header:o(()=>l[29]||(l[29]=[f("div",{class:"card-header"}," 文件夹列表 ",-1)])),default:o(()=>[t(ne,{data:F.value,style:{width:"100%"}},{default:o(()=>[t(E,{label:"",width:"60"},{default:o(({row:r})=>[t(N,{style:{width:"24px",height:"24px"},src:r.is_folder?Al():Me(r.type),fit:"contain"},null,8,["src"])]),_:1}),t(E,{prop:"name",label:"名称"},{default:o(({row:r})=>[t(pe,{class:"folder-title",onClick:q=>Ne(r)},{default:o(()=>[y(P(r.is_folder?r.name:r.title),1)]),_:2},1032,["onClick"])]),_:1}),$.value.trim()?(_(),Y(E,{key:0,prop:"path_info",label:"路径"},{default:o(({row:r})=>[r.path_info?(_(),Y(O,{key:0,effect:"dark",content:r.path_info||"",placement:"top"},{default:o(()=>{var q;return[f("span",null,P(((q=r.path_info)==null?void 0:q.length)>30?r.path_info.substring(0,27)+"...":r.path_info),1)]}),_:2},1032,["content"])):S("",!0)]),_:1})):S("",!0),t(E,{prop:"type",label:"类型"},{default:o(({row:r})=>[y(P(r.is_folder?"文件夹":Ke(r.type)),1)]),_:1}),t(E,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:r})=>[y(P(hl(r.created_at)),1)]),_:1}),t(E,{label:"操作",width:"300"},{default:o(({row:r})=>[t(ee,null,{default:o(()=>[t(s,{type:"primary",onClick:q=>Ne(r)},{default:o(()=>[y(P(r.is_folder?"打开":"查看"),1)]),_:2},1032,["onClick"]),t(s,{type:"danger",onClick:q=>xl(r),disabled:(r.is_folder,!1)},{default:o(()=>l[30]||(l[30]=[y(" 删除 ")])),_:2},1032,["onClick","disabled"]),r.is_folder?(_(),Y(s,{key:0,type:"success",onClick:q=>He(r)},{default:o(()=>l[31]||(l[31]=[y(" 新建 ")])),_:2},1032,["onClick"])):S("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"]),!C.value&&F.value.length===0?(_(),Y(x,{key:0,description:"暂无数据"})):S("",!0)]),_:1})),[[Ze,C.value]])]),_:1})]),_:1},8,["modelValue"]),t(be,{title:"资料详情",modelValue:ue.value,"onUpdate:modelValue":l[8]||(l[8]=r=>ue.value=r),width:"50%"},{footer:o(()=>[t(s,{onClick:l[7]||(l[7]=r=>ue.value=!1)},{default:o(()=>l[40]||(l[40]=[y("关闭")])),_:1})]),default:o(()=>{var r,q,el,ll,al;return[f("div",ma,[f("div",ga,[f("div",_a,[t(N,{style:{width:"40px",height:"40px"},src:Me((r=U.value)==null?void 0:r.type),fit:"contain"},null,8,["src"]),f("h2",ya,P(((q=U.value)==null?void 0:q.title)||"无标题"),1)]),f("p",null,[l[32]||(l[32]=f("strong",null,"类型:",-1)),l[33]||(l[33]=y()),f("span",null,P(Ke((el=U.value)==null?void 0:el.type)),1)]),f("p",null,[l[34]||(l[34]=f("strong",null,"平台:",-1)),l[35]||(l[35]=y()),f("span",null,P(Oe((ll=U.value)==null?void 0:ll.platform)),1)]),f("p",null,[l[36]||(l[36]=f("strong",null,"位置:",-1)),l[37]||(l[37]=y()),f("span",null,P(Be(U.value)),1)]),f("p",null,[l[38]||(l[38]=f("strong",null,"创建时间:",-1)),l[39]||(l[39]=y()),f("span",null,P((al=U.value)!=null&&al.created_at?new Date(U.value.created_at).toLocaleString():""),1)]),f("div",Aa,[t(s,{type:"primary",onClick:pl},{default:o(()=>[y(P(ul()),1)]),_:1})])])])]}),_:1},8,["modelValue"]),t(be,{modelValue:le.value,"onUpdate:modelValue":l[14]||(l[14]=r=>le.value=r),title:"文件预览",width:"80%","destroy-on-close":""},{footer:o(()=>[t(s,{onClick:l[13]||(l[13]=r=>le.value=!1)},{default:o(()=>l[48]||(l[48]=[y("关闭")])),_:1}),he.value||we.value||ge.value?(_(),Y(s,{key:0,type:"primary",onClick:Ge},{default:o(()=>l[49]||(l[49]=[y(" 全屏查看 ")])),_:1})):S("",!0)]),default:o(()=>[f("div",ha,[he.value?(_(),D("img",{key:0,src:B.value,class:"material-image",onClick:Ge},null,8,wa)):we.value?(_(),D("iframe",{key:1,src:B.value,class:"material-frame"},null,8,ba)):Ee.value?(_(),D("iframe",{key:2,src:ce.value,class:"word-preview-frame"},null,8,ka)):ge.value?(_(),D("iframe",{key:3,src:ce.value,class:"word-preview-frame"},null,8,Ca)):Je.value?(_(),D("div",xa,[f("p",null,"链接地址："+P(B.value),1),t(s,{type:"primary",onClick:vl},{default:o(()=>l[41]||(l[41]=[y("打开链接")])),_:1})])):Fe.value?(_(),D("div",Ea,[f("video",{src:B.value,controls:"",class:"material-video"},null,8,Ma)])):ze.value?(_(),D("div",Va,[f("div",{innerHTML:B.value,class:"text-content"},null,8,Ba)])):Te.value?(_(),D("div",Ia,[f("div",Qa,[t(ee,null,{default:o(()=>[t(s,{type:L.value==="preview"?"primary":"",onClick:l[9]||(l[9]=r=>L.value="preview")},{default:o(()=>l[42]||(l[42]=[y(" 预览 ")])),_:1},8,["type"]),t(s,{type:L.value==="edit"?"primary":"",onClick:l[10]||(l[10]=r=>L.value="edit")},{default:o(()=>l[43]||(l[43]=[y(" 编辑 ")])),_:1},8,["type"]),t(s,{type:L.value==="split"?"primary":"",onClick:l[11]||(l[11]=r=>L.value="split")},{default:o(()=>l[44]||(l[44]=[y(" 分屏 ")])),_:1},8,["type"])]),_:1}),t(s,{type:"success",onClick:gl,loading:v.value},{default:o(()=>l[45]||(l[45]=[y(" 保存 ")])),_:1},8,["loading"])]),f("div",{class:la(["markdown-container",L.value])},[L.value==="edit"||L.value==="split"?(_(),D("div",Da,[t(a,{modelValue:w.value,"onUpdate:modelValue":l[12]||(l[12]=r=>w.value=r),type:"textarea",rows:20,placeholder:"请输入Markdown内容...",class:"markdown-textarea"},null,8,["modelValue"])])):S("",!0),L.value==="preview"||L.value==="split"?(_(),D("div",Pa,[f("div",{innerHTML:il.value,class:"markdown-html"},null,8,Ua)])):S("",!0)],2)])):(_(),D("div",$a,[l[47]||(l[47]=f("p",null,"无法预览此类型的文件，请下载后查看",-1)),t(s,{type:"primary",onClick:ml},{default:o(()=>l[46]||(l[46]=[y("下载文件")])),_:1})]))])]),_:1},8,["modelValue"]),t(be,{modelValue:ve.value,"onUpdate:modelValue":l[15]||(l[15]=r=>ve.value=r),title:"全屏预览",width:"100%",top:"0","show-close":!0,"destroy-on-close":"",class:"fullscreen-dialog"},{default:o(()=>[f("div",Ja,[he.value?(_(),D("img",{key:0,src:B.value,class:"fullscreen-image"},null,8,Fa)):we.value?(_(),D("iframe",{key:1,src:B.value,class:"fullscreen-frame"},null,8,za)):ge.value?(_(),D("iframe",{key:2,src:ce.value,class:"fullscreen-frame"},null,8,Ta)):S("",!0)])]),_:1},8,["modelValue"]),t(ua,{visible:K.value,"onUpdate:visible":[l[16]||(l[16]=r=>K.value=r),cl]},null,8,["visible"]),t(be,{modelValue:T.value,"onUpdate:modelValue":l[20]||(l[20]=r=>T.value=r),title:b.value?`在 '${b.value.name||b.value.title||""}' 下创建文件夹`:"创建文件夹",width:"30%"},{footer:o(()=>[t(s,{onClick:l[19]||(l[19]=r=>T.value=!1)},{default:o(()=>l[50]||(l[50]=[y("取消")])),_:1}),t(s,{type:"primary",onClick:Ml},{default:o(()=>l[51]||(l[51]=[y("确定")])),_:1})]),default:o(()=>[t($l,{model:J,"label-width":"80px"},{default:o(()=>[t(Qe,{label:"名称"},{default:o(()=>[t(a,{modelValue:J.name,"onUpdate:modelValue":l[17]||(l[17]=r=>J.name=r),placeholder:"请输入文件夹名称"},null,8,["modelValue"])]),_:1}),b.value?b.value?(_(),Y(Qe,{key:1,label:"所在位置"},{default:o(()=>[t(Ul,{type:"info"},{default:o(()=>[y(P(b.value.is_folder?b.value.name:b.value.title),1)]),_:1})]),_:1})):S("",!0):(_(),Y(Qe,{key:0,label:"所在位置"},{default:o(()=>[t(Pl,{modelValue:J.folderPath,"onUpdate:modelValue":l[18]||(l[18]=r=>J.folderPath=r),options:G.value,props:{checkStrictly:!0,emitPath:!0,value:"id",label:"name",children:"children"},clearable:"",placeholder:"请选择文件夹位置",style:{width:"100%"}},{default:o(({node:r,data:q})=>[f("span",null,P(q.name),1),r.isLeaf?S("",!0):(_(),D("span",qa," ("+P(q.children.length)+") ",1))]),empty:o(()=>[t(x,{description:"加载中..."})]),_:1},8,["modelValue","options"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Wa=sl(Ya,[["__scopeId","data-v-6cbe4320"]]);export{Wa as default};
