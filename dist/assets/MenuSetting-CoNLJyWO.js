import{E as g,s as re,c as se}from"./elementPlus-DTEdDlyA.js";import{s as U,B as ue,b as ie,_ as de}from"./index-CcL09R9_.js";import{g as pe}from"./role-BWdQfSNx.js";import{x as ce,r as d,X as me,c as $,j as _e,y as S,P as l,A as b,H as o,ag as r,u as fe,L as p,I as ve,aq as ge,G as h,M as D,K as be,O as E,a6 as N,z as c}from"./vendor-COQJj1AX.js";import"./supabase-Dt8ksRgS.js";const ye=async()=>{const{data:m,error:s}=await U.from("menu").select("*").order("order_index",{ascending:!0});if(s)throw s;return{data:m}},xe=async m=>{const{data:s,error:_}=await U.from("menu").insert(m).select();if(_)throw _;return{data:s}},we=async(m,s)=>{const{data:_,error:i}=await U.from("menu").update(s).eq("id",m).select();if(i)throw i;return{data:_}},Ve=async m=>{const{error:s}=await U.from("menu").delete().eq("id",m);if(s)throw s},he={class:"layout"},ke={class:"menu-content"},Me={class:"card-header"},Ce={class:"header-actions"},ze={style:{"font-size":"14px",color:"#909399"}},Le={class:"dialog-footer"},Se=ce({__name:"MenuSetting",setup(m){const s=[{name:"菜单管理",path:"/system/menu-setting"}],_=d(!1),i=d([]),k=d([]),V=d(""),y=d(!1),B=d(""),q=d(null),u=me({page:1,pageSize:10,total:0}),n=d({name:"",path:"",icon:"",parent_id:null,order_index:0,role_ids:null}),A={name:[{required:!0,message:"请输入菜单名称",trigger:"blur"}],path:[{required:!0,message:"请输入路由路径",trigger:"blur"}]},I=$(()=>i.value.map(t=>({order_index:t.order_index,name:t.name}))),M=d([]),O=$(()=>{const t=(u.page-1)*u.pageSize,e=t+u.pageSize;return i.value.slice(t,e)}),C=async()=>{_.value=!0;try{const t=await ye();M.value=t.data,i.value=t.data,u.total=t.data.length}catch(t){console.error("获取菜单列表失败:",t),g.error("获取菜单列表失败")}finally{_.value=!1}},P=async()=>{try{const t=await pe();k.value=t.data,console.log(k.value)}catch(t){console.error("获取角色列表失败:",t),g.error("获取角色列表失败")}},j=t=>{u.page=t.page,u.pageSize=t.pageSize,C()},G=()=>{if(u.page=1,!V.value){i.value=M.value,u.total=M.value.length;return}i.value=M.value.filter(t=>t.name.includes(V.value)||t.path&&t.path.includes(V.value)),u.total=i.value.length},H=()=>{B.value="添加菜单",n.value={name:"",path:"",icon:"",parent_id:null,order_index:0,role_ids:[]},y.value=!0},K=t=>{B.value="编辑菜单",n.value={...t},y.value=!0},Q=async t=>{try{await se.confirm("确定要删除该菜单吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ve(Number(t.id)),g.success("删除成功"),C()}catch(e){e!=="cancel"&&(console.error("删除菜单失败:",e),g.error("删除失败"))}},X=async()=>{q.value&&await q.value.validate(async t=>{if(t)try{n.value.id?(await we(Number(n.value.id),n.value),g.success("更新成功")):(await xe(n.value),g.success("创建成功")),y.value=!1,C()}catch(e){console.error(n.value.id?"更新失败:":"创建失败:",e),g.error(n.value.id?"更新失败":"创建失败")}})};return _e(async()=>{await Promise.all([C(),P()])}),(t,e)=>{const z=r("el-input"),x=r("el-button"),J=r("el-space"),F=r("el-card"),f=r("el-table-column"),W=r("el-icon"),Y=r("el-tag"),Z=r("el-button-group"),ee=r("el-table"),w=r("el-form-item"),R=r("el-option"),T=r("el-select"),le=r("el-input-number"),ae=r("el-form"),te=r("el-dialog"),oe=ge("loading");return c(),S("div",he,[l(ue,{breadbcrum:s}),e[16]||(e[16]=b("div",{class:"layout-title"},[b("h1",{class:"title"},"菜单管理")],-1)),l(F,{shadow:"always",style:{"margin-bottom":"20px"}},{default:o(()=>[l(J,{wrap:"",alignment:"start",size:30},{default:o(()=>[l(z,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=a=>V.value=a),style:{width:"240px"},placeholder:"请输入菜单名称","suffix-icon":fe(re),size:"large",clearable:""},null,8,["modelValue","suffix-icon"]),l(x,{type:"primary",size:"large",onClick:G},{default:o(()=>e[9]||(e[9]=[p("搜索")])),_:1}),l(x,{type:"success",size:"large",onClick:H},{default:o(()=>e[10]||(e[10]=[p("添加菜单")])),_:1})]),_:1})]),_:1}),b("div",ke,[l(F,{style:{"min-height":"400px"}},{header:o(()=>[b("div",Me,[e[11]||(e[11]=p(" 菜单列表 ")),b("div",Ce,[b("div",ze,"共计"+D(u.total)+"条数据",1)])])]),default:o(()=>[ve((c(),h(ee,{data:O.value,"row-key":"id"},{default:o(()=>[l(f,{prop:"name",label:"菜单名称",width:"180"}),l(f,{prop:"path",label:"路由路径",width:""}),l(f,{prop:"parent_id",label:"父级菜单",width:"120"},{default:o(({row:a})=>{var v;return[p(D(a.parent_id?(v=i.value.find(L=>L.order_index===a.parent_id))==null?void 0:v.name:"顶级菜单"),1)]}),_:1}),l(f,{prop:"icon",label:"图标",width:"120"},{default:o(({row:a})=>[l(W,null,{default:o(()=>[(c(),h(be(a.icon)))]),_:2},1024)]),_:1}),l(f,{prop:"order_index",label:"排序",width:"150"}),l(f,{label:"角色权限"},{default:o(({row:a})=>[(c(!0),S(E,null,N(a.role_ids,v=>(c(),h(Y,{key:v,class:"mx-1"},{default:o(()=>{var L;return[p(D((L=k.value.find(ne=>ne.role_id===v))==null?void 0:L.name),1)]}),_:2},1024))),128))]),_:1}),l(f,{label:"操作",width:"200"},{default:o(({row:a})=>[l(Z,null,{default:o(()=>[l(x,{type:"primary",onClick:v=>K(a)},{default:o(()=>e[12]||(e[12]=[p(" 编辑 ")])),_:2},1032,["onClick"]),l(x,{type:"danger",onClick:v=>Q(a)},{default:o(()=>e[13]||(e[13]=[p(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[oe,_.value]])]),_:1}),l(ie,{pagination:u,"onUpdate:pagination":j},null,8,["pagination"]),l(te,{title:B.value,modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=a=>y.value=a),width:"500px"},{footer:o(()=>[b("span",Le,[l(x,{onClick:e[7]||(e[7]=a=>y.value=!1)},{default:o(()=>e[14]||(e[14]=[p("取消")])),_:1}),l(x,{type:"primary",onClick:X},{default:o(()=>e[15]||(e[15]=[p("确定")])),_:1})])]),default:o(()=>[l(ae,{model:n.value,rules:A,ref_key:"menuFormRef",ref:q,"label-width":"100px"},{default:o(()=>[l(w,{label:"菜单名称",prop:"name"},{default:o(()=>[l(z,{modelValue:n.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.name=a)},null,8,["modelValue"])]),_:1}),l(w,{label:"路由路径",prop:"path"},{default:o(()=>[l(z,{modelValue:n.value.path,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.path=a)},null,8,["modelValue"])]),_:1}),l(w,{label:"图标",prop:"icon"},{default:o(()=>[l(z,{modelValue:n.value.icon,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.icon=a)},null,8,["modelValue"])]),_:1}),l(w,{label:"父级菜单",prop:"parent_id"},{default:o(()=>[l(T,{modelValue:n.value.parent_id,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.parent_id=a),clearable:""},{default:o(()=>[(c(!0),S(E,null,N(I.value,a=>(c(),h(R,{key:a.order_index,label:a.name,value:a.order_index},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(w,{label:"排序",prop:"order_index"},{default:o(()=>[l(le,{modelValue:n.value.order_index,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.order_index=a),min:0},null,8,["modelValue"])]),_:1}),l(w,{label:"角色权限",prop:"role_ids"},{default:o(()=>[l(T,{modelValue:n.value.role_ids,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.role_ids=a),multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:o(()=>[(c(!0),S(E,null,N(k.value,a=>(c(),h(R,{key:a.role_id,label:a.name,value:a.role_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])])}}}),Ne=de(Se,[["__scopeId","data-v-aa37110f"]]);export{Ne as default};
