import{s as L,d as re,r as i,J as se,k as $,o as ue,l as S,a as l,e as g,K as de,w as o,b as r,P as ie,M as b,g as pe,a5 as ce,f as p,y as me,O as _e,c as h,t as F,n as fe,F as N,m as q,U as ve,j as c,_ as ge}from"./index-DftwwiuU.js";import{g as be}from"./role-yrQ7DzLs.js";const ye=async()=>{const{data:m,error:s}=await L.from("menu").select("*").order("order_index",{ascending:!0});if(s)throw s;return{data:m}},we=async m=>{const{data:s,error:_}=await L.from("menu").insert(m).select();if(_)throw _;return{data:s}},xe=async(m,s)=>{const{data:_,error:d}=await L.from("menu").update(s).eq("id",m).select();if(d)throw d;return{data:_}},Ve=async m=>{const{error:s}=await L.from("menu").delete().eq("id",m);if(s)throw s},he={class:"layout"},ke={class:"menu-content"},Me={class:"card-header"},Ce={class:"header-actions"},Ue={style:{"font-size":"14px",color:"#909399"}},ze={class:"dialog-footer"},Se=re({__name:"MenuSetting",setup(m){const s=[{name:"菜单管理",path:"/system/menu-setting"}],_=i(!1),d=i([]),k=i([]),V=i(""),y=i(!1),B=i(""),D=i(null),u=se({page:1,pageSize:10,total:0}),n=i({name:"",path:"",icon:"",parent_id:null,order_index:0,role_ids:[]}),O={name:[{required:!0,message:"请输入菜单名称",trigger:"blur"}],path:[{required:!0,message:"请输入路由路径",trigger:"blur"}]},P=$(()=>d.value.map(t=>({order_index:t.order_index,name:t.name}))),M=i([]),j=$(()=>{const t=(u.page-1)*u.pageSize,e=t+u.pageSize;return d.value.slice(t,e)}),C=async()=>{_.value=!0;try{const t=await ye();M.value=t.data,d.value=t.data,u.total=t.data.length}catch(t){console.error("获取菜单列表失败:",t),b.error("获取菜单列表失败")}finally{_.value=!1}},A=async()=>{try{const t=await be();k.value=t.data,console.log(k.value)}catch(t){console.error("获取角色列表失败:",t),b.error("获取角色列表失败")}},I=t=>{u.page=t.page,u.pageSize=t.pageSize,C()},J=()=>{if(u.page=1,!V.value){d.value=M.value,u.total=M.value.length;return}d.value=M.value.filter(t=>t.name.includes(V.value)||t.path&&t.path.includes(V.value)),u.total=d.value.length},K=()=>{B.value="添加菜单",n.value={name:"",path:"",icon:"",parent_id:null,order_index:0,role_ids:[]},y.value=!0},Q=t=>{B.value="编辑菜单",n.value={...t},y.value=!0},G=async t=>{try{await ve.confirm("确定要删除该菜单吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ve(Number(t.id)),b.success("删除成功"),C()}catch(e){e!=="cancel"&&(console.error("删除菜单失败:",e),b.error("删除失败"))}},H=async()=>{D.value&&await D.value.validate(async t=>{if(t)try{n.value.id?(await xe(Number(n.value.id),n.value),b.success("更新成功")):(await we(n.value),b.success("创建成功")),y.value=!1,C()}catch(e){console.error(n.value.id?"更新失败:":"创建失败:",e),b.error(n.value.id?"更新失败":"创建失败")}})};return ue(async()=>{await Promise.all([C(),A()])}),(t,e)=>{const U=r("el-input"),w=r("el-button"),W=r("el-space"),E=r("el-card"),f=r("el-table-column"),X=r("el-icon"),Y=r("el-tag"),Z=r("el-button-group"),ee=r("el-table"),x=r("el-form-item"),R=r("el-option"),T=r("el-select"),le=r("el-input-number"),ae=r("el-form"),te=r("el-dialog"),oe=_e("loading");return c(),S("div",he,[l(de,{breadbcrum:s}),e[16]||(e[16]=g("div",{class:"layout-title"},[g("h1",{class:"title"},"菜单管理")],-1)),l(E,{shadow:"always",style:{"margin-bottom":"20px"}},{default:o(()=>[l(W,{wrap:"",alignment:"start",size:30},{default:o(()=>[l(U,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=a=>V.value=a),style:{width:"240px"},placeholder:"请输入菜单名称","suffix-icon":pe(ce),size:"large",clearable:""},null,8,["modelValue","suffix-icon"]),l(w,{type:"primary",size:"large",onClick:J},{default:o(()=>e[9]||(e[9]=[p("搜索")])),_:1}),l(w,{type:"success",size:"large",onClick:K},{default:o(()=>e[10]||(e[10]=[p("添加菜单")])),_:1})]),_:1})]),_:1}),g("div",ke,[l(E,{style:{"min-height":"400px"}},{header:o(()=>[g("div",Me,[e[11]||(e[11]=p(" 菜单列表 ")),g("div",Ce,[g("div",Ue,"共计"+F(u.total)+"条数据",1)])])]),default:o(()=>[me((c(),h(ee,{data:j.value,"row-key":"id"},{default:o(()=>[l(f,{prop:"name",label:"菜单名称",width:"180"}),l(f,{prop:"path",label:"路由路径",width:""}),l(f,{prop:"parent_id",label:"父级菜单",width:"120"},{default:o(({row:a})=>{var v;return[p(F(a.parent_id?(v=d.value.find(z=>z.order_index===a.parent_id))==null?void 0:v.name:"顶级菜单"),1)]}),_:1}),l(f,{prop:"icon",label:"图标",width:"120"},{default:o(({row:a})=>[l(X,null,{default:o(()=>[(c(),h(fe(a.icon)))]),_:2},1024)]),_:1}),l(f,{prop:"order_index",label:"排序",width:"150"}),l(f,{label:"角色权限"},{default:o(({row:a})=>[(c(!0),S(N,null,q(a.role_ids,v=>(c(),h(Y,{key:v,class:"mx-1"},{default:o(()=>{var z;return[p(F((z=k.value.find(ne=>ne.role_id===v))==null?void 0:z.name),1)]}),_:2},1024))),128))]),_:1}),l(f,{label:"操作",width:"200"},{default:o(({row:a})=>[l(Z,null,{default:o(()=>[l(w,{type:"primary",onClick:v=>Q(a)},{default:o(()=>e[12]||(e[12]=[p(" 编辑 ")])),_:2},1032,["onClick"]),l(w,{type:"danger",onClick:v=>G(a)},{default:o(()=>e[13]||(e[13]=[p(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[oe,_.value]])]),_:1}),l(ie,{pagination:u,"onUpdate:pagination":I},null,8,["pagination"]),l(te,{title:B.value,modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=a=>y.value=a),width:"500px"},{footer:o(()=>[g("span",ze,[l(w,{onClick:e[7]||(e[7]=a=>y.value=!1)},{default:o(()=>e[14]||(e[14]=[p("取消")])),_:1}),l(w,{type:"primary",onClick:H},{default:o(()=>e[15]||(e[15]=[p("确定")])),_:1})])]),default:o(()=>[l(ae,{model:n.value,rules:O,ref_key:"menuFormRef",ref:D,"label-width":"100px"},{default:o(()=>[l(x,{label:"菜单名称",prop:"name"},{default:o(()=>[l(U,{modelValue:n.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.name=a)},null,8,["modelValue"])]),_:1}),l(x,{label:"路由路径",prop:"path"},{default:o(()=>[l(U,{modelValue:n.value.path,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.path=a)},null,8,["modelValue"])]),_:1}),l(x,{label:"图标",prop:"icon"},{default:o(()=>[l(U,{modelValue:n.value.icon,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.icon=a)},null,8,["modelValue"])]),_:1}),l(x,{label:"父级菜单",prop:"parent_id"},{default:o(()=>[l(T,{modelValue:n.value.parent_id,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.parent_id=a),clearable:""},{default:o(()=>[(c(!0),S(N,null,q(P.value,a=>(c(),h(R,{key:a.order_index,label:a.name,value:a.order_index},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(x,{label:"排序",prop:"order_index"},{default:o(()=>[l(le,{modelValue:n.value.order_index,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.order_index=a),min:0},null,8,["modelValue"])]),_:1}),l(x,{label:"角色权限",prop:"role_ids"},{default:o(()=>[l(T,{modelValue:n.value.role_ids,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.role_ids=a),multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:o(()=>[(c(!0),S(N,null,q(k.value,a=>(c(),h(R,{key:a.role_id,label:a.name,value:a.role_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])])}}}),De=ge(Se,[["__scopeId","data-v-e2d84da3"]]);export{De as default};
