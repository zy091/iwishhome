import{d as W,r as d,k as X,o as Z,l as ee,a as t,e as p,K as te,w as l,b as s,P as ae,s as x,M as f,g as le,a6 as ne,f as r,y as oe,O as se,c as ue,t as g,U as re,j as D,_ as ie}from"./index-CCiOYfNf.js";const de={class:"layout"},ce={class:"announcement-content"},pe={class:"card-header"},me={class:"header-actions"},fe={style:{"font-size":"14px",color:"#909399"}},ve={class:"dialog-footer"},_e=W({__name:"AnnouncementSetting",setup(ge){const T=[{name:"公告管理",path:"/system/announcement-setting"}],S=d(!1),v=d([]),y=d(""),m=d(!1),k=d(""),C=d(null),u=d({page:1,pageSize:10,total:0}),o=d({title:"",content:"",type:"normal",status:!1}),A={title:[{required:!0,message:"请输入公告标题",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}],type:[{required:!0,message:"请选择公告类型",trigger:"change"}]},b=d([]),M=X(()=>{const a=(u.value.page-1)*u.value.pageSize,e=a+u.value.pageSize;return v.value.slice(a,e)}),w=async()=>{S.value=!0;try{const{data:a,error:e}=await x.from("announcements").select("*").order("created_at",{ascending:!1});if(e)throw e;b.value=a||[],v.value=a||[],u.value.total=(a==null?void 0:a.length)||0}catch(a){console.error("获取公告列表失败:",a),f.error("获取公告列表失败")}finally{S.value=!1}},q=a=>{u.value.page=a.page,u.value.pageSize=a.pageSize,w()},L=()=>{if(u.value.page=1,!y.value){v.value=b.value,u.value.total=b.value.length;return}v.value=b.value.filter(a=>a.title.includes(y.value)),u.value.total=v.value.length},E=()=>{k.value="添加公告",o.value={title:"",content:"",type:"normal",status:!1},m.value=!0},F=a=>{k.value="编辑公告",o.value={...a},m.value=!0},N=async a=>{try{await re.confirm("确定要删除该公告吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const{error:e}=await x.from("announcements").delete().eq("id",a.id);if(e)throw e;f.success("删除成功"),w()}catch(e){e!=="cancel"&&(console.error("删除公告失败:",e),f.error("删除失败"))}},I=async()=>{C.value&&await C.value.validate(async a=>{if(a)try{if(o.value.id){const{error:e}=await x.from("announcements").update(o.value).eq("id",o.value.id);if(e)throw e;f.success("更新成功")}else{const{error:e}=await x.from("announcements").insert(o.value);if(e)throw e;f.success("创建成功")}m.value=!1,w()}catch(e){console.error(o.value.id?"更新失败:":"创建失败:",e),f.error(o.value.id?"更新失败":"创建失败")}})};function $(a){if(!a)return"-";const e=new Date(a),_=e.getFullYear(),c=String(e.getMonth()+1).padStart(2,"0"),z=String(e.getDate()).padStart(2,"0"),h=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0");return`${_}-${c}-${z} ${h}:${i}`}function R(a){switch(a){case"important":return"danger";case"update":return"success";default:return"info"}}function j(a){switch(a){case"important":return"重要";case"update":return"更新";default:return"普通"}}return Z(async()=>{await w()}),(a,e)=>{const _=s("el-input"),c=s("el-button"),z=s("el-space"),h=s("el-card"),i=s("el-table-column"),B=s("el-tag"),H=s("el-button-group"),K=s("el-table"),V=s("el-form-item"),U=s("el-option"),O=s("el-select"),P=s("el-switch"),Q=s("el-form"),Y=s("el-dialog"),G=se("loading");return D(),ee("div",de,[t(te,{breadbcrum:T}),e[14]||(e[14]=p("div",{class:"layout-title"},[p("h1",{class:"title"},"公告管理")],-1)),t(h,{shadow:"always",style:{"margin-bottom":"20px"}},{default:l(()=>[t(z,{wrap:"",alignment:"start",size:30},{default:l(()=>[t(_,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=n=>y.value=n),style:{width:"240px"},placeholder:"请输入公告标题","suffix-icon":le(ne),size:"large",clearable:""},null,8,["modelValue","suffix-icon"]),t(c,{type:"primary",size:"large",onClick:L},{default:l(()=>e[7]||(e[7]=[r("搜索")])),_:1}),t(c,{type:"success",size:"large",onClick:E},{default:l(()=>e[8]||(e[8]=[r("添加公告")])),_:1})]),_:1})]),_:1}),p("div",ce,[t(h,{style:{"min-height":"400px"}},{header:l(()=>[p("div",pe,[e[9]||(e[9]=r(" 公告列表 ")),p("div",me,[p("div",fe,"共计"+g(u.value.total)+"条数据",1)])])]),default:l(()=>[oe((D(),ue(K,{data:M.value,"row-key":"id"},{default:l(()=>[t(i,{prop:"id",label:"ID",width:"80"}),t(i,{prop:"title",label:"标题",width:"200"}),t(i,{prop:"content",label:"内容","show-overflow-tooltip":""}),t(i,{prop:"type",label:"类型",width:"100"},{default:l(({row:n})=>[t(B,{type:R(n.type)},{default:l(()=>[r(g(j(n.type)),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"status",label:"状态",width:"100"},{default:l(({row:n})=>[t(B,{type:n.status?"success":"info"},{default:l(()=>[r(g(n.status?"已发布":"未发布"),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"created_at",label:"创建时间",width:"180"},{default:l(({row:n})=>[r(g($(n.created_at)),1)]),_:1}),t(i,{prop:"updated_at",label:"更新时间",width:"180"},{default:l(({row:n})=>[r(g($(n.updated_at)),1)]),_:1}),t(i,{label:"操作",width:"200"},{default:l(({row:n})=>[t(H,null,{default:l(()=>[t(c,{type:"primary",onClick:J=>F(n)},{default:l(()=>e[10]||(e[10]=[r(" 编辑 ")])),_:2},1032,["onClick"]),t(c,{type:"danger",onClick:J=>N(n)},{default:l(()=>e[11]||(e[11]=[r(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[G,S.value]])]),_:1}),t(ae,{pagination:u.value,"onUpdate:pagination":q},null,8,["pagination"]),t(Y,{title:k.value,modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=n=>m.value=n),width:"600px"},{footer:l(()=>[p("span",ve,[t(c,{onClick:e[5]||(e[5]=n=>m.value=!1)},{default:l(()=>e[12]||(e[12]=[r("取消")])),_:1}),t(c,{type:"primary",onClick:I},{default:l(()=>e[13]||(e[13]=[r("确定")])),_:1})])]),default:l(()=>[t(Q,{model:o.value,rules:A,ref_key:"announcementFormRef",ref:C,"label-width":"100px"},{default:l(()=>[t(V,{label:"标题",prop:"title"},{default:l(()=>[t(_,{modelValue:o.value.title,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.title=n)},null,8,["modelValue"])]),_:1}),t(V,{label:"内容",prop:"content"},{default:l(()=>[t(_,{modelValue:o.value.content,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.content=n),type:"textarea",rows:4},null,8,["modelValue"])]),_:1}),t(V,{label:"类型",prop:"type"},{default:l(()=>[t(O,{modelValue:o.value.type,"onUpdate:modelValue":e[3]||(e[3]=n=>o.value.type=n),placeholder:"请选择公告类型"},{default:l(()=>[t(U,{label:"重要",value:"important"}),t(U,{label:"普通",value:"normal"}),t(U,{label:"更新",value:"update"})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"状态",prop:"status"},{default:l(()=>[t(P,{modelValue:o.value.status,"onUpdate:modelValue":e[4]||(e[4]=n=>o.value.status=n),"active-text":"发布","inactive-text":"隐藏"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])])}}}),be=ie(_e,[["__scopeId","data-v-9707eeb7"]]);export{be as default};
