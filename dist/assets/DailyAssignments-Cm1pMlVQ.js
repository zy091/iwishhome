import{a as F}from"./assignmentService-SxpLkSHI.js";import{d as K,u as Q,r as v,J as W,o as X,l as f,e as o,y as Y,a as l,t as i,w as a,b as r,O as Z,c as ee,P as te,M as g,f as d,q as D,F as se,m as le,A as ae,g as y,j as c,_ as ne}from"./index-BsBxzW2u.js";const oe={class:"personal-assignments"},ie={class:"assignments-header"},re={class:"tooltip-content"},ue={class:"text-truncate"},de={key:0,class:"assignment-detail"},_e={class:"assignment-meta"},ce={class:"assignment-content"},pe={key:0,class:"assignment-replies"},me={class:"reply-header"},ve={class:"reply-author"},fe={key:0,class:"reply-role"},ge={class:"reply-form"},ye=K({__name:"DailyAssignments",setup(he){const u=Q(),x=v(!1),k=v([]),C=v(!1),n=v(null),p=v(""),V=v(!1),m=W({page:1,pageSize:10,total:0}),S=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",h=async()=>{x.value=!0;try{const{data:s,total:e}=await F.getPersonalAssignments(m.page,m.pageSize,{status:""});k.value=s,m.total=e}catch(s){console.error("获取作业列表失败:",s),g.error("获取作业列表失败")}finally{x.value=!1}},I=s=>{n.value=s,C.value=!0,p.value=""},P=async()=>{var s;if(n.value){if(!p.value.trim()){g.warning("回复内容不能为空");return}V.value=!0;try{if(!((s=u.user)!=null&&s.user_id)||!n.value.id){g.error("用户信息或作业ID缺失");return}const e=await F.addReply({assignment_id:n.value.id,user_id:u.user.user_id,content:p.value,full_name:u.user.full_name||""});n.value.replies||(n.value.replies=[]),n.value.replies.push(e),g.success("提交回复成功"),p.value="",h()}catch(e){console.error("提交回复失败:",e),g.error("提交回复失败")}finally{V.value=!1}}},$=()=>{h()},j=s=>{m.page=s.page,m.pageSize=s.pageSize,h()},z=s=>{if(!s.replies||s.replies.length===0)return{type:"warning",text:"待完成"};const e=s.replies.some(_=>{var w;return _.user_id===((w=u.user)==null?void 0:w.user_id)});return s.replies.some(_=>_.user_id!==s.assigned_to),e?{type:"success",text:"已完成"}:{type:"warning",text:"待完成"}};return X(()=>{h()}),(s,e)=>{const _=r("el-button"),w=r("el-tooltip"),b=r("el-table-column"),q=r("el-tag"),J=r("el-table"),A=r("el-divider"),O=r("el-input"),U=r("el-form-item"),T=r("el-form"),G=r("el-dialog"),H=Z("loading");return c(),f("div",oe,[o("div",ie,[o("div",null,"共计"+i(k.value.length)+"个作业",1),l(_,{type:"primary",onClick:$},{default:a(()=>e[2]||(e[2]=[d("刷新")])),_:1})]),Y((c(),ee(J,{data:k.value},{default:a(()=>[l(b,{prop:"title",label:"标题","min-width":"180"},{default:a(t=>[l(w,{placement:"top","show-after":500,"max-width":300},{content:a(()=>[o("div",re,i(t.row.title),1)]),default:a(()=>[o("div",ue,i(t.row.title),1)]),_:2},1024)]),_:1}),l(b,{label:"状态",width:"100"},{default:a(t=>[l(q,{type:z(t.row).type},{default:a(()=>[d(i(z(t.row).text),1)]),_:2},1032,["type"])]),_:1}),l(b,{prop:"created_at",label:"创建时间",width:"180"},{default:a(t=>[d(i(S(t.row.created_at)),1)]),_:1}),l(b,{label:"操作",width:"120"},{default:a(t=>[l(_,{type:"primary",onClick:N=>I(t.row)},{default:a(()=>e[3]||(e[3]=[d("查看")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,x.value]]),l(te,{pagination:m,"onUpdate:pagination":j},null,8,["pagination"]),l(G,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),title:"作业详情",width:"600px"},{default:a(()=>[n.value?(c(),f("div",de,[o("h3",null,i(n.value.title),1),o("div",_e,[o("p",null,"创建时间: "+i(S(n.value.created_at)),1)]),o("div",ce,[l(A,{"content-position":"left"},{default:a(()=>e[4]||(e[4]=[d("作业内容")])),_:1}),o("p",null,i(n.value.content),1)]),n.value.replies&&n.value.replies.length>0?(c(),f("div",pe,[l(A,{"content-position":"left"},{default:a(()=>e[5]||(e[5]=[d("回复记录")])),_:1}),(c(!0),f(se,null,le(n.value.replies,(t,N)=>{var B,L,M,R,E;return c(),f("div",{key:N,class:ae(["reply-item",{"my-reply":t.user_id===((B=y(u).user)==null?void 0:B.user_id),"admin-reply":t.user_id!==n.value.assigned_to&&t.user_id!==((L=y(u).user)==null?void 0:L.user_id),"other-reply":t.user_id!==((M=y(u).user)==null?void 0:M.user_id)&&t.user_id===n.value.assigned_to}])},[o("div",me,[o("span",ve,i(t.user_id===((R=y(u).user)==null?void 0:R.user_id)?"我":t.full_name||"未知用户"),1),t.user_id!==n.value.assigned_to&&t.user_id!==((E=y(u).user)==null?void 0:E.user_id)?(c(),f("span",fe,"管理员")):D("",!0)]),o("p",null,i(t.content),1),o("small",null,i(S(t.created_at)),1)],2)}),128))])):D("",!0),o("div",ge,[l(A,{"content-position":"left"},{default:a(()=>e[6]||(e[6]=[d("提交回复")])),_:1}),l(T,null,{default:a(()=>[l(U,null,{default:a(()=>[l(O,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),type:"textarea",rows:4,placeholder:"请输入您的回复内容"},null,8,["modelValue"])]),_:1}),l(U,null,{default:a(()=>[l(_,{type:"primary",onClick:P,loading:V.value},{default:a(()=>e[7]||(e[7]=[d("提交回复")])),_:1},8,["loading"])]),_:1})]),_:1})])])):D("",!0)]),_:1},8,["modelValue"])])}}}),xe=ne(ye,[["__scopeId","data-v-21c51ba4"]]);export{xe as default};
