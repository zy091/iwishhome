import{E as b,s as ue,c as se}from"./elementPlus-BSeP1oVM.js";import{s as E,B as de,e as ie,b as pe}from"./index-BID3odBW.js";import{g as me}from"./role-jKLsjdkm.js";import{x as ce,r as m,X as _e,c as A,j as ve,y as M,P as a,A as y,H as t,ag as r,u as fe,L as i,I as ge,aq as be,G as C,M as B,K as ye,O as q,a6 as D,z as p}from"./vendor-kUynFKsh.js";import"./supabase-CBzAt1Op.js";const Ve=async()=>{const{data:c,error:u}=await E.from("menu").select("*").order("order_index",{ascending:!0});if(u)throw u;return{data:c}},we=async c=>{const{data:u,error:v}=await E.from("menu").insert(c).select();if(v)throw v;return{data:u}},xe=async(c,u)=>{const{data:v,error:V}=await E.from("menu").update(u).eq("id",c).select();if(V)throw V;return{data:v}},he=async c=>{const{error:u}=await E.from("menu").delete().eq("id",c);if(u)throw u},ke={class:"layout"},Me={class:"menu-content"},Ce={class:"card-header"},ze={class:"header-actions"},Le={style:{"font-size":"14px",color:"#909399"}},Ue={class:"dialog-footer"},Se=ce({__name:"MenuSetting",setup(c){const u=[{name:"菜单管理",path:"/system/menu-setting"}],v=[{name:"所有可见",value:"all"},{name:"Google",value:"google"},{name:"Meta",value:"meta"},{name:"Criteo",value:"criteo"},{name:"管理员",value:"admin"}],V=m(!1),f=m([]),z=m([]),k=m(""),w=m(!1),N=m(""),F=m(null),s=_e({page:1,pageSize:10,total:0}),n=m({name:"",path:"",icon:"",parent_id:null,order_index:0,role_ids:null,category:""}),G={name:[{required:!0,message:"请输入菜单名称",trigger:"blur"}],path:[{required:!0,message:"请输入路由路径",trigger:"blur"}]},I=A(()=>f.value.map(o=>({order_index:o.order_index,name:o.name}))),L=m([]),O=A(()=>{const o=(s.page-1)*s.pageSize,e=o+s.pageSize;return f.value.slice(o,e)}),U=async()=>{V.value=!0;try{const o=await Ve();L.value=o.data,f.value=o.data,s.total=o.data.length}catch(o){console.error("获取菜单列表失败:",o),b.error("获取菜单列表失败")}finally{V.value=!1}},P=async()=>{try{const o=await me();z.value=o.data,console.log(z.value)}catch(o){console.error("获取角色列表失败:",o),b.error("获取角色列表失败")}},j=o=>{s.page=o.page,s.pageSize=o.pageSize,U()},H=()=>{if(s.page=1,!k.value){f.value=L.value,s.total=L.value.length;return}f.value=L.value.filter(o=>o.name.includes(k.value)||o.path&&o.path.includes(k.value)),s.total=f.value.length},K=()=>{N.value="添加菜单",n.value={name:"",path:"",icon:"",parent_id:null,order_index:0,role_ids:[],category:""},w.value=!0},Q=o=>{N.value="编辑菜单",n.value={...o},w.value=!0},X=async o=>{try{await se.confirm("确定要删除该菜单吗？此操作不可恢复。","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await he(Number(o.id)),b.success("删除成功"),U()}catch(e){e!=="cancel"&&(console.error("删除菜单失败:",e),b.error("删除失败"))}},J=async()=>{F.value&&await F.value.validate(async o=>{if(o)try{n.value.id?(await xe(Number(n.value.id),n.value),b.success("更新成功")):(await we(n.value),b.success("创建成功")),w.value=!1,U()}catch(e){console.error(n.value.id?"更新失败:":"创建失败:",e),b.error(n.value.id?"更新失败":"创建失败")}})};return ve(async()=>{await Promise.all([U(),P()])}),(o,e)=>{const S=r("el-input"),x=r("el-button"),W=r("el-space"),$=r("el-card"),_=r("el-table-column"),Y=r("el-icon"),Z=r("el-tag"),ee=r("el-button-group"),le=r("el-table"),g=r("el-form-item"),R=r("el-option"),T=r("el-select"),ae=r("el-input-number"),te=r("el-form"),oe=r("el-dialog"),ne=be("loading");return p(),M("div",ke,[a(de,{breadcrumb:u}),e[17]||(e[17]=y("div",{class:"layout-title"},[y("h1",{class:"title"},"菜单管理")],-1)),a($,{shadow:"always",style:{"margin-bottom":"20px"}},{default:t(()=>[a(W,{wrap:"",alignment:"start",size:30},{default:t(()=>[a(S,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=l=>k.value=l),style:{width:"240px"},placeholder:"请输入菜单名称","suffix-icon":fe(ue),size:"large",clearable:""},null,8,["modelValue","suffix-icon"]),a(x,{type:"primary",size:"large",onClick:H},{default:t(()=>e[10]||(e[10]=[i("搜索")])),_:1}),a(x,{type:"success",size:"large",onClick:K},{default:t(()=>e[11]||(e[11]=[i("添加菜单")])),_:1})]),_:1})]),_:1}),y("div",Me,[a($,{style:{"min-height":"400px"}},{header:t(()=>[y("div",Ce,[e[12]||(e[12]=i(" 菜单列表 ")),y("div",ze,[y("div",Le,"共计"+B(s.total)+"条数据",1)])])]),default:t(()=>[ge((p(),C(le,{data:O.value,"row-key":"id"},{default:t(()=>[a(_,{prop:"name",label:"菜单名称",width:"180"}),a(_,{prop:"path",label:"路由路径",width:""}),a(_,{prop:"parent_id",label:"父级菜单",width:"120"},{default:t(({row:l})=>{var d;return[i(B(l.parent_id?(d=f.value.find(h=>h.order_index===l.parent_id))==null?void 0:d.name:"顶级菜单"),1)]}),_:1}),a(_,{prop:"icon",label:"图标",width:"120"},{default:t(({row:l})=>[a(Y,null,{default:t(()=>[(p(),C(ye(l.icon)))]),_:2},1024)]),_:1}),a(_,{prop:"order_index",label:"排序",width:"80"}),a(_,{prop:"category",label:"分类",width:"80"},{default:t(({row:l})=>{var d;return[i(B((d=v.find(h=>h.value===l.category))==null?void 0:d.name),1)]}),_:1}),a(_,{label:"角色权限"},{default:t(({row:l})=>[(p(!0),M(q,null,D(l.role_ids,d=>(p(),C(Z,{key:d,class:"mx-1"},{default:t(()=>{var h;return[i(B((h=z.value.find(re=>re.role_id===d))==null?void 0:h.name),1)]}),_:2},1024))),128))]),_:1}),a(_,{label:"操作",width:"200"},{default:t(({row:l})=>[a(ee,null,{default:t(()=>[a(x,{type:"primary",onClick:d=>Q(l)},{default:t(()=>e[13]||(e[13]=[i(" 编辑 ")])),_:2},1032,["onClick"]),a(x,{type:"danger",onClick:d=>X(l)},{default:t(()=>e[14]||(e[14]=[i(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ne,V.value]])]),_:1}),a(ie,{pagination:s,"onUpdate:pagination":j},null,8,["pagination"]),a(oe,{title:N.value,modelValue:w.value,"onUpdate:modelValue":e[9]||(e[9]=l=>w.value=l),width:"500px"},{footer:t(()=>[y("span",Ue,[a(x,{onClick:e[8]||(e[8]=l=>w.value=!1)},{default:t(()=>e[15]||(e[15]=[i("取消")])),_:1}),a(x,{type:"primary",onClick:J},{default:t(()=>e[16]||(e[16]=[i("确定")])),_:1})])]),default:t(()=>[a(te,{model:n.value,rules:G,ref_key:"menuFormRef",ref:F,"label-width":"100px"},{default:t(()=>[a(g,{label:"菜单名称",prop:"name"},{default:t(()=>[a(S,{modelValue:n.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.name=l)},null,8,["modelValue"])]),_:1}),a(g,{label:"路由路径",prop:"path"},{default:t(()=>[a(S,{modelValue:n.value.path,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.path=l)},null,8,["modelValue"])]),_:1}),a(g,{label:"图标",prop:"icon"},{default:t(()=>[a(S,{modelValue:n.value.icon,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.icon=l)},null,8,["modelValue"])]),_:1}),a(g,{label:"父级菜单",prop:"parent_id"},{default:t(()=>[a(T,{modelValue:n.value.parent_id,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.parent_id=l),clearable:""},{default:t(()=>[(p(!0),M(q,null,D(I.value,l=>(p(),C(R,{key:l.order_index,label:l.name,value:l.order_index},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"排序",prop:"order_index"},{default:t(()=>[a(ae,{modelValue:n.value.order_index,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.order_index=l),min:0},null,8,["modelValue"])]),_:1}),a(g,{label:"分类",prop:"category"},{default:t(()=>[a(T,{modelValue:n.value.category,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.category=l),clearable:""},{default:t(()=>[(p(),M(q,null,D(v,l=>a(R,{key:l.value,label:l.name,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"角色权限",prop:"role_ids"},{default:t(()=>[a(T,{modelValue:n.value.role_ids,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.role_ids=l),multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:t(()=>[(p(!0),M(q,null,D(z.value,l=>(p(),C(R,{key:l.role_id,label:l.name,value:l.role_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])])}}}),Fe=pe(Se,[["__scopeId","data-v-9f41b369"]]);export{Fe as default};
