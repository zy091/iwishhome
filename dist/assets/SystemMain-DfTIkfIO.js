import{e as L,E as j}from"./elementPlus-4XfGssYs.js";import{u as E,_ as H,s as O}from"./index-DURmTYuj.js";import{x as I,r as h,j as N,G as u,H as e,P as n,ag as a,A as f,L as $,M as w,u as P,az as A,z as s,c as T,y as C,O as R,a6 as D,K as B,aE as q}from"./vendor-COQJj1AX.js";import"./supabase-DD2UsJtA.js";const F={class:"toolbar",style:{display:"flex","justify-content":"end","align-items":"center"}},G={style:{display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","margin-right":"5px"}},J=I({__name:"Header",setup(V){const k=A(),y=E(),r=h(y.user);console.log(r.value,"user"),h(""),N(()=>{r.value=y.getUser()});const l=()=>{y.logout(),k.push("/login")};return(b,c)=>{const i=a("el-col"),z=a("el-avatar"),S=a("el-icon"),U=a("el-link"),t=a("el-dropdown-item"),m=a("el-dropdown-menu"),d=a("el-dropdown"),p=a("el-row"),v=a("el-header");return s(),u(v,{style:{"font-size":"16px"}},{default:e(()=>[n(p,{justify:"space-between",gutter:16,style:{height:"100%","align-items":"center"}},{default:e(()=>[n(i,{span:3},{default:e(()=>c[0]||(c[0]=[f("h1",{style:{"font-size":"40px","font-weight":"700"}},"IWISH",-1)])),_:1}),n(i,{span:4},{default:e(()=>{var g,o;return[f("div",F,[n(z,{style:{"margin-right":"10px","min-width":"40px","font-size":"20px","font-weight":"700","align-items":"center","line-height":"40px","justify-content":"center",background:"#2f87ff"},src:(g=r.value)==null?void 0:g.avatar_url},{default:e(()=>{var _,x,M;return[$(w(((M=(x=(_=r.value)==null?void 0:_.full_name)==null?void 0:x.charAt(0))==null?void 0:M.toUpperCase())||"U"),1)]}),_:1},8,["src"]),f("span",G,w((o=r.value)==null?void 0:o.full_name),1),n(d,null,{dropdown:e(()=>[n(m,null,{default:e(()=>[n(t,null,{default:e(()=>[n(U,{href:"/system/personal-data"},{default:e(()=>c[1]||(c[1]=[$(" 个人中心")])),_:1})]),_:1}),n(t,{onClick:l},{default:e(()=>c[2]||(c[2]=[$("退出登录")])),_:1})]),_:1})]),default:e(()=>[n(S,{style:{"margin-right":"10px","margin-top":"1px","font-size":"18px",color:"#fff"}},{default:e(()=>[n(P(L))]),_:1})]),_:1})])]}),_:1})]),_:1})]),_:1})}}}),K=H(J,[["__scopeId","data-v-8f6d8bf3"]]),W=I({__name:"Aside",setup(V){A();const k=h(""),y=h([]),r=h(!1),l=E(),b=T(()=>l.getMenus),c=t=>{k.value=t,t==="/system/demand"&&S()},i=h("");N(async()=>{r.value=!0,await l.fetchMenus();const{data:{session:t}}=await O.auth.getSession();i.value=(t==null?void 0:t.access_token)||"",r.value=!1});function z(t){const m=typeof t=="string"?t:JSON.stringify(t);return btoa(unescape(encodeURIComponent(m))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const S=()=>{var t,m,d,p,v,g,o,_;try{const x={id:((t=l.user)==null?void 0:t.user_id)||"",email:((m=l.user)==null?void 0:m.email)||"",name:((d=l.user)==null?void 0:d.full_name)||((v=(p=l.user)==null?void 0:p.email)==null?void 0:v.split("@")[0])||"用户",role:U((g=l.user)==null?void 0:g.role_id),rolename:(_=(o=l.user)==null?void 0:o.role)==null?void 0:_.name,origin:window.location.origin,exp:Math.floor(Date.now()/1e3)+900},M=z(x);window.open(`https://iwishneed.netlify.app/auth/bridge#external_user=${M}&main_access_token=${i.value}`,"_blank")}catch(x){console.error("处理demand跳转失败:",x),j.error("跳转失败，请稍后重试")}},U=t=>{if(!t)return"submitter";switch(t){case 0:case 1:return"admin";case 2:case 3:return"manager";case 4:case 5:return"developer";default:return"submitter"}};return(t,m)=>{const d=a("el-icon"),p=a("el-menu-item"),v=a("el-sub-menu"),g=a("el-menu");return s(),u(g,{class:"el-menu-vertical-demo","active-text-color":"#fff","background-color":"#05479a","text-color":"#fff",style:{position:"fixed","z-index":"999",height:"calc(100vh - 84px)",left:"0",width:"240px"},router:!0,"unique-opened":!0,"default-active":k.value,"default-openeds":y.value,onSelect:c,loading:r.value},{default:e(()=>[(s(!0),C(R,null,D(b.value,o=>(s(),C(R,{key:o.id},[o.children&&o.children.length>0?(s(),u(v,{key:0,index:`/system${o.path}`},{title:e(()=>[n(d,null,{default:e(()=>[(s(),u(B(o.icon)))]),_:2},1024),f("span",null,w(o.name),1)]),default:e(()=>[(s(!0),C(R,null,D(o.children,_=>(s(),u(p,{key:_.id,index:`/system${_.path}`},{default:e(()=>[$(w(_.name),1)]),_:2},1032,["index"]))),128))]),_:2},1032,["index"])):o.path==="/demand"?(s(),u(p,{key:1,onClick:S},{default:e(()=>[n(d,null,{default:e(()=>[(s(),u(B(o.icon)))]),_:2},1024),f("span",null,w(o.name),1)]),_:2},1024)):(s(),u(p,{key:2,index:`/system${o.path}`},{default:e(()=>[n(d,null,{default:e(()=>[(s(),u(B(o.icon)))]),_:2},1024),f("span",null,w(o.name),1)]),_:2},1032,["index"]))],64))),128))]),_:1},8,["default-active","default-openeds","loading"])}}}),Q={class:"common-layout"},X={class:"page-container"},Y={class:"loading-container"},Z=I({__name:"SystemMain",setup(V){return h([]),(k,y)=>{const r=a("el-aside"),l=a("RouterView"),b=a("el-skeleton"),c=a("el-main"),i=a("el-container");return s(),C("div",Q,[n(i,{direction:"vertical",style:{height:"100vh"}},{default:e(()=>[n(K),n(i,{style:{"margin-top":"84px"}},{default:e(()=>[n(r,{width:"240px"},{default:e(()=>[n(W)]),_:1}),n(i,null,{default:e(()=>[n(c,null,{default:e(()=>[f("div",X,[(s(),u(q,null,{default:e(()=>[n(l)]),fallback:e(()=>[f("div",Y,[n(b,{rows:3,animated:""})])]),_:1}))])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),ae=H(Z,[["__scopeId","data-v-f490535e"]]);export{ae as default};
