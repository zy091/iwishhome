import{e as K,f as P,h as W,E as Q}from"./elementPlus-COdCHMXA.js";import{u as j,h as X,b as G,s as Y}from"./index-CxnpMWLP.js";import{x as B,c as N,r as $,j as J,ax as O,G as c,H as n,P as e,ag as a,A as d,L as y,M as A,u as v,y as h,J as E,O as C,ay as q,z as u,a6 as T,K as V,aF as Z}from"./vendor-kUynFKsh.js";import"./supabase-Bu12BySZ.js";const ee={class:"toolbar",style:{display:"flex","justify-content":"end","align-items":"center"}},ne={style:{display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","margin-right":"5px"}},te=B({__name:"Header",setup(H){const g=q(),x=j(),R=N(()=>X(Number(x.roleId))),m=$(x.user);console.log(m.value,"user");const _=O();$(""),J(()=>{m.value=x.getUser()});const U=()=>{x.logout(),g.push("/login")},b=N(()=>_.path.includes("/training-")||_.path.includes("/training-home")),w=z=>{localStorage.setItem("category",z)};return(z,t)=>{const D=a("el-col"),s=a("el-avatar"),o=a("el-icon"),p=a("el-link"),l=a("el-dropdown-item"),i=a("el-dropdown-menu"),S=a("el-dropdown"),M=a("el-row"),I=a("el-header");return u(),c(I,{style:{"font-size":"16px"}},{default:n(()=>[e(M,{justify:"space-between",gutter:16,style:{height:"100%","align-items":"center"}},{default:n(()=>[e(D,{span:3},{default:n(()=>t[5]||(t[5]=[d("h1",{style:{"font-size":"40px","font-weight":"700"}},"IWISH",-1)])),_:1}),e(D,{span:4},{default:n(()=>{var k,r;return[d("div",ee,[e(s,{style:{"margin-right":"10px","min-width":"40px","font-size":"20px","font-weight":"700","align-items":"center","line-height":"40px","justify-content":"center",background:"#2f87ff"},src:(k=m.value)==null?void 0:k.avatar_url},{default:n(()=>{var f,L,F;return[y(A(((F=(L=(f=m.value)==null?void 0:f.full_name)==null?void 0:L.charAt(0))==null?void 0:F.toUpperCase())||"U"),1)]}),_:1},8,["src"]),d("span",ne,A((r=m.value)==null?void 0:r.full_name),1),e(S,null,{dropdown:n(()=>[e(i,null,{default:n(()=>[b.value?E("",!0):(u(),h(C,{key:0},[e(l,null,{default:n(()=>[e(p,{href:"/system/personal-data"},{default:n(()=>t[6]||(t[6]=[y(" 个人中心")])),_:1})]),_:1}),R.value?(u(),h(C,{key:0},[e(l,null,{default:n(()=>[e(p,{href:"/system/",onClick:t[0]||(t[0]=f=>w(""))},{default:n(()=>t[7]||(t[7]=[y(" 全部菜单")])),_:1})]),_:1}),e(l,null,{default:n(()=>[e(p,{href:"/system/",onClick:t[1]||(t[1]=f=>w("admin"))},{default:n(()=>t[8]||(t[8]=[y(" 管理员")])),_:1})]),_:1}),e(l,null,{default:n(()=>[e(p,{href:"/system/",onClick:t[2]||(t[2]=f=>w("google"))},{default:n(()=>t[9]||(t[9]=[y(" Google")])),_:1})]),_:1}),e(l,null,{default:n(()=>[e(p,{href:"/system/",onClick:t[3]||(t[3]=f=>w("meta"))},{default:n(()=>t[10]||(t[10]=[y(" Meta")])),_:1})]),_:1}),e(l,null,{default:n(()=>[e(p,{href:"/system/",onClick:t[4]||(t[4]=f=>w("criteo"))},{default:n(()=>t[11]||(t[11]=[y(" Criteo")])),_:1})]),_:1})],64)):E("",!0)],64)),e(l,{onClick:U},{default:n(()=>t[12]||(t[12]=[y("退出登录")])),_:1})]),_:1})]),default:n(()=>[e(o,{style:{"margin-right":"10px","margin-top":"1px","font-size":"18px",color:"#fff"}},{default:n(()=>[e(v(K))]),_:1})]),_:1})])]}),_:1})]),_:1})]),_:1})}}}),oe=G(te,[["__scopeId","data-v-50a51829"]]),le=B({__name:"Aside",setup(H){q();const g=O(),x=$(""),R=$([]),m=$(!1),_=j(),U=N(()=>_.getMenus);N(()=>g.path);const b=s=>{x.value=s,s==="/system/demand"&&t()},w=$("");J(async()=>{m.value=!0,_.fetchMenus();const{data:{session:s}}=await Y.auth.getSession();w.value=(s==null?void 0:s.access_token)||"",m.value=!1});function z(s){const o=typeof s=="string"?s:JSON.stringify(s);return btoa(unescape(encodeURIComponent(o))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const t=()=>{var s,o,p,l,i,S,M,I;try{const k={id:((s=_.user)==null?void 0:s.user_id)||"",email:((o=_.user)==null?void 0:o.email)||"",name:((p=_.user)==null?void 0:p.full_name)||((i=(l=_.user)==null?void 0:l.email)==null?void 0:i.split("@")[0])||"用户",role:D((S=_.user)==null?void 0:S.role_id),rolename:(I=(M=_.user)==null?void 0:M.role)==null?void 0:I.name,origin:window.location.origin,exp:Math.floor(Date.now()/1e3)+900},r=z(k);window.open(`https://iwishneed.netlify.app/auth/bridge#external_user=${r}&main_access_token=${w.value}`,"_blank")}catch(k){console.error("处理demand跳转失败:",k),Q.error("跳转失败，请稍后重试")}},D=s=>{if(!s)return"submitter";switch(s){case 0:case 1:return"admin";case 2:case 3:return"manager";case 4:case 5:return"developer";default:return"submitter"}};return(s,o)=>{const p=a("ArrowLeft"),l=a("el-icon"),i=a("el-menu-item"),S=a("InfoFilled"),M=a("DataAnalysis"),I=a("el-sub-menu"),k=a("el-menu");return u(),c(k,{class:"el-menu-vertical-demo","active-text-color":"#fff","background-color":"#05479a","text-color":"#fff",style:{position:"fixed","z-index":"999",height:"calc(100vh - 84px)",left:"0",width:"240px","overflow-y":"auto","overflow-x":"hidden"},router:!0,"unique-opened":!0,"default-active":x.value,"default-openeds":R.value,onSelect:b,loading:m.value},{default:n(()=>[v(g).name==="letter-to-employee"||v(g).name==="company-introduction"||v(g).name==="apply-for-registration"?(u(),h(C,{key:0},[e(i,{index:"/training-home"},{default:n(()=>[e(l,null,{default:n(()=>[e(p)]),_:1}),o[0]||(o[0]=d("span",null,"返回",-1))]),_:1}),e(i,{index:"/system/training-letter"},{default:n(()=>[e(l,null,{default:n(()=>[e(v(P))]),_:1}),o[1]||(o[1]=d("span",null,"致员工的一封信",-1))]),_:1}),e(i,{index:"/system/training-company"},{default:n(()=>[e(l,null,{default:n(()=>[e(v(W))]),_:1}),o[2]||(o[2]=d("span",null,"了解艾维",-1))]),_:1}),e(i,{index:"/system/training-apply"},{default:n(()=>[e(l,null,{default:n(()=>[e(S)]),_:1}),o[3]||(o[3]=d("span",null,"申请注册",-1))]),_:1})],64)):v(g).name==="digital-marketing"||v(g).name==="website-layout"?(u(),h(C,{key:1},[e(i,{index:"/training-home"},{default:n(()=>[e(l,null,{default:n(()=>[e(p)]),_:1}),o[4]||(o[4]=d("span",null,"返回",-1))]),_:1}),e(i,{index:"/system/training-marketing"},{default:n(()=>[e(l,null,{default:n(()=>[e(v(P))]),_:1}),o[5]||(o[5]=d("span",null,"了解数字营销与品牌独立站",-1))]),_:1}),e(i,{index:"/system/training-website"},{default:n(()=>[e(l,null,{default:n(()=>[e(M)]),_:1}),o[6]||(o[6]=d("span",null,"独立站的布局及优化诊断",-1))]),_:1})],64)):(u(!0),h(C,{key:2},T(U.value,r=>(u(),h(C,{key:r.id},[r.children&&r.children.length>0?(u(),c(I,{key:0,index:`/system${r.path}`},{title:n(()=>[e(l,null,{default:n(()=>[(u(),c(V(r.icon)))]),_:2},1024),d("span",null,A(r.name),1)]),default:n(()=>[(u(!0),h(C,null,T(r.children,f=>(u(),c(i,{key:f.id,index:`/system${f.path}`},{default:n(()=>[y(A(f.name),1)]),_:2},1032,["index"]))),128))]),_:2},1032,["index"])):r.path==="/demand"?(u(),c(i,{key:1,onClick:t},{default:n(()=>[e(l,null,{default:n(()=>[(u(),c(V(r.icon)))]),_:2},1024),d("span",null,A(r.name),1)]),_:2},1024)):(u(),c(i,{key:2,index:`/system${r.path}`},{default:n(()=>[e(l,null,{default:n(()=>[(u(),c(V(r.icon)))]),_:2},1024),d("span",null,A(r.name),1)]),_:2},1032,["index"]))],64))),128))]),_:1},8,["default-active","default-openeds","loading"])}}}),ae={class:"common-layout"},se={class:"page-container"},re={class:"loading-container"},ue=B({__name:"SystemMain",setup(H){return $([]),(g,x)=>{const R=a("el-aside"),m=a("RouterView"),_=a("el-skeleton"),U=a("el-main"),b=a("el-container");return u(),h("div",ae,[e(b,{direction:"vertical",style:{height:"100vh"}},{default:n(()=>[e(oe),e(b,{style:{"margin-top":"84px"}},{default:n(()=>[e(R,{width:"240px"},{default:n(()=>[e(le)]),_:1}),e(b,null,{default:n(()=>[e(U,null,{default:n(()=>[d("div",se,[(u(),c(Z,null,{default:n(()=>[e(m)]),fallback:n(()=>[d("div",re,[e(_,{rows:3,animated:""})])]),_:1}))])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),me=G(ue,[["__scopeId","data-v-f490535e"]]);export{me as default};
